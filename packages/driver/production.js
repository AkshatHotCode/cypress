"use strict";var Tn=Object.create;var Ue=Object.defineProperty,wn=Object.defineProperties,En=Object.getOwnPropertyDescriptor,In=Object.getOwnPropertyDescriptors,Rn=Object.getOwnPropertyNames,Ye=Object.getOwnPropertySymbols,Nn=Object.getPrototypeOf,Et=Object.prototype.hasOwnProperty,ar=Object.prototype.propertyIsEnumerable;var nr=(n,e,t)=>e in n?Ue(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,$e=(n,e)=>{for(var t in e||={})Et.call(e,t)&&nr(n,t,e[t]);if(Ye)for(var t of Ye(e))ar.call(e,t)&&nr(n,t,e[t]);return n},Ve=(n,e)=>wn(n,In(e));var We=(n,e)=>{var t={};for(var a in n)Et.call(n,a)&&e.indexOf(a)<0&&(t[a]=n[a]);if(n!=null&&Ye)for(var a of Ye(n))e.indexOf(a)<0&&ar.call(n,a)&&(t[a]=n[a]);return t};var X=(n,e)=>()=>(e||n((e={exports:{}}).exports,e),e.exports),On=(n,e)=>{for(var t in e)Ue(n,t,{get:e[t],enumerable:!0})},sr=(n,e,t,a)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of Rn(e))!Et.call(n,s)&&s!==t&&Ue(n,s,{get:()=>e[s],enumerable:!(a=En(e,s))||a.enumerable});return n};var U=(n,e,t)=>(t=n!=null?Tn(Nn(n)):{},sr(e||!n||!n.__esModule?Ue(t,"default",{value:n,enumerable:!0}):t,n)),Pn=n=>sr(Ue({},"__esModule",{value:!0}),n);var ir=X((zs,or)=>{var Ee=1e3,Ie=Ee*60,Re=Ie*60,le=Re*24,An=le*7,Mn=le*365.25;or.exports=function(n,e){e=e||{};var t=typeof n;if(t==="string"&&n.length>0)return Dn(n);if(t==="number"&&isFinite(n))return e.long?jn(n):Ln(n);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(n))};function Dn(n){if(n=String(n),!(n.length>100)){var e=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(n);if(e){var t=parseFloat(e[1]),a=(e[2]||"ms").toLowerCase();switch(a){case"years":case"year":case"yrs":case"yr":case"y":return t*Mn;case"weeks":case"week":case"w":return t*An;case"days":case"day":case"d":return t*le;case"hours":case"hour":case"hrs":case"hr":case"h":return t*Re;case"minutes":case"minute":case"mins":case"min":case"m":return t*Ie;case"seconds":case"second":case"secs":case"sec":case"s":return t*Ee;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return t;default:return}}}}function Ln(n){var e=Math.abs(n);return e>=le?Math.round(n/le)+"d":e>=Re?Math.round(n/Re)+"h":e>=Ie?Math.round(n/Ie)+"m":e>=Ee?Math.round(n/Ee)+"s":n+"ms"}function jn(n){var e=Math.abs(n);return e>=le?Ke(n,e,le,"day"):e>=Re?Ke(n,e,Re,"hour"):e>=Ie?Ke(n,e,Ie,"minute"):e>=Ee?Ke(n,e,Ee,"second"):n+" ms"}function Ke(n,e,t,a){var s=e>=t*1.5;return Math.round(n/t)+" "+a+(s?"s":"")}});var It=X((Bs,dr)=>{function qn(n){t.debug=t,t.default=t,t.coerce=c,t.disable=o,t.enable=s,t.enabled=i,t.humanize=ir(),t.destroy=u,Object.keys(n).forEach(l=>{t[l]=n[l]}),t.names=[],t.skips=[],t.formatters={};function e(l){let g=0;for(let x=0;x<l.length;x++)g=(g<<5)-g+l.charCodeAt(x),g|=0;return t.colors[Math.abs(g)%t.colors.length]}t.selectColor=e;function t(l){let g,x=null,L,Ge;function I(...j){if(!I.enabled)return;let ce=I,Xe=Number(new Date),Cn=Xe-(g||Xe);ce.diff=Cn,ce.prev=g,ce.curr=Xe,g=Xe,j[0]=t.coerce(j[0]),typeof j[0]!="string"&&j.unshift("%O");let Je=0;j[0]=j[0].replace(/%([a-zA-Z%])/g,(wt,kn)=>{if(wt==="%%")return"%";Je++;let rr=t.formatters[kn];if(typeof rr=="function"){let _n=j[Je];wt=rr.call(ce,_n),j.splice(Je,1),Je--}return wt}),t.formatArgs.call(ce,j),(ce.log||t.log).apply(ce,j)}return I.namespace=l,I.useColors=t.useColors(),I.color=t.selectColor(l),I.extend=a,I.destroy=t.destroy,Object.defineProperty(I,"enabled",{enumerable:!0,configurable:!1,get:()=>x!==null?x:(L!==t.namespaces&&(L=t.namespaces,Ge=t.enabled(l)),Ge),set:j=>{x=j}}),typeof t.init=="function"&&t.init(I),I}function a(l,g){let x=t(this.namespace+(typeof g>"u"?":":g)+l);return x.log=this.log,x}function s(l){t.save(l),t.namespaces=l,t.names=[],t.skips=[];let g,x=(typeof l=="string"?l:"").split(/[\s,]+/),L=x.length;for(g=0;g<L;g++)x[g]&&(l=x[g].replace(/\*/g,".*?"),l[0]==="-"?t.skips.push(new RegExp("^"+l.slice(1)+"$")):t.names.push(new RegExp("^"+l+"$")))}function o(){let l=[...t.names.map(d),...t.skips.map(d).map(g=>"-"+g)].join(",");return t.enable(""),l}function i(l){if(l[l.length-1]==="*")return!0;let g,x;for(g=0,x=t.skips.length;g<x;g++)if(t.skips[g].test(l))return!1;for(g=0,x=t.names.length;g<x;g++)if(t.names[g].test(l))return!0;return!1}function d(l){return l.toString().substring(2,l.toString().length-2).replace(/\.\*\?$/,"*")}function c(l){return l instanceof Error?l.stack||l.message:l}function u(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return t.enable(t.load()),t}dr.exports=qn});var cr=X((R,Qe)=>{R.formatArgs=zn;R.save=Bn;R.load=Un;R.useColors=Fn;R.storage=$n();R.destroy=(()=>{let n=!1;return()=>{n||(n=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})();R.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function Fn(){return typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function zn(n){if(n[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+n[0]+(this.useColors?"%c ":" ")+"+"+Qe.exports.humanize(this.diff),!this.useColors)return;let e="color: "+this.color;n.splice(1,0,e,"color: inherit");let t=0,a=0;n[0].replace(/%[a-zA-Z%]/g,s=>{s!=="%%"&&(t++,s==="%c"&&(a=t))}),n.splice(a,0,e)}R.log=console.debug||console.log||(()=>{});function Bn(n){try{n?R.storage.setItem("debug",n):R.storage.removeItem("debug")}catch{}}function Un(){let n;try{n=R.storage.getItem("debug")}catch{}return!n&&typeof process<"u"&&"env"in process&&(n=process.env.DEBUG),n}function $n(){try{return localStorage}catch{}}Qe.exports=It()(R);var{formatters:Vn}=Qe.exports;Vn.j=function(n){try{return JSON.stringify(n)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}});var ur=X((Us,lr)=>{"use strict";lr.exports=(n,e=process.argv)=>{let t=n.startsWith("-")?"":n.length===1?"-":"--",a=e.indexOf(t+n),s=e.indexOf("--");return a!==-1&&(s===-1||a<s)}});var hr=X(($s,mr)=>{"use strict";var Wn=require("os"),pr=require("tty"),q=ur(),{env:_}=process,re;q("no-color")||q("no-colors")||q("color=false")||q("color=never")?re=0:(q("color")||q("colors")||q("color=true")||q("color=always"))&&(re=1);"FORCE_COLOR"in _&&(_.FORCE_COLOR==="true"?re=1:_.FORCE_COLOR==="false"?re=0:re=_.FORCE_COLOR.length===0?1:Math.min(parseInt(_.FORCE_COLOR,10),3));function Rt(n){return n===0?!1:{level:n,hasBasic:!0,has256:n>=2,has16m:n>=3}}function Nt(n,e){if(re===0)return 0;if(q("color=16m")||q("color=full")||q("color=truecolor"))return 3;if(q("color=256"))return 2;if(n&&!e&&re===void 0)return 0;let t=re||0;if(_.TERM==="dumb")return t;if(process.platform==="win32"){let a=Wn.release().split(".");return Number(a[0])>=10&&Number(a[2])>=10586?Number(a[2])>=14931?3:2:1}if("CI"in _)return["TRAVIS","CIRCLECI","APPVEYOR","GITLAB_CI"].some(a=>a in _)||_.CI_NAME==="codeship"?1:t;if("TEAMCITY_VERSION"in _)return/^(9\.(0*[1-9]\d*)\.|\d{2,}\.)/.test(_.TEAMCITY_VERSION)?1:0;if("GITHUB_ACTIONS"in _)return 1;if(_.COLORTERM==="truecolor")return 3;if("TERM_PROGRAM"in _){let a=parseInt((_.TERM_PROGRAM_VERSION||"").split(".")[0],10);switch(_.TERM_PROGRAM){case"iTerm.app":return a>=3?3:2;case"Apple_Terminal":return 2}}return/-256(color)?$/i.test(_.TERM)?2:/^screen|^xterm|^vt100|^vt220|^rxvt|color|ansi|cygwin|linux/i.test(_.TERM)||"COLORTERM"in _?1:t}function Zn(n){let e=Nt(n,n&&n.isTTY);return Rt(e)}mr.exports={supportsColor:Zn,stdout:Rt(Nt(!0,pr.isatty(1))),stderr:Rt(Nt(!0,pr.isatty(2)))}});var gr=X((w,tt)=>{var Hn=require("tty"),et=require("util");w.init=ea;w.log=Yn;w.formatArgs=Xn;w.save=Kn;w.load=Qn;w.useColors=Gn;w.destroy=et.deprecate(()=>{},"Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.");w.colors=[6,2,3,4,5,1];try{let n=hr();n&&(n.stderr||n).level>=2&&(w.colors=[20,21,26,27,32,33,38,39,40,41,42,43,44,45,56,57,62,63,68,69,74,75,76,77,78,79,80,81,92,93,98,99,112,113,128,129,134,135,148,149,160,161,162,163,164,165,166,167,168,169,170,171,172,173,178,179,184,185,196,197,198,199,200,201,202,203,204,205,206,207,208,209,214,215,220,221])}catch{}w.inspectOpts=Object.keys(process.env).filter(n=>/^debug_/i.test(n)).reduce((n,e)=>{let t=e.substring(6).toLowerCase().replace(/_([a-z])/g,(s,o)=>o.toUpperCase()),a=process.env[e];return/^(yes|on|true|enabled)$/i.test(a)?a=!0:/^(no|off|false|disabled)$/i.test(a)?a=!1:a==="null"?a=null:a=Number(a),n[t]=a,n},{});function Gn(){return"colors"in w.inspectOpts?!!w.inspectOpts.colors:Hn.isatty(process.stderr.fd)}function Xn(n){let{namespace:e,useColors:t}=this;if(t){let a=this.color,s="\x1B[3"+(a<8?a:"8;5;"+a),o=`  ${s};1m${e} \x1B[0m`;n[0]=o+n[0].split(`
`).join(`
`+o),n.push(s+"m+"+tt.exports.humanize(this.diff)+"\x1B[0m")}else n[0]=Jn()+e+" "+n[0]}function Jn(){return w.inspectOpts.hideDate?"":new Date().toISOString()+" "}function Yn(...n){return process.stderr.write(et.format(...n)+`
`)}function Kn(n){n?process.env.DEBUG=n:delete process.env.DEBUG}function Qn(){return process.env.DEBUG}function ea(n){n.inspectOpts={};let e=Object.keys(w.inspectOpts);for(let t=0;t<e.length;t++)n.inspectOpts[e[t]]=w.inspectOpts[e[t]]}tt.exports=It()(w);var{formatters:fr}=tt.exports;fr.o=function(n){return this.inspectOpts.colors=this.useColors,et.inspect(n,this.inspectOpts).split(`
`).map(e=>e.trim()).join(" ")};fr.O=function(n){return this.inspectOpts.colors=this.useColors,et.inspect(n,this.inspectOpts)}});var J=X((Vs,Ot)=>{typeof process>"u"||process.type==="renderer"||process.browser===!0||process.__nwjs?Ot.exports=cr():Ot.exports=gr()});var Tr=X((eo,na)=>{na.exports='"use strict";var a,w;function u(e,t){if(e.nodeType!==Node.ELEMENT_NODE)throw new Error("Can\'t generate CSS selector for non-element node type.");if(e.tagName.toLowerCase()==="html")return"html";let n={root:document.body,idName:o=>!0,className:o=>!0,tagName:o=>!0,attr:(o,l)=>!1,seedMinLength:1,optimizedMinLength:2,threshold:1e3,maxNumberOfTries:1e4};a={...n,...t},w=T(a.root,n);let r=f(e,"all",()=>f(e,"two",()=>f(e,"one",()=>f(e,"none"))));if(r){let o=L(M(r,e));return o.length>0&&(r=o[0]),h(r)}else throw new Error("Selector was not found.")}function T(e,t){return e.nodeType===Node.DOCUMENT_NODE?e:e===t.root?e.ownerDocument:e}function f(e,t,n){let r=null,o=[],l=e,d=0;for(;l;){let i=p(b(l))||p(...D(l))||p(...A(l))||p(x(l))||[v()],c=I(l);if(t=="all")c&&(i=i.concat(i.filter(g).map(s=>m(s,c))));else if(t=="two")i=i.slice(0,1),c&&(i=i.concat(i.filter(g).map(s=>m(s,c))));else if(t=="one"){let[s]=i=i.slice(0,1);c&&g(s)&&(i=[m(s,c)])}else t=="none"&&(i=[v()],c&&(i=[m(i[0],c)]));for(let s of i)s.level=d;if(o.push(i),o.length>=a.seedMinLength&&(r=E(o,n),r))break;l=l.parentElement,d++}return r||(r=E(o,n)),!r&&n?n():r}function E(e,t){let n=L(N(e));if(n.length>a.threshold)return t?t():null;for(let r of n)if(S(r))return r;return null}function h(e){let t=e[0],n=t.name;for(let r=1;r<e.length;r++){let o=e[r].level||0;t.level===o-1?n=`${e[r].name} > ${n}`:n=`${e[r].name} ${n}`,t=e[r]}return n}function C(e){return e.map(t=>t.penalty).reduce((t,n)=>t+n,0)}function S(e){let t=h(e);switch(w.querySelectorAll(t).length){case 0:throw new Error(`Can\'t select any node with this selector: ${t}`);case 1:return!0;default:return!1}}function b(e){let t=e.getAttribute("id");return t&&a.idName(t)?{name:"#"+CSS.escape(t),penalty:0}:null}function D(e){return Array.from(e.attributes).filter(n=>a.attr(n.name,n.value)).map(n=>({name:`[${CSS.escape(n.name)}="${CSS.escape(n.value)}"]`,penalty:.5}))}function A(e){return Array.from(e.classList).filter(a.className).map(n=>({name:"."+CSS.escape(n),penalty:1}))}function x(e){let t=e.tagName.toLowerCase();return a.tagName(t)?{name:t,penalty:2}:null}function v(){return{name:"*",penalty:3}}function I(e){let t=e.parentNode;if(!t)return null;let n=t.firstChild;if(!n)return null;let r=0;for(;n&&(n.nodeType===Node.ELEMENT_NODE&&r++,n!==e);)n=n.nextSibling;return r}function m(e,t){return{name:e.name+`:nth-child(${t})`,penalty:e.penalty+1}}function g(e){return e.name!=="html"&&!e.name.startsWith("#")}function p(...e){let t=e.filter(O);return t.length>0?t:null}function O(e){return e!=null}function*N(e,t=[]){if(e.length>0)for(let n of e[0])yield*N(e.slice(1,e.length),t.concat(n));else yield t}function L(e){return[...e].sort((t,n)=>C(t)-C(n))}function*M(e,t,n={counter:0,visited:new Map}){if(e.length>2&&e.length>a.optimizedMinLength)for(let r=1;r<e.length-1;r++){if(n.counter>a.maxNumberOfTries)return;n.counter+=1;let o=[...e];o.splice(r,1);let l=h(o);if(n.visited.has(l))return;S(o)&&P(o,t)&&(yield o,n.visited.set(l,!0),yield*M(o,t,n))}}function P(e,t){return w.querySelector(h(e))===t}var R=(e,t)=>({type:"window-scrolled",payload:{timestamp:e,scrollX:t.scrollX,scrollY:t.scrollY}}),H=(e,t)=>({type:"element-scrolled",payload:{timestamp:e,scrollX:t.target.scrollLeft,scrollY:t.target.scrollTop,elementSelector:u(t.target)}}),y=class{constructor(t,n,r){this.windowRef=t;this.docRef=n;this.perfRef=r;this.handleDocumentScroll=t=>{let n=this.perfRef.now()+this.perfRef.timeOrigin,r=t.target instanceof Document?R(n,this.windowRef):H(n,t);this.windowRef.cypressAutProtocolEvent(JSON.stringify(r))}}register(){this.docRef.addEventListener("scroll",this.handleDocumentScroll,!0)}};window.top!==window&&(document.addEventListener("input",t=>{var o;let n=performance.now()+performance.timeOrigin,r=t.target;if(r.tagName==="SELECT"){let l={type:"select-input-changed",payload:{elementSelector:u(r),values:Array.from(r.selectedOptions).map(({value:d})=>d),timestamp:n}};window.cypressAutProtocolEvent&&window.cypressAutProtocolEvent(JSON.stringify(l))}else if(r.getAttribute("type")==="radio"){let l={type:"radio-input-changed",payload:{elementSelector:u(r),checked:r.checked,name:r.getAttribute("name")||void 0,timestamp:n}};window.cypressAutProtocolEvent&&window.cypressAutProtocolEvent(JSON.stringify(l))}else if(((o=r.attributes.getNamedItem("type"))==null?void 0:o.value)==="checkbox"){let l={type:"checkbox-input-changed",payload:{elementSelector:u(r),checked:r.checked,timestamp:n}};window.cypressAutProtocolEvent&&window.cypressAutProtocolEvent(JSON.stringify(l))}else{let l={type:"text-input-changed",payload:{elementSelector:u(r),value:r.value,timestamp:n}};window.cypressAutProtocolEvent&&window.cypressAutProtocolEvent(JSON.stringify(l))}}),new y(window,document,performance).register());\n'});var Ut=X((Id,pn)=>{"use strict";var Ms=()=>{let n={};return n.promise=new Promise((e,t)=>{n.resolve=e,n.reject=t}),n};pn.exports=Ms});var js={};On(js,{AppCaptureProtocol:()=>Tt});module.exports=Pn(js);var Pt=U(J()),_r=U(require("crypto"));var ue=String.raw,yr=ue`
CREATE TABLE IF NOT EXISTS events (
  /* autoincrementing id */
  id INTEGER PRIMARY KEY,
  /* source of the event (e.g. cdp, cypress, etc.) */
  source TEXT NOT NULL,
  /* type of the event (e.g. 'viewport:changed, log:added, runtime:console-api-called', etc.) */
  type TEXT NOT NULL,
  /* payload of the event. JSON stringified */
  payload TEXT,
  /**
   * id of the runnable (test) that the event belongs to.
   * Can be NULL when the event is not associated with a given runnable (e.g. event occurs before any tests start)
   */
  runnable_id TEXT,
  /**
   * attempt number of the runnable (test) that the event belong to. 1-based (i.e. 1 = first attempt, 2 = second attempt, etc.).
   * Can be NULL when the event is not associated with a given runnable (e.g. event occurs before any tests start)
   */
  attempt INTEGER,
  /* timestamp of the event */
  timestamp REAL NOT NULL
) STRICT
  `,vr=ue`
CREATE TABLE IF NOT EXISTS network_responses (
  /* the request id of the network request - https://chromedevtools.github.io/devtools-protocol/tot/Network/#type-RequestId */
  request_id TEXT PRIMARY KEY NOT NULL,
  /* the request URL of the network request - https://chromedevtools.github.io/devtools-protocol/tot/Network/#type-Request */
  request_url TEXT NOT NULL,
  /* the type of the network request - https://chromedevtools.github.io/devtools-protocol/tot/Network/#type-ResourceType */
  type TEXT NOT NULL,
  /* the mime type of the response - https://chromedevtools.github.io/devtools-protocol/tot/Network/#type-Response */
  mime_type TEXT NOT NULL,
  /**
   * id of the runnable (test) that the event belongs to.
   * Can be NULL when the event is not associated with a given runnable (e.g. event occurs before any tests start)
   */
  runnable_id TEXT,
  /**
   * attempt number of the runnable (test) that the event belong to. 1-based (i.e. 1 = first attempt, 2 = second attempt, etc.).
   * Can be NULL when the event is not associated with a given runnable (e.g. event occurs before any tests start)
   */
  attempt INTEGER,
  /**
   * timestamp of the requestWillBeSent event for the network request
   */
  request_will_be_sent_timestamp REAL NOT NULL,
  /**
   * timestamp of the loadingFinished event for the network request
   */
  loading_finished_timestamp REAL NOT NULL,
  /**
   * hash of the response body
   */
  body_hash TEXT NOT NULL
) STRICT
  `,br=ue`
CREATE TABLE IF NOT EXISTS hashed_data (
  /* hash of the data */
  hash TEXT PRIMARY KEY NOT NULL,
  /* data that was hashed */
  data TEXT NOT NULL,
  /* whether the data is base64 encoded */
  is_base64_encoded INTEGER NOT NULL
) STRICT
  `,Sr=ue`
INSERT INTO events (source, type, payload, runnable_id, attempt, timestamp)
VALUES ($source, $type, $payload, $runnableId, $attempt, $timestamp)
`,xr=ue`
INSERT INTO network_responses (request_id, request_url, type, mime_type, runnable_id, attempt, request_will_be_sent_timestamp, loading_finished_timestamp, body_hash)
VALUES ($requestId, $requestURL, $type, $mimeType, $runnableId, $attempt, $requestWillBeSentTimestamp, $loadingFinishedTimestamp, $bodyHash)
`,Cr=ue`
INSERT OR IGNORE INTO hashed_data (hash, data, is_base64_encoded)
VALUES ($hash, $data, $isBase64Encoded)
`,kr=ue`
DELETE FROM events WHERE runnable_id = ?
`;var rt=n=>{n.pragma("journal_mode = WAL"),n.prepare(yr).run(),n.prepare(vr).run(),n.prepare(br).run()};rt.SCHEMA_VERSION=1;var Ne=(0,Pt.default)("cypress:protocol:capture:db"),ta=(0,Pt.default)("cypress-verbose:protocol:capture:db"),ra={"dom:attribute-modified":!0,"dom:attribute-removed":!0,"dom:character-data-modified":!0,"dom:full-snapshot":!0,"dom:node-added":!0,"dom:node-removed":!0,"network:request-served-from-cache":!0,"network:request-will-be-sent-extra-info":!0,"network:response-received-extra-info":!0,"dom:checkbox-input-changed":!1,"dom:element-scrolled":!1,"dom:radio-input-changed":!1,"dom:select-input-changed":!1,"dom:text-input-changed":!1,"dom:window-scrolled":!1,"log:added":!1,"network:loading-finished":!1,"network:request-will-be-sent":!1,"network:response-received":!1,"runtime:console-api-called":!1,"runtime:exception-thrown":!1,"network:loading-failed":!1},Oe=class{constructor({db:e,state:t}){this.pendingTimestampSyncEvents=[];Ne("connecting to database"),this.db=e,this.state=t,rt(this.db)}addEvent(e){this.addEvents([e])}addEvents(e){let t=[];for(let a of e)a.source==="cdp"&&ra[a.type]?this.pendingTimestampSyncEvents.push(a):t.push(a);this.insertEvents(t)}flushPendingTimestampSyncEvents(){let{toFlush:e,toKeep:t}=this.pendingTimestampSyncEvents.reduce((a,s)=>{let o=this.state.getTimingForTimestamp(s.timestamp);if(o){let i=o.offset,d=s.timestamp-i;s.timestamp=d>o.clientSideStartTime?d:o.clientSideStartTime+1e-4,ta("flushing event type %s with offset %o",s.type,i),a.toFlush.push(s)}else a.toKeep.push(s);return a},{toFlush:[],toKeep:[]});this.pendingTimestampSyncEvents=t,this.insertEvents(e)}addNetworkResponse(e){if(!this.db.open){Ne("database is closed, not adding event");return}let t=_r.default.createHash("md5").update(e.body).digest("hex");this.db.prepare(xr).run({requestId:e.requestId,requestURL:e.requestURL,type:e.type,mimeType:e.mimeType,runnableId:e.runnableId,attempt:e.attempt,requestWillBeSentTimestamp:e.requestWillBeSentTimestamp,loadingFinishedTimestamp:e.loadingFinishedTimestamp,bodyHash:t}),this.db.prepare(Cr).run({hash:t,data:e.body,isBase64Encoded:e.isBase64Encoded?1:0})}close(){Ne("closing database"),this.db.prepare("VACUUM").run(),this.db.close()}resetTest(e){if(Ne("resetting test: %s",e),!this.db.open){Ne("database is closed, not resetting test");return}this.db.prepare(kr).run(e),this.pendingTimestampSyncEvents=[]}insertEvents(e){if(!this.db.open){Ne("database is closed, not adding events");return}let t=this.db.prepare(Sr);this.db.transaction(()=>{e.forEach(a=>{t.run({source:a.source,type:a.type,payload:JSON.stringify(a.payload),runnableId:a.runnableId,attempt:a.attempt,timestamp:a.timestamp})})})()}};Oe.SCHEMA_VERSION=rt.SCHEMA_VERSION;var At=U(J()),W=class{constructor(e,t,a,s){this.cdpClient=e;this.db=t;this.state=a;this.autBroker=s;this._debug=(0,At.default)(`cypress:protocol:capture:${this.constructor.name}`),this._debugVerbose=(0,At.default)(`cypress-verbose:protocol:capture:${this.constructor.name}`)}insertEvents(e){var a,s,o,i,d;let t=[];for(let c of e){let{eventType:u,eventPayload:l,eventExpectedSchema:g,timestamp:x,runnableId:L,attempt:Ge}=c;this._debug(`Insertion attempt for ${u}`),this._debugVerbose(`${u} called with payload: %O`,l);let I=g.safeParse(l);if(!I.success){this._debug(`not adding ${u} event to database due to failed parsing: %O`,I.error);continue}this._debug(`Inserting ${u} into events table with runnableId ${L}, attempt ${Ge}`),t.push({source:"cdp",type:c.eventType,payload:I.data,runnableId:(s=c.runnableId)!=null?s:(a=this.state.activeRunnable)==null?void 0:a.id,attempt:(i=c.attempt)!=null?i:(o=this.state.activeRunnable)==null?void 0:o.attempt,timestamp:x})}(d=this.db)==null||d.addEvents(t)}insertEvent(e,t,a,s,o,i){this.insertEvents([{eventType:e,eventPayload:t,eventExpectedSchema:a,timestamp:s,runnableId:o,attempt:i}])}};var mn=U(J());var wr=n=>n.shadowRootType!=="user-agent",Ze=(n,e)=>{var t,a;e(n),(t=n.children)==null||t.forEach(s=>{Ze(s,e)}),(a=n.shadowRoots)==null||a.filter(s=>wr(s)).forEach(s=>{Ze(s,e)}),n.contentDocument&&Ze(n.contentDocument,e)},Mt=n=>{if(n.nodeType===1&&n.attributes){for(let e=0;e<n.attributes.length;e+=2)if(n.attributes[e]==="class"&&n.attributes[e+1]==="aut-iframe")return n}if(n.children)for(let e=0;e<n.children.length;e++){let t=Mt(n.children[e]);if(t)return t}},aa=n=>{let e={};for(let t=0;t<n.length;t+=2)e[n[t]]=n[t+1];return e},pe=(n,e)=>{let g=n,{nodeId:t,backendNodeId:a,pseudoElements:s,pseudoIdentifier:o,pseudoType:i}=g,d=We(g,["nodeId","backendNodeId","pseudoElements","pseudoIdentifier","pseudoType"]),c=n.children?n.children.map(x=>pe(x,n.backendNodeId)):[],u=n.shadowRoots?n.shadowRoots.filter(x=>wr(x)).map(x=>pe(x)):[],l=n.contentDocument?pe(n.contentDocument):void 0;return Ve($e({},d),{children:c,shadowRoots:u,contentDocument:l,id:n.backendNodeId,parentId:e,attributes:aa(n.attributes||[])})},Er=()=>Tr();var C;(function(n){n.assertEqual=s=>s;function e(s){}n.assertIs=e;function t(s){throw new Error}n.assertNever=t,n.arrayToEnum=s=>{let o={};for(let i of s)o[i]=i;return o},n.getValidEnumValues=s=>{let o=n.objectKeys(s).filter(d=>typeof s[s[d]]!="number"),i={};for(let d of o)i[d]=s[d];return n.objectValues(i)},n.objectValues=s=>n.objectKeys(s).map(function(o){return s[o]}),n.objectKeys=typeof Object.keys=="function"?s=>Object.keys(s):s=>{let o=[];for(let i in s)Object.prototype.hasOwnProperty.call(s,i)&&o.push(i);return o},n.find=(s,o)=>{for(let i of s)if(o(i))return i},n.isInteger=typeof Number.isInteger=="function"?s=>Number.isInteger(s):s=>typeof s=="number"&&isFinite(s)&&Math.floor(s)===s;function a(s,o=" | "){return s.map(i=>typeof i=="string"?`'${i}'`:i).join(o)}n.joinValues=a,n.jsonStringifyReplacer=(s,o)=>typeof o=="bigint"?o.toString():o})(C||(C={}));var Dt;(function(n){n.mergeShapes=(e,t)=>({...e,...t})})(Dt||(Dt={}));var m=C.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),ne=n=>{switch(typeof n){case"undefined":return m.undefined;case"string":return m.string;case"number":return isNaN(n)?m.nan:m.number;case"boolean":return m.boolean;case"function":return m.function;case"bigint":return m.bigint;case"symbol":return m.symbol;case"object":return Array.isArray(n)?m.array:n===null?m.null:n.then&&typeof n.then=="function"&&n.catch&&typeof n.catch=="function"?m.promise:typeof Map<"u"&&n instanceof Map?m.map:typeof Set<"u"&&n instanceof Set?m.set:typeof Date<"u"&&n instanceof Date?m.date:m.object;default:return m.unknown}},p=C.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),sa=n=>JSON.stringify(n,null,2).replace(/"([^"]+)":/g,"$1:"),O=class extends Error{constructor(e){super(),this.issues=[],this.addIssue=a=>{this.issues=[...this.issues,a]},this.addIssues=(a=[])=>{this.issues=[...this.issues,...a]};let t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}get errors(){return this.issues}format(e){let t=e||function(o){return o.message},a={_errors:[]},s=o=>{for(let i of o.issues)if(i.code==="invalid_union")i.unionErrors.map(s);else if(i.code==="invalid_return_type")s(i.returnTypeError);else if(i.code==="invalid_arguments")s(i.argumentsError);else if(i.path.length===0)a._errors.push(t(i));else{let d=a,c=0;for(;c<i.path.length;){let u=i.path[c];c===i.path.length-1?(d[u]=d[u]||{_errors:[]},d[u]._errors.push(t(i))):d[u]=d[u]||{_errors:[]},d=d[u],c++}}};return s(this),a}toString(){return this.message}get message(){return JSON.stringify(this.issues,C.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=t=>t.message){let t={},a=[];for(let s of this.issues)s.path.length>0?(t[s.path[0]]=t[s.path[0]]||[],t[s.path[0]].push(e(s))):a.push(e(s));return{formErrors:a,fieldErrors:t}}get formErrors(){return this.flatten()}};O.create=n=>new O(n);var He=(n,e)=>{let t;switch(n.code){case p.invalid_type:n.received===m.undefined?t="Required":t=`Expected ${n.expected}, received ${n.received}`;break;case p.invalid_literal:t=`Invalid literal value, expected ${JSON.stringify(n.expected,C.jsonStringifyReplacer)}`;break;case p.unrecognized_keys:t=`Unrecognized key(s) in object: ${C.joinValues(n.keys,", ")}`;break;case p.invalid_union:t="Invalid input";break;case p.invalid_union_discriminator:t=`Invalid discriminator value. Expected ${C.joinValues(n.options)}`;break;case p.invalid_enum_value:t=`Invalid enum value. Expected ${C.joinValues(n.options)}, received '${n.received}'`;break;case p.invalid_arguments:t="Invalid function arguments";break;case p.invalid_return_type:t="Invalid function return type";break;case p.invalid_date:t="Invalid date";break;case p.invalid_string:typeof n.validation=="object"?"includes"in n.validation?(t=`Invalid input: must include "${n.validation.includes}"`,typeof n.validation.position=="number"&&(t=`${t} at one or more positions greater than or equal to ${n.validation.position}`)):"startsWith"in n.validation?t=`Invalid input: must start with "${n.validation.startsWith}"`:"endsWith"in n.validation?t=`Invalid input: must end with "${n.validation.endsWith}"`:C.assertNever(n.validation):n.validation!=="regex"?t=`Invalid ${n.validation}`:t="Invalid";break;case p.too_small:n.type==="array"?t=`Array must contain ${n.exact?"exactly":n.inclusive?"at least":"more than"} ${n.minimum} element(s)`:n.type==="string"?t=`String must contain ${n.exact?"exactly":n.inclusive?"at least":"over"} ${n.minimum} character(s)`:n.type==="number"?t=`Number must be ${n.exact?"exactly equal to ":n.inclusive?"greater than or equal to ":"greater than "}${n.minimum}`:n.type==="date"?t=`Date must be ${n.exact?"exactly equal to ":n.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(n.minimum))}`:t="Invalid input";break;case p.too_big:n.type==="array"?t=`Array must contain ${n.exact?"exactly":n.inclusive?"at most":"less than"} ${n.maximum} element(s)`:n.type==="string"?t=`String must contain ${n.exact?"exactly":n.inclusive?"at most":"under"} ${n.maximum} character(s)`:n.type==="number"?t=`Number must be ${n.exact?"exactly":n.inclusive?"less than or equal to":"less than"} ${n.maximum}`:n.type==="bigint"?t=`BigInt must be ${n.exact?"exactly":n.inclusive?"less than or equal to":"less than"} ${n.maximum}`:n.type==="date"?t=`Date must be ${n.exact?"exactly":n.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(n.maximum))}`:t="Invalid input";break;case p.custom:t="Invalid input";break;case p.invalid_intersection_types:t="Intersection results could not be merged";break;case p.not_multiple_of:t=`Number must be a multiple of ${n.multipleOf}`;break;case p.not_finite:t="Number must be finite";break;default:t=e.defaultError,C.assertNever(n)}return{message:t}},Nr=He;function oa(n){Nr=n}function at(){return Nr}var st=n=>{let{data:e,path:t,errorMaps:a,issueData:s}=n,o=[...t,...s.path||[]],i={...s,path:o},d="",c=a.filter(u=>!!u).slice().reverse();for(let u of c)d=u(i,{data:e,defaultError:d}).message;return{...s,path:o,message:s.message||d}},ia=[];function h(n,e){let t=st({issueData:e,data:n.data,path:n.path,errorMaps:[n.common.contextualErrorMap,n.schemaErrorMap,at(),He].filter(a=>!!a)});n.common.issues.push(t)}var T=class{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,t){let a=[];for(let s of t){if(s.status==="aborted")return v;s.status==="dirty"&&e.dirty(),a.push(s.value)}return{status:e.value,value:a}}static async mergeObjectAsync(e,t){let a=[];for(let s of t)a.push({key:await s.key,value:await s.value});return T.mergeObjectSync(e,a)}static mergeObjectSync(e,t){let a={};for(let s of t){let{key:o,value:i}=s;if(o.status==="aborted"||i.status==="aborted")return v;o.status==="dirty"&&e.dirty(),i.status==="dirty"&&e.dirty(),(typeof i.value<"u"||s.alwaysSet)&&(a[o.value]=i.value)}return{status:e.value,value:a}}},v=Object.freeze({status:"aborted"}),Or=n=>({status:"dirty",value:n}),E=n=>({status:"valid",value:n}),Lt=n=>n.status==="aborted",jt=n=>n.status==="dirty",ot=n=>n.status==="valid",it=n=>typeof Promise<"u"&&n instanceof Promise,f;(function(n){n.errToObj=e=>typeof e=="string"?{message:e}:e||{},n.toString=e=>typeof e=="string"?e:e?.message})(f||(f={}));var F=class{constructor(e,t,a,s){this._cachedPath=[],this.parent=e,this.data=t,this._path=a,this._key=s}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}},Ir=(n,e)=>{if(ot(e))return{success:!0,data:e.value};if(!n.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;let t=new O(n.common.issues);return this._error=t,this._error}}};function b(n){if(!n)return{};let{errorMap:e,invalid_type_error:t,required_error:a,description:s}=n;if(e&&(t||a))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:s}:{errorMap:(i,d)=>i.code!=="invalid_type"?{message:d.defaultError}:typeof d.data>"u"?{message:a??d.defaultError}:{message:t??d.defaultError},description:s}}var S=class{constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this)}get description(){return this._def.description}_getType(e){return ne(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:ne(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new T,ctx:{common:e.parent.common,data:e.data,parsedType:ne(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){let t=this._parse(e);if(it(t))throw new Error("Synchronous parse encountered promise.");return t}_parseAsync(e){let t=this._parse(e);return Promise.resolve(t)}parse(e,t){let a=this.safeParse(e,t);if(a.success)return a.data;throw a.error}safeParse(e,t){var a;let s={common:{issues:[],async:(a=t?.async)!==null&&a!==void 0?a:!1,contextualErrorMap:t?.errorMap},path:t?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:ne(e)},o=this._parseSync({data:e,path:s.path,parent:s});return Ir(s,o)}async parseAsync(e,t){let a=await this.safeParseAsync(e,t);if(a.success)return a.data;throw a.error}async safeParseAsync(e,t){let a={common:{issues:[],contextualErrorMap:t?.errorMap,async:!0},path:t?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:ne(e)},s=this._parse({data:e,path:a.path,parent:a}),o=await(it(s)?s:Promise.resolve(s));return Ir(a,o)}refine(e,t){let a=s=>typeof t=="string"||typeof t>"u"?{message:t}:typeof t=="function"?t(s):t;return this._refinement((s,o)=>{let i=e(s),d=()=>o.addIssue({code:p.custom,...a(s)});return typeof Promise<"u"&&i instanceof Promise?i.then(c=>c?!0:(d(),!1)):i?!0:(d(),!1)})}refinement(e,t){return this._refinement((a,s)=>e(a)?!0:(s.addIssue(typeof t=="function"?t(a,s):t),!1))}_refinement(e){return new A({schema:this,typeName:y.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}optional(){return $.create(this,this._def)}nullable(){return ee.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return P.create(this,this._def)}promise(){return oe.create(this,this._def)}or(e){return ge.create([this,e],this._def)}and(e){return ye.create(this,e,this._def)}transform(e){return new A({...b(this._def),schema:this,typeName:y.ZodEffects,effect:{type:"transform",transform:e}})}default(e){let t=typeof e=="function"?e:()=>e;return new Ce({...b(this._def),innerType:this,defaultValue:t,typeName:y.ZodDefault})}brand(){return new dt({typeName:y.ZodBranded,type:this,...b(this._def)})}catch(e){let t=typeof e=="function"?e:()=>e;return new je({...b(this._def),innerType:this,catchValue:t,typeName:y.ZodCatch})}describe(e){let t=this.constructor;return new t({...this._def,description:e})}pipe(e){return ke.create(this,e)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}},da=/^c[^\s-]{8,}$/i,ca=/^[a-z][a-z0-9]*$/,la=/[0-9A-HJKMNP-TV-Z]{26}/,ua=/^([a-f0-9]{8}-[a-f0-9]{4}-[1-5][a-f0-9]{3}-[a-f0-9]{4}-[a-f0-9]{12}|00000000-0000-0000-0000-000000000000)$/i,pa=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\])|(\[IPv6:(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))\])|([A-Za-z0-9]([A-Za-z0-9-]*[A-Za-z0-9])*(\.[A-Za-z]{2,})+))$/,ma=/^(\p{Extended_Pictographic}|\p{Emoji_Component})+$/u,ha=/^(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))$/,fa=/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,ga=n=>n.precision?n.offset?new RegExp(`^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}\\.\\d{${n.precision}}(([+-]\\d{2}(:?\\d{2})?)|Z)$`):new RegExp(`^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}\\.\\d{${n.precision}}Z$`):n.precision===0?n.offset?new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(([+-]\\d{2}(:?\\d{2})?)|Z)$"):new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}Z$"):n.offset?new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(\\.\\d+)?(([+-]\\d{2}(:?\\d{2})?)|Z)$"):new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(\\.\\d+)?Z$");function ya(n,e){return!!((e==="v4"||!e)&&ha.test(n)||(e==="v6"||!e)&&fa.test(n))}var N=class extends S{constructor(){super(...arguments),this._regex=(e,t,a)=>this.refinement(s=>e.test(s),{validation:t,code:p.invalid_string,...f.errToObj(a)}),this.nonempty=e=>this.min(1,f.errToObj(e)),this.trim=()=>new N({...this._def,checks:[...this._def.checks,{kind:"trim"}]}),this.toLowerCase=()=>new N({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]}),this.toUpperCase=()=>new N({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==m.string){let o=this._getOrReturnCtx(e);return h(o,{code:p.invalid_type,expected:m.string,received:o.parsedType}),v}let a=new T,s;for(let o of this._def.checks)if(o.kind==="min")e.data.length<o.value&&(s=this._getOrReturnCtx(e,s),h(s,{code:p.too_small,minimum:o.value,type:"string",inclusive:!0,exact:!1,message:o.message}),a.dirty());else if(o.kind==="max")e.data.length>o.value&&(s=this._getOrReturnCtx(e,s),h(s,{code:p.too_big,maximum:o.value,type:"string",inclusive:!0,exact:!1,message:o.message}),a.dirty());else if(o.kind==="length"){let i=e.data.length>o.value,d=e.data.length<o.value;(i||d)&&(s=this._getOrReturnCtx(e,s),i?h(s,{code:p.too_big,maximum:o.value,type:"string",inclusive:!0,exact:!0,message:o.message}):d&&h(s,{code:p.too_small,minimum:o.value,type:"string",inclusive:!0,exact:!0,message:o.message}),a.dirty())}else if(o.kind==="email")pa.test(e.data)||(s=this._getOrReturnCtx(e,s),h(s,{validation:"email",code:p.invalid_string,message:o.message}),a.dirty());else if(o.kind==="emoji")ma.test(e.data)||(s=this._getOrReturnCtx(e,s),h(s,{validation:"emoji",code:p.invalid_string,message:o.message}),a.dirty());else if(o.kind==="uuid")ua.test(e.data)||(s=this._getOrReturnCtx(e,s),h(s,{validation:"uuid",code:p.invalid_string,message:o.message}),a.dirty());else if(o.kind==="cuid")da.test(e.data)||(s=this._getOrReturnCtx(e,s),h(s,{validation:"cuid",code:p.invalid_string,message:o.message}),a.dirty());else if(o.kind==="cuid2")ca.test(e.data)||(s=this._getOrReturnCtx(e,s),h(s,{validation:"cuid2",code:p.invalid_string,message:o.message}),a.dirty());else if(o.kind==="ulid")la.test(e.data)||(s=this._getOrReturnCtx(e,s),h(s,{validation:"ulid",code:p.invalid_string,message:o.message}),a.dirty());else if(o.kind==="url")try{new URL(e.data)}catch{s=this._getOrReturnCtx(e,s),h(s,{validation:"url",code:p.invalid_string,message:o.message}),a.dirty()}else o.kind==="regex"?(o.regex.lastIndex=0,o.regex.test(e.data)||(s=this._getOrReturnCtx(e,s),h(s,{validation:"regex",code:p.invalid_string,message:o.message}),a.dirty())):o.kind==="trim"?e.data=e.data.trim():o.kind==="includes"?e.data.includes(o.value,o.position)||(s=this._getOrReturnCtx(e,s),h(s,{code:p.invalid_string,validation:{includes:o.value,position:o.position},message:o.message}),a.dirty()):o.kind==="toLowerCase"?e.data=e.data.toLowerCase():o.kind==="toUpperCase"?e.data=e.data.toUpperCase():o.kind==="startsWith"?e.data.startsWith(o.value)||(s=this._getOrReturnCtx(e,s),h(s,{code:p.invalid_string,validation:{startsWith:o.value},message:o.message}),a.dirty()):o.kind==="endsWith"?e.data.endsWith(o.value)||(s=this._getOrReturnCtx(e,s),h(s,{code:p.invalid_string,validation:{endsWith:o.value},message:o.message}),a.dirty()):o.kind==="datetime"?ga(o).test(e.data)||(s=this._getOrReturnCtx(e,s),h(s,{code:p.invalid_string,validation:"datetime",message:o.message}),a.dirty()):o.kind==="ip"?ya(e.data,o.version)||(s=this._getOrReturnCtx(e,s),h(s,{validation:"ip",code:p.invalid_string,message:o.message}),a.dirty()):C.assertNever(o);return{status:a.value,value:e.data}}_addCheck(e){return new N({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...f.errToObj(e)})}url(e){return this._addCheck({kind:"url",...f.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...f.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...f.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...f.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...f.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...f.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...f.errToObj(e)})}datetime(e){var t;return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof e?.precision>"u"?null:e?.precision,offset:(t=e?.offset)!==null&&t!==void 0?t:!1,...f.errToObj(e?.message)})}regex(e,t){return this._addCheck({kind:"regex",regex:e,...f.errToObj(t)})}includes(e,t){return this._addCheck({kind:"includes",value:e,position:t?.position,...f.errToObj(t?.message)})}startsWith(e,t){return this._addCheck({kind:"startsWith",value:e,...f.errToObj(t)})}endsWith(e,t){return this._addCheck({kind:"endsWith",value:e,...f.errToObj(t)})}min(e,t){return this._addCheck({kind:"min",value:e,...f.errToObj(t)})}max(e,t){return this._addCheck({kind:"max",value:e,...f.errToObj(t)})}length(e,t){return this._addCheck({kind:"length",value:e,...f.errToObj(t)})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get minLength(){let e=null;for(let t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(let t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}};N.create=n=>{var e;return new N({checks:[],typeName:y.ZodString,coerce:(e=n?.coerce)!==null&&e!==void 0?e:!1,...b(n)})};function va(n,e){let t=(n.toString().split(".")[1]||"").length,a=(e.toString().split(".")[1]||"").length,s=t>a?t:a,o=parseInt(n.toFixed(s).replace(".","")),i=parseInt(e.toFixed(s).replace(".",""));return o%i/Math.pow(10,s)}var Z=class extends S{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==m.number){let o=this._getOrReturnCtx(e);return h(o,{code:p.invalid_type,expected:m.number,received:o.parsedType}),v}let a,s=new T;for(let o of this._def.checks)o.kind==="int"?C.isInteger(e.data)||(a=this._getOrReturnCtx(e,a),h(a,{code:p.invalid_type,expected:"integer",received:"float",message:o.message}),s.dirty()):o.kind==="min"?(o.inclusive?e.data<o.value:e.data<=o.value)&&(a=this._getOrReturnCtx(e,a),h(a,{code:p.too_small,minimum:o.value,type:"number",inclusive:o.inclusive,exact:!1,message:o.message}),s.dirty()):o.kind==="max"?(o.inclusive?e.data>o.value:e.data>=o.value)&&(a=this._getOrReturnCtx(e,a),h(a,{code:p.too_big,maximum:o.value,type:"number",inclusive:o.inclusive,exact:!1,message:o.message}),s.dirty()):o.kind==="multipleOf"?va(e.data,o.value)!==0&&(a=this._getOrReturnCtx(e,a),h(a,{code:p.not_multiple_of,multipleOf:o.value,message:o.message}),s.dirty()):o.kind==="finite"?Number.isFinite(e.data)||(a=this._getOrReturnCtx(e,a),h(a,{code:p.not_finite,message:o.message}),s.dirty()):C.assertNever(o);return{status:s.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,f.toString(t))}gt(e,t){return this.setLimit("min",e,!1,f.toString(t))}lte(e,t){return this.setLimit("max",e,!0,f.toString(t))}lt(e,t){return this.setLimit("max",e,!1,f.toString(t))}setLimit(e,t,a,s){return new Z({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:a,message:f.toString(s)}]})}_addCheck(e){return new Z({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:f.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:f.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:f.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:f.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:f.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:f.toString(t)})}finite(e){return this._addCheck({kind:"finite",message:f.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:f.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:f.toString(e)})}get minValue(){let e=null;for(let t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(let t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&C.isInteger(e.value))}get isFinite(){let e=null,t=null;for(let a of this._def.checks){if(a.kind==="finite"||a.kind==="int"||a.kind==="multipleOf")return!0;a.kind==="min"?(t===null||a.value>t)&&(t=a.value):a.kind==="max"&&(e===null||a.value<e)&&(e=a.value)}return Number.isFinite(t)&&Number.isFinite(e)}};Z.create=n=>new Z({checks:[],typeName:y.ZodNumber,coerce:n?.coerce||!1,...b(n)});var H=class extends S{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce&&(e.data=BigInt(e.data)),this._getType(e)!==m.bigint){let o=this._getOrReturnCtx(e);return h(o,{code:p.invalid_type,expected:m.bigint,received:o.parsedType}),v}let a,s=new T;for(let o of this._def.checks)o.kind==="min"?(o.inclusive?e.data<o.value:e.data<=o.value)&&(a=this._getOrReturnCtx(e,a),h(a,{code:p.too_small,type:"bigint",minimum:o.value,inclusive:o.inclusive,message:o.message}),s.dirty()):o.kind==="max"?(o.inclusive?e.data>o.value:e.data>=o.value)&&(a=this._getOrReturnCtx(e,a),h(a,{code:p.too_big,type:"bigint",maximum:o.value,inclusive:o.inclusive,message:o.message}),s.dirty()):o.kind==="multipleOf"?e.data%o.value!==BigInt(0)&&(a=this._getOrReturnCtx(e,a),h(a,{code:p.not_multiple_of,multipleOf:o.value,message:o.message}),s.dirty()):C.assertNever(o);return{status:s.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,f.toString(t))}gt(e,t){return this.setLimit("min",e,!1,f.toString(t))}lte(e,t){return this.setLimit("max",e,!0,f.toString(t))}lt(e,t){return this.setLimit("max",e,!1,f.toString(t))}setLimit(e,t,a,s){return new H({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:a,message:f.toString(s)}]})}_addCheck(e){return new H({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:f.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:f.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:f.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:f.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:f.toString(t)})}get minValue(){let e=null;for(let t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(let t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}};H.create=n=>{var e;return new H({checks:[],typeName:y.ZodBigInt,coerce:(e=n?.coerce)!==null&&e!==void 0?e:!1,...b(n)})};var me=class extends S{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==m.boolean){let a=this._getOrReturnCtx(e);return h(a,{code:p.invalid_type,expected:m.boolean,received:a.parsedType}),v}return E(e.data)}};me.create=n=>new me({typeName:y.ZodBoolean,coerce:n?.coerce||!1,...b(n)});var K=class extends S{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==m.date){let o=this._getOrReturnCtx(e);return h(o,{code:p.invalid_type,expected:m.date,received:o.parsedType}),v}if(isNaN(e.data.getTime())){let o=this._getOrReturnCtx(e);return h(o,{code:p.invalid_date}),v}let a=new T,s;for(let o of this._def.checks)o.kind==="min"?e.data.getTime()<o.value&&(s=this._getOrReturnCtx(e,s),h(s,{code:p.too_small,message:o.message,inclusive:!0,exact:!1,minimum:o.value,type:"date"}),a.dirty()):o.kind==="max"?e.data.getTime()>o.value&&(s=this._getOrReturnCtx(e,s),h(s,{code:p.too_big,message:o.message,inclusive:!0,exact:!1,maximum:o.value,type:"date"}),a.dirty()):C.assertNever(o);return{status:a.value,value:new Date(e.data.getTime())}}_addCheck(e){return new K({...this._def,checks:[...this._def.checks,e]})}min(e,t){return this._addCheck({kind:"min",value:e.getTime(),message:f.toString(t)})}max(e,t){return this._addCheck({kind:"max",value:e.getTime(),message:f.toString(t)})}get minDate(){let e=null;for(let t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(let t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e!=null?new Date(e):null}};K.create=n=>new K({checks:[],coerce:n?.coerce||!1,typeName:y.ZodDate,...b(n)});var Ae=class extends S{_parse(e){if(this._getType(e)!==m.symbol){let a=this._getOrReturnCtx(e);return h(a,{code:p.invalid_type,expected:m.symbol,received:a.parsedType}),v}return E(e.data)}};Ae.create=n=>new Ae({typeName:y.ZodSymbol,...b(n)});var he=class extends S{_parse(e){if(this._getType(e)!==m.undefined){let a=this._getOrReturnCtx(e);return h(a,{code:p.invalid_type,expected:m.undefined,received:a.parsedType}),v}return E(e.data)}};he.create=n=>new he({typeName:y.ZodUndefined,...b(n)});var fe=class extends S{_parse(e){if(this._getType(e)!==m.null){let a=this._getOrReturnCtx(e);return h(a,{code:p.invalid_type,expected:m.null,received:a.parsedType}),v}return E(e.data)}};fe.create=n=>new fe({typeName:y.ZodNull,...b(n)});var se=class extends S{constructor(){super(...arguments),this._any=!0}_parse(e){return E(e.data)}};se.create=n=>new se({typeName:y.ZodAny,...b(n)});var Y=class extends S{constructor(){super(...arguments),this._unknown=!0}_parse(e){return E(e.data)}};Y.create=n=>new Y({typeName:y.ZodUnknown,...b(n)});var V=class extends S{_parse(e){let t=this._getOrReturnCtx(e);return h(t,{code:p.invalid_type,expected:m.never,received:t.parsedType}),v}};V.create=n=>new V({typeName:y.ZodNever,...b(n)});var Me=class extends S{_parse(e){if(this._getType(e)!==m.undefined){let a=this._getOrReturnCtx(e);return h(a,{code:p.invalid_type,expected:m.void,received:a.parsedType}),v}return E(e.data)}};Me.create=n=>new Me({typeName:y.ZodVoid,...b(n)});var P=class extends S{_parse(e){let{ctx:t,status:a}=this._processInputParams(e),s=this._def;if(t.parsedType!==m.array)return h(t,{code:p.invalid_type,expected:m.array,received:t.parsedType}),v;if(s.exactLength!==null){let i=t.data.length>s.exactLength.value,d=t.data.length<s.exactLength.value;(i||d)&&(h(t,{code:i?p.too_big:p.too_small,minimum:d?s.exactLength.value:void 0,maximum:i?s.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:s.exactLength.message}),a.dirty())}if(s.minLength!==null&&t.data.length<s.minLength.value&&(h(t,{code:p.too_small,minimum:s.minLength.value,type:"array",inclusive:!0,exact:!1,message:s.minLength.message}),a.dirty()),s.maxLength!==null&&t.data.length>s.maxLength.value&&(h(t,{code:p.too_big,maximum:s.maxLength.value,type:"array",inclusive:!0,exact:!1,message:s.maxLength.message}),a.dirty()),t.common.async)return Promise.all([...t.data].map((i,d)=>s.type._parseAsync(new F(t,i,t.path,d)))).then(i=>T.mergeArray(a,i));let o=[...t.data].map((i,d)=>s.type._parseSync(new F(t,i,t.path,d)));return T.mergeArray(a,o)}get element(){return this._def.type}min(e,t){return new P({...this._def,minLength:{value:e,message:f.toString(t)}})}max(e,t){return new P({...this._def,maxLength:{value:e,message:f.toString(t)}})}length(e,t){return new P({...this._def,exactLength:{value:e,message:f.toString(t)}})}nonempty(e){return this.min(1,e)}};P.create=(n,e)=>new P({type:n,minLength:null,maxLength:null,exactLength:null,typeName:y.ZodArray,...b(e)});function Pe(n){if(n instanceof k){let e={};for(let t in n.shape){let a=n.shape[t];e[t]=$.create(Pe(a))}return new k({...n._def,shape:()=>e})}else return n instanceof P?new P({...n._def,type:Pe(n.element)}):n instanceof $?$.create(Pe(n.unwrap())):n instanceof ee?ee.create(Pe(n.unwrap())):n instanceof z?z.create(n.items.map(e=>Pe(e))):n}var k=class extends S{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;let e=this._def.shape(),t=C.objectKeys(e);return this._cached={shape:e,keys:t}}_parse(e){if(this._getType(e)!==m.object){let u=this._getOrReturnCtx(e);return h(u,{code:p.invalid_type,expected:m.object,received:u.parsedType}),v}let{status:a,ctx:s}=this._processInputParams(e),{shape:o,keys:i}=this._getCached(),d=[];if(!(this._def.catchall instanceof V&&this._def.unknownKeys==="strip"))for(let u in s.data)i.includes(u)||d.push(u);let c=[];for(let u of i){let l=o[u],g=s.data[u];c.push({key:{status:"valid",value:u},value:l._parse(new F(s,g,s.path,u)),alwaysSet:u in s.data})}if(this._def.catchall instanceof V){let u=this._def.unknownKeys;if(u==="passthrough")for(let l of d)c.push({key:{status:"valid",value:l},value:{status:"valid",value:s.data[l]}});else if(u==="strict")d.length>0&&(h(s,{code:p.unrecognized_keys,keys:d}),a.dirty());else if(u!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{let u=this._def.catchall;for(let l of d){let g=s.data[l];c.push({key:{status:"valid",value:l},value:u._parse(new F(s,g,s.path,l)),alwaysSet:l in s.data})}}return s.common.async?Promise.resolve().then(async()=>{let u=[];for(let l of c){let g=await l.key;u.push({key:g,value:await l.value,alwaysSet:l.alwaysSet})}return u}).then(u=>T.mergeObjectSync(a,u)):T.mergeObjectSync(a,c)}get shape(){return this._def.shape()}strict(e){return f.errToObj,new k({...this._def,unknownKeys:"strict",...e!==void 0?{errorMap:(t,a)=>{var s,o,i,d;let c=(i=(o=(s=this._def).errorMap)===null||o===void 0?void 0:o.call(s,t,a).message)!==null&&i!==void 0?i:a.defaultError;return t.code==="unrecognized_keys"?{message:(d=f.errToObj(e).message)!==null&&d!==void 0?d:c}:{message:c}}}:{}})}strip(){return new k({...this._def,unknownKeys:"strip"})}passthrough(){return new k({...this._def,unknownKeys:"passthrough"})}extend(e){return new k({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new k({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:y.ZodObject})}setKey(e,t){return this.augment({[e]:t})}catchall(e){return new k({...this._def,catchall:e})}pick(e){let t={};return C.objectKeys(e).forEach(a=>{e[a]&&this.shape[a]&&(t[a]=this.shape[a])}),new k({...this._def,shape:()=>t})}omit(e){let t={};return C.objectKeys(this.shape).forEach(a=>{e[a]||(t[a]=this.shape[a])}),new k({...this._def,shape:()=>t})}deepPartial(){return Pe(this)}partial(e){let t={};return C.objectKeys(this.shape).forEach(a=>{let s=this.shape[a];e&&!e[a]?t[a]=s:t[a]=s.optional()}),new k({...this._def,shape:()=>t})}required(e){let t={};return C.objectKeys(this.shape).forEach(a=>{if(e&&!e[a])t[a]=this.shape[a];else{let o=this.shape[a];for(;o instanceof $;)o=o._def.innerType;t[a]=o}}),new k({...this._def,shape:()=>t})}keyof(){return Pr(C.objectKeys(this.shape))}};k.create=(n,e)=>new k({shape:()=>n,unknownKeys:"strip",catchall:V.create(),typeName:y.ZodObject,...b(e)});k.strictCreate=(n,e)=>new k({shape:()=>n,unknownKeys:"strict",catchall:V.create(),typeName:y.ZodObject,...b(e)});k.lazycreate=(n,e)=>new k({shape:n,unknownKeys:"strip",catchall:V.create(),typeName:y.ZodObject,...b(e)});var ge=class extends S{_parse(e){let{ctx:t}=this._processInputParams(e),a=this._def.options;function s(o){for(let d of o)if(d.result.status==="valid")return d.result;for(let d of o)if(d.result.status==="dirty")return t.common.issues.push(...d.ctx.common.issues),d.result;let i=o.map(d=>new O(d.ctx.common.issues));return h(t,{code:p.invalid_union,unionErrors:i}),v}if(t.common.async)return Promise.all(a.map(async o=>{let i={...t,common:{...t.common,issues:[]},parent:null};return{result:await o._parseAsync({data:t.data,path:t.path,parent:i}),ctx:i}})).then(s);{let o,i=[];for(let c of a){let u={...t,common:{...t.common,issues:[]},parent:null},l=c._parseSync({data:t.data,path:t.path,parent:u});if(l.status==="valid")return l;l.status==="dirty"&&!o&&(o={result:l,ctx:u}),u.common.issues.length&&i.push(u.common.issues)}if(o)return t.common.issues.push(...o.ctx.common.issues),o.result;let d=i.map(c=>new O(c));return h(t,{code:p.invalid_union,unionErrors:d}),v}}get options(){return this._def.options}};ge.create=(n,e)=>new ge({options:n,typeName:y.ZodUnion,...b(e)});var nt=n=>n instanceof be?nt(n.schema):n instanceof A?nt(n.innerType()):n instanceof Se?[n.value]:n instanceof G?n.options:n instanceof xe?Object.keys(n.enum):n instanceof Ce?nt(n._def.innerType):n instanceof he?[void 0]:n instanceof fe?[null]:null,De=class extends S{_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==m.object)return h(t,{code:p.invalid_type,expected:m.object,received:t.parsedType}),v;let a=this.discriminator,s=t.data[a],o=this.optionsMap.get(s);return o?t.common.async?o._parseAsync({data:t.data,path:t.path,parent:t}):o._parseSync({data:t.data,path:t.path,parent:t}):(h(t,{code:p.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[a]}),v)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,t,a){let s=new Map;for(let o of t){let i=nt(o.shape[e]);if(!i)throw new Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(let d of i){if(s.has(d))throw new Error(`Discriminator property ${String(e)} has duplicate value ${String(d)}`);s.set(d,o)}}return new De({typeName:y.ZodDiscriminatedUnion,discriminator:e,options:t,optionsMap:s,...b(a)})}};function qt(n,e){let t=ne(n),a=ne(e);if(n===e)return{valid:!0,data:n};if(t===m.object&&a===m.object){let s=C.objectKeys(e),o=C.objectKeys(n).filter(d=>s.indexOf(d)!==-1),i={...n,...e};for(let d of o){let c=qt(n[d],e[d]);if(!c.valid)return{valid:!1};i[d]=c.data}return{valid:!0,data:i}}else if(t===m.array&&a===m.array){if(n.length!==e.length)return{valid:!1};let s=[];for(let o=0;o<n.length;o++){let i=n[o],d=e[o],c=qt(i,d);if(!c.valid)return{valid:!1};s.push(c.data)}return{valid:!0,data:s}}else return t===m.date&&a===m.date&&+n==+e?{valid:!0,data:n}:{valid:!1}}var ye=class extends S{_parse(e){let{status:t,ctx:a}=this._processInputParams(e),s=(o,i)=>{if(Lt(o)||Lt(i))return v;let d=qt(o.value,i.value);return d.valid?((jt(o)||jt(i))&&t.dirty(),{status:t.value,value:d.data}):(h(a,{code:p.invalid_intersection_types}),v)};return a.common.async?Promise.all([this._def.left._parseAsync({data:a.data,path:a.path,parent:a}),this._def.right._parseAsync({data:a.data,path:a.path,parent:a})]).then(([o,i])=>s(o,i)):s(this._def.left._parseSync({data:a.data,path:a.path,parent:a}),this._def.right._parseSync({data:a.data,path:a.path,parent:a}))}};ye.create=(n,e,t)=>new ye({left:n,right:e,typeName:y.ZodIntersection,...b(t)});var z=class extends S{_parse(e){let{status:t,ctx:a}=this._processInputParams(e);if(a.parsedType!==m.array)return h(a,{code:p.invalid_type,expected:m.array,received:a.parsedType}),v;if(a.data.length<this._def.items.length)return h(a,{code:p.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),v;!this._def.rest&&a.data.length>this._def.items.length&&(h(a,{code:p.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),t.dirty());let o=[...a.data].map((i,d)=>{let c=this._def.items[d]||this._def.rest;return c?c._parse(new F(a,i,a.path,d)):null}).filter(i=>!!i);return a.common.async?Promise.all(o).then(i=>T.mergeArray(t,i)):T.mergeArray(t,o)}get items(){return this._def.items}rest(e){return new z({...this._def,rest:e})}};z.create=(n,e)=>{if(!Array.isArray(n))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new z({items:n,typeName:y.ZodTuple,rest:null,...b(e)})};var ve=class extends S{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:t,ctx:a}=this._processInputParams(e);if(a.parsedType!==m.object)return h(a,{code:p.invalid_type,expected:m.object,received:a.parsedType}),v;let s=[],o=this._def.keyType,i=this._def.valueType;for(let d in a.data)s.push({key:o._parse(new F(a,d,a.path,d)),value:i._parse(new F(a,a.data[d],a.path,d))});return a.common.async?T.mergeObjectAsync(t,s):T.mergeObjectSync(t,s)}get element(){return this._def.valueType}static create(e,t,a){return t instanceof S?new ve({keyType:e,valueType:t,typeName:y.ZodRecord,...b(a)}):new ve({keyType:N.create(),valueType:e,typeName:y.ZodRecord,...b(t)})}},Le=class extends S{_parse(e){let{status:t,ctx:a}=this._processInputParams(e);if(a.parsedType!==m.map)return h(a,{code:p.invalid_type,expected:m.map,received:a.parsedType}),v;let s=this._def.keyType,o=this._def.valueType,i=[...a.data.entries()].map(([d,c],u)=>({key:s._parse(new F(a,d,a.path,[u,"key"])),value:o._parse(new F(a,c,a.path,[u,"value"]))}));if(a.common.async){let d=new Map;return Promise.resolve().then(async()=>{for(let c of i){let u=await c.key,l=await c.value;if(u.status==="aborted"||l.status==="aborted")return v;(u.status==="dirty"||l.status==="dirty")&&t.dirty(),d.set(u.value,l.value)}return{status:t.value,value:d}})}else{let d=new Map;for(let c of i){let u=c.key,l=c.value;if(u.status==="aborted"||l.status==="aborted")return v;(u.status==="dirty"||l.status==="dirty")&&t.dirty(),d.set(u.value,l.value)}return{status:t.value,value:d}}}};Le.create=(n,e,t)=>new Le({valueType:e,keyType:n,typeName:y.ZodMap,...b(t)});var Q=class extends S{_parse(e){let{status:t,ctx:a}=this._processInputParams(e);if(a.parsedType!==m.set)return h(a,{code:p.invalid_type,expected:m.set,received:a.parsedType}),v;let s=this._def;s.minSize!==null&&a.data.size<s.minSize.value&&(h(a,{code:p.too_small,minimum:s.minSize.value,type:"set",inclusive:!0,exact:!1,message:s.minSize.message}),t.dirty()),s.maxSize!==null&&a.data.size>s.maxSize.value&&(h(a,{code:p.too_big,maximum:s.maxSize.value,type:"set",inclusive:!0,exact:!1,message:s.maxSize.message}),t.dirty());let o=this._def.valueType;function i(c){let u=new Set;for(let l of c){if(l.status==="aborted")return v;l.status==="dirty"&&t.dirty(),u.add(l.value)}return{status:t.value,value:u}}let d=[...a.data.values()].map((c,u)=>o._parse(new F(a,c,a.path,u)));return a.common.async?Promise.all(d).then(c=>i(c)):i(d)}min(e,t){return new Q({...this._def,minSize:{value:e,message:f.toString(t)}})}max(e,t){return new Q({...this._def,maxSize:{value:e,message:f.toString(t)}})}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}};Q.create=(n,e)=>new Q({valueType:n,minSize:null,maxSize:null,typeName:y.ZodSet,...b(e)});var ae=class extends S{constructor(){super(...arguments),this.validate=this.implement}_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==m.function)return h(t,{code:p.invalid_type,expected:m.function,received:t.parsedType}),v;function a(d,c){return st({data:d,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,at(),He].filter(u=>!!u),issueData:{code:p.invalid_arguments,argumentsError:c}})}function s(d,c){return st({data:d,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,at(),He].filter(u=>!!u),issueData:{code:p.invalid_return_type,returnTypeError:c}})}let o={errorMap:t.common.contextualErrorMap},i=t.data;return this._def.returns instanceof oe?E(async(...d)=>{let c=new O([]),u=await this._def.args.parseAsync(d,o).catch(x=>{throw c.addIssue(a(d,x)),c}),l=await i(...u);return await this._def.returns._def.type.parseAsync(l,o).catch(x=>{throw c.addIssue(s(l,x)),c})}):E((...d)=>{let c=this._def.args.safeParse(d,o);if(!c.success)throw new O([a(d,c.error)]);let u=i(...c.data),l=this._def.returns.safeParse(u,o);if(!l.success)throw new O([s(u,l.error)]);return l.data})}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new ae({...this._def,args:z.create(e).rest(Y.create())})}returns(e){return new ae({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,t,a){return new ae({args:e||z.create([]).rest(Y.create()),returns:t||Y.create(),typeName:y.ZodFunction,...b(a)})}},be=class extends S{get schema(){return this._def.getter()}_parse(e){let{ctx:t}=this._processInputParams(e);return this._def.getter()._parse({data:t.data,path:t.path,parent:t})}};be.create=(n,e)=>new be({getter:n,typeName:y.ZodLazy,...b(e)});var Se=class extends S{_parse(e){if(e.data!==this._def.value){let t=this._getOrReturnCtx(e);return h(t,{received:t.data,code:p.invalid_literal,expected:this._def.value}),v}return{status:"valid",value:e.data}}get value(){return this._def.value}};Se.create=(n,e)=>new Se({value:n,typeName:y.ZodLiteral,...b(e)});function Pr(n,e){return new G({values:n,typeName:y.ZodEnum,...b(e)})}var G=class extends S{_parse(e){if(typeof e.data!="string"){let t=this._getOrReturnCtx(e),a=this._def.values;return h(t,{expected:C.joinValues(a),received:t.parsedType,code:p.invalid_type}),v}if(this._def.values.indexOf(e.data)===-1){let t=this._getOrReturnCtx(e),a=this._def.values;return h(t,{received:t.data,code:p.invalid_enum_value,options:a}),v}return E(e.data)}get options(){return this._def.values}get enum(){let e={};for(let t of this._def.values)e[t]=t;return e}get Values(){let e={};for(let t of this._def.values)e[t]=t;return e}get Enum(){let e={};for(let t of this._def.values)e[t]=t;return e}extract(e){return G.create(e)}exclude(e){return G.create(this.options.filter(t=>!e.includes(t)))}};G.create=Pr;var xe=class extends S{_parse(e){let t=C.getValidEnumValues(this._def.values),a=this._getOrReturnCtx(e);if(a.parsedType!==m.string&&a.parsedType!==m.number){let s=C.objectValues(t);return h(a,{expected:C.joinValues(s),received:a.parsedType,code:p.invalid_type}),v}if(t.indexOf(e.data)===-1){let s=C.objectValues(t);return h(a,{received:a.data,code:p.invalid_enum_value,options:s}),v}return E(e.data)}get enum(){return this._def.values}};xe.create=(n,e)=>new xe({values:n,typeName:y.ZodNativeEnum,...b(e)});var oe=class extends S{unwrap(){return this._def.type}_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==m.promise&&t.common.async===!1)return h(t,{code:p.invalid_type,expected:m.promise,received:t.parsedType}),v;let a=t.parsedType===m.promise?t.data:Promise.resolve(t.data);return E(a.then(s=>this._def.type.parseAsync(s,{path:t.path,errorMap:t.common.contextualErrorMap})))}};oe.create=(n,e)=>new oe({type:n,typeName:y.ZodPromise,...b(e)});var A=class extends S{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===y.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){let{status:t,ctx:a}=this._processInputParams(e),s=this._def.effect||null;if(s.type==="preprocess"){let i=s.transform(a.data);return a.common.async?Promise.resolve(i).then(d=>this._def.schema._parseAsync({data:d,path:a.path,parent:a})):this._def.schema._parseSync({data:i,path:a.path,parent:a})}let o={addIssue:i=>{h(a,i),i.fatal?t.abort():t.dirty()},get path(){return a.path}};if(o.addIssue=o.addIssue.bind(o),s.type==="refinement"){let i=d=>{let c=s.refinement(d,o);if(a.common.async)return Promise.resolve(c);if(c instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return d};if(a.common.async===!1){let d=this._def.schema._parseSync({data:a.data,path:a.path,parent:a});return d.status==="aborted"?v:(d.status==="dirty"&&t.dirty(),i(d.value),{status:t.value,value:d.value})}else return this._def.schema._parseAsync({data:a.data,path:a.path,parent:a}).then(d=>d.status==="aborted"?v:(d.status==="dirty"&&t.dirty(),i(d.value).then(()=>({status:t.value,value:d.value}))))}if(s.type==="transform")if(a.common.async===!1){let i=this._def.schema._parseSync({data:a.data,path:a.path,parent:a});if(!ot(i))return i;let d=s.transform(i.value,o);if(d instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:t.value,value:d}}else return this._def.schema._parseAsync({data:a.data,path:a.path,parent:a}).then(i=>ot(i)?Promise.resolve(s.transform(i.value,o)).then(d=>({status:t.value,value:d})):i);C.assertNever(s)}};A.create=(n,e,t)=>new A({schema:n,typeName:y.ZodEffects,effect:e,...b(t)});A.createWithPreprocess=(n,e,t)=>new A({schema:e,effect:{type:"preprocess",transform:n},typeName:y.ZodEffects,...b(t)});var $=class extends S{_parse(e){return this._getType(e)===m.undefined?E(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}};$.create=(n,e)=>new $({innerType:n,typeName:y.ZodOptional,...b(e)});var ee=class extends S{_parse(e){return this._getType(e)===m.null?E(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}};ee.create=(n,e)=>new ee({innerType:n,typeName:y.ZodNullable,...b(e)});var Ce=class extends S{_parse(e){let{ctx:t}=this._processInputParams(e),a=t.data;return t.parsedType===m.undefined&&(a=this._def.defaultValue()),this._def.innerType._parse({data:a,path:t.path,parent:t})}removeDefault(){return this._def.innerType}};Ce.create=(n,e)=>new Ce({innerType:n,typeName:y.ZodDefault,defaultValue:typeof e.default=="function"?e.default:()=>e.default,...b(e)});var je=class extends S{_parse(e){let{ctx:t}=this._processInputParams(e),a={...t,common:{...t.common,issues:[]}},s=this._def.innerType._parse({data:a.data,path:a.path,parent:{...a}});return it(s)?s.then(o=>({status:"valid",value:o.status==="valid"?o.value:this._def.catchValue({get error(){return new O(a.common.issues)},input:a.data})})):{status:"valid",value:s.status==="valid"?s.value:this._def.catchValue({get error(){return new O(a.common.issues)},input:a.data})}}removeCatch(){return this._def.innerType}};je.create=(n,e)=>new je({innerType:n,typeName:y.ZodCatch,catchValue:typeof e.catch=="function"?e.catch:()=>e.catch,...b(e)});var qe=class extends S{_parse(e){if(this._getType(e)!==m.nan){let a=this._getOrReturnCtx(e);return h(a,{code:p.invalid_type,expected:m.nan,received:a.parsedType}),v}return{status:"valid",value:e.data}}};qe.create=n=>new qe({typeName:y.ZodNaN,...b(n)});var ba=Symbol("zod_brand"),dt=class extends S{_parse(e){let{ctx:t}=this._processInputParams(e),a=t.data;return this._def.type._parse({data:a,path:t.path,parent:t})}unwrap(){return this._def.type}},ke=class extends S{_parse(e){let{status:t,ctx:a}=this._processInputParams(e);if(a.common.async)return(async()=>{let o=await this._def.in._parseAsync({data:a.data,path:a.path,parent:a});return o.status==="aborted"?v:o.status==="dirty"?(t.dirty(),Or(o.value)):this._def.out._parseAsync({data:o.value,path:a.path,parent:a})})();{let s=this._def.in._parseSync({data:a.data,path:a.path,parent:a});return s.status==="aborted"?v:s.status==="dirty"?(t.dirty(),{status:"dirty",value:s.value}):this._def.out._parseSync({data:s.value,path:a.path,parent:a})}}static create(e,t){return new ke({in:e,out:t,typeName:y.ZodPipeline})}},Ar=(n,e={},t)=>n?se.create().superRefine((a,s)=>{var o,i;if(!n(a)){let d=typeof e=="function"?e(a):typeof e=="string"?{message:e}:e,c=(i=(o=d.fatal)!==null&&o!==void 0?o:t)!==null&&i!==void 0?i:!0,u=typeof d=="string"?{message:d}:d;s.addIssue({code:"custom",...u,fatal:c})}}):se.create(),Sa={object:k.lazycreate},y;(function(n){n.ZodString="ZodString",n.ZodNumber="ZodNumber",n.ZodNaN="ZodNaN",n.ZodBigInt="ZodBigInt",n.ZodBoolean="ZodBoolean",n.ZodDate="ZodDate",n.ZodSymbol="ZodSymbol",n.ZodUndefined="ZodUndefined",n.ZodNull="ZodNull",n.ZodAny="ZodAny",n.ZodUnknown="ZodUnknown",n.ZodNever="ZodNever",n.ZodVoid="ZodVoid",n.ZodArray="ZodArray",n.ZodObject="ZodObject",n.ZodUnion="ZodUnion",n.ZodDiscriminatedUnion="ZodDiscriminatedUnion",n.ZodIntersection="ZodIntersection",n.ZodTuple="ZodTuple",n.ZodRecord="ZodRecord",n.ZodMap="ZodMap",n.ZodSet="ZodSet",n.ZodFunction="ZodFunction",n.ZodLazy="ZodLazy",n.ZodLiteral="ZodLiteral",n.ZodEnum="ZodEnum",n.ZodEffects="ZodEffects",n.ZodNativeEnum="ZodNativeEnum",n.ZodOptional="ZodOptional",n.ZodNullable="ZodNullable",n.ZodDefault="ZodDefault",n.ZodCatch="ZodCatch",n.ZodPromise="ZodPromise",n.ZodBranded="ZodBranded",n.ZodPipeline="ZodPipeline"})(y||(y={}));var xa=(n,e={message:`Input not instance of ${n.name}`})=>Ar(t=>t instanceof n,e),Mr=N.create,Dr=Z.create,Ca=qe.create,ka=H.create,Lr=me.create,_a=K.create,Ta=Ae.create,wa=he.create,Ea=fe.create,Ia=se.create,Ra=Y.create,Na=V.create,Oa=Me.create,Pa=P.create,Aa=k.create,Ma=k.strictCreate,Da=ge.create,La=De.create,ja=ye.create,qa=z.create,Fa=ve.create,za=Le.create,Ba=Q.create,Ua=ae.create,$a=be.create,Va=Se.create,Wa=G.create,Za=xe.create,Ha=oe.create,Rr=A.create,Ga=$.create,Xa=ee.create,Ja=A.createWithPreprocess,Ya=ke.create,Ka=()=>Mr().optional(),Qa=()=>Dr().optional(),es=()=>Lr().optional(),ts={string:n=>N.create({...n,coerce:!0}),number:n=>Z.create({...n,coerce:!0}),boolean:n=>me.create({...n,coerce:!0}),bigint:n=>H.create({...n,coerce:!0}),date:n=>K.create({...n,coerce:!0})},rs=v,r=Object.freeze({__proto__:null,defaultErrorMap:He,setErrorMap:oa,getErrorMap:at,makeIssue:st,EMPTY_PATH:ia,addIssueToContext:h,ParseStatus:T,INVALID:v,DIRTY:Or,OK:E,isAborted:Lt,isDirty:jt,isValid:ot,isAsync:it,get util(){return C},get objectUtil(){return Dt},ZodParsedType:m,getParsedType:ne,ZodType:S,ZodString:N,ZodNumber:Z,ZodBigInt:H,ZodBoolean:me,ZodDate:K,ZodSymbol:Ae,ZodUndefined:he,ZodNull:fe,ZodAny:se,ZodUnknown:Y,ZodNever:V,ZodVoid:Me,ZodArray:P,ZodObject:k,ZodUnion:ge,ZodDiscriminatedUnion:De,ZodIntersection:ye,ZodTuple:z,ZodRecord:ve,ZodMap:Le,ZodSet:Q,ZodFunction:ae,ZodLazy:be,ZodLiteral:Se,ZodEnum:G,ZodNativeEnum:xe,ZodPromise:oe,ZodEffects:A,ZodTransformer:A,ZodOptional:$,ZodNullable:ee,ZodDefault:Ce,ZodCatch:je,ZodNaN:qe,BRAND:ba,ZodBranded:dt,ZodPipeline:ke,custom:Ar,Schema:S,ZodSchema:S,late:Sa,get ZodFirstPartyTypeKind(){return y},coerce:ts,any:Ia,array:Pa,bigint:ka,boolean:Lr,date:_a,discriminatedUnion:La,effect:Rr,enum:Wa,function:Ua,instanceof:xa,intersection:ja,lazy:$a,literal:Va,map:za,nan:Ca,nativeEnum:Za,never:Na,null:Ea,nullable:Xa,number:Dr,object:Aa,oboolean:es,onumber:Qa,optional:Ga,ostring:Ka,pipeline:Ya,preprocess:Ja,promise:Ha,record:Fa,set:Ba,strictObject:Ma,string:Mr,symbol:Ta,transformer:Rr,tuple:qa,undefined:wa,union:Da,unknown:Ra,void:Oa,NEVER:rs,ZodIssueCode:p,quotelessJson:sa,ZodError:O});var ns=r.object({name:r.string(),type:r.enum(["object","function","undefined","string","number","boolean","symbol","bigint","accessor"]).or(r.string()),value:r.string().optional(),valuePreview:r.lazy(()=>ct).optional(),subtype:r.enum(["array","node","null","regexp","date","map","set","weakmap","weakset","iterator","generator","error","proxy","promise","typedarray","arraybuffer","dataview","webassemblymemory","wasmvalue"]).or(r.string()).optional()}),as=r.object({type:r.enum(["object","function","undefined","string","number","boolean","symbol","bigint"]).or(r.string()),subtype:r.enum(["array","node","null","regexp","date","map","set","weakmap","weakset","iterator","generator","error","proxy","promise","typedarray","arraybuffer","dataview","webassemblymemory","wasmvalue"]).or(r.string()).optional(),description:r.string().optional(),overflow:r.boolean()}),ct=as.extend({properties:r.array(ns),entries:r.array(r.object({key:r.lazy(()=>ct).optional(),value:r.lazy(()=>ct)})).optional()}),Fe=r.object({type:r.enum(["object","function","undefined","string","number","boolean","symbol","bigint","wasm"]).or(r.string()),subtype:r.enum(["array","node","null","regexp","date","map","set","weakmap","weakset","iterator","generator","error","proxy","promise","typedarray","arraybuffer","dataview","webassemblymemory","wasmvalue","i32","i64","f32","f64","v128","externref"]).or(r.string()).optional(),className:r.string().optional(),value:r.any().optional(),unserializableValue:r.string().optional(),description:r.string().optional(),objectId:r.string().optional(),preview:ct.optional(),customPreview:r.object({header:r.string().optional(),bodyGetterId:r.string().optional()}).optional()});var ss=r.object({description:r.string().optional(),callFrames:r.array(r.object({functionName:r.string(),scriptId:r.string(),url:r.string(),lineNumber:r.number(),columnNumber:r.number()})),parentId:r.object({id:r.string(),debuggerId:r.string().optional()}).optional()}),te=ss.extend({parent:r.lazy(()=>te).optional()});var jr=r.object({type:r.enum(["error","log","debug","info","warning","dir","dirxml","table","trace","clear","startGroup","startGroupCollapsed","endGroup","assert","profile","profileEnd","count","timeEnd"]),args:r.array(Fe),executionContextId:r.number(),timestamp:r.number(),stackTrace:te.optional(),context:r.string().optional()});var qr=r.object({exceptionDetails:r.object({exceptionId:r.number(),text:r.string(),lineNumber:r.number(),columnNumber:r.number(),scriptId:r.string().optional(),url:r.string().optional(),stackTrace:te.optional(),exception:Fe.optional(),executionContextId:r.number().optional(),exceptionMetaData:r.any().optional()}),timestamp:r.number()});var Fr=r.object({entry:r.object({source:r.enum(["xml","javascript","network","storage","appcache","rendering","security","deprecation","worker","violation","intervention","recommendation","other"]).or(r.string()),level:r.enum(["verbose","info","warning","error"]),text:r.string(),category:r.literal("cors").optional(),timestamp:r.number(),url:r.string().optional(),lineNumber:r.number().optional(),stackTrace:te.optional(),networkRequestId:r.string().optional(),workerId:r.string().optional(),args:r.array(Fe).optional()})});var ie=r.object({absoluteFile:r.string().optional(),column:r.number(),displayFile:r.any().optional(),line:r.number(),originalFile:r.string(),relativeFile:r.string().optional()});var os=r.object({message:r.string(),whitespace:r.string()}),is=ie.extend({fileUrl:r.string(),function:r.string(),whitespace:r.string()}),ds=r.union([os,is]),cs=ie.extend({frame:r.string(),language:r.string().optional().nullable()}),lt=r.object({name:r.string(),message:r.string(),isRecovered:r.boolean().default(!1).optional(),stack:r.string(),parsedStack:r.array(ds).optional(),docsUrl:r.union([r.string(),r.array(r.string())]).optional(),codeFrame:cs.optional()});var ls=r.enum(["req modified","req + res modified","res modified"]),us=r.union([r.literal("---"),r.literal("(canceled)"),r.literal("(aborted)"),r.string()]),zr=r.object({name:r.string(),cardinal:r.number().optional(),ordinal:r.string().optional()}),Br=r.union([r.string(),r.array(r.string()),zr,r.array(zr)]).nullable(),Ft=r.object({id:r.string(),alias:Br.optional(),aliasType:r.enum(["agent","dom","primitive","route","intercept"]).optional(),displayName:r.string().optional(),name:r.string().optional(),message:r.string().optional(),type:r.enum(["parent","child","system"]).optional(),testCurrentRetry:r.number().optional(),state:r.enum(["active","failed","pending","passed","processing","warned"]),referencesAlias:Br.optional(),testId:r.string(),wallClockUpdatedAt:r.string(),snapshots:r.array(r.object({name:r.string().optional(),timestamp:r.number(),elToHighlightSelectors:r.array(r.string()).optional()})).optional(),coords:r.object({top:r.number(),left:r.number(),topCenter:r.number(),leftCenter:r.number(),x:r.number(),y:r.number()}).optional(),scrollBy:r.object({x:r.number(),y:r.number()}).optional(),highlightAttr:r.string().optional()}),ps=r.object({message:r.string().optional(),indicator:r.enum(["successful","pending","aborted","bad"]).optional(),interceptions:r.array(r.object({command:r.enum(["intercept","route"]),alias:r.string().optional(),type:r.enum(["function","stub","spy"])})).optional(),status:r.union([ls,us]).optional(),wentToOrigin:r.boolean().optional()}),ms=Ft.extend({callCount:r.number(),functionName:r.string(),instrument:r.literal("agent")}),hs=Ft.extend({isStubbed:r.boolean(),method:r.string(),numResponses:r.number(),url:r.string(),instrument:r.literal("route")}),fs=r.object({id:r.string(),isGlobalSession:r.boolean(),status:r.enum(["creating","created","restoring","restored","recreating","recreated","failed"])}),gs=Ft.extend({err:lt.optional(),event:r.boolean().optional(),numElements:r.number().optional(),number:r.number().optional(),renderProps:ps.optional(),sessionInfo:fs.optional(),timeout:r.number().optional(),visible:r.boolean().optional(),wallClockStartedAt:r.string().optional(),hookId:r.string(),group:r.string().optional(),groupLevel:r.number().optional(),instrument:r.literal("command")}),Ur=r.discriminatedUnion("instrument",[gs,hs,ms]);var $r=r.boolean();var ys=r.enum(["active","failed","pending","passed","processing","warned"]),vs=r.enum(["before all","before each","after all","after each","test body","studio commands"]),bs=r.object({hookId:r.string(),hookName:vs,invocationDetails:ie.optional()}),zt=r.object({id:r.string(),title:r.string().optional(),hooks:r.array(bs).optional()}),ut=zt.extend({state:ys.optional(),err:lt.optional(),currentRetry:r.number(),retries:r.number().optional(),final:r.boolean().optional(),invocationDetails:ie.optional()}),_e=ut.extend({wallClockStartedAt:r.string()}),Vr=r.object({id:_e.shape.id,state:_e.shape.state,err:_e.shape.err,hookId:r.string().optional(),failedFromHookId:r.string().optional(),currentRetry:_e.shape.currentRetry,retries:_e.shape.retries,wallClockStartedAt:r.string(),wallClockDuration:r.number().optional()});var Ss=r.enum(["before each","before all","after all","after each","test body","studio commands"]),xs=r.union([r.any(),r.undefined()]),Cs=r.object({hookId:r.string(),hookName:Ss,invocationDetails:ie.optional(),isStudio:r.boolean().optional()}),ks=zt.extend({tests:r.array(ut)}),Wr=ks.extend({suites:r.lazy(()=>r.array(Wr))}),Zr=r.object({hooks:r.array(Cs).optional(),tests:r.array(ut).optional(),suites:r.array(Wr).optional(),testFilter:xs.optional(),totalTests:r.number().optional(),totalUnfilteredTests:r.number().optional()});var Hr=r.string();var Gr=r.object({width:r.number(),height:r.number()});var Xr=r.object({id:r.number(),name:r.string(),value:r.string()});var Jr=r.object({id:r.number(),name:r.string()});var Yr=r.object({id:r.number(),characterData:r.string()});var Kr=r.object({elementSelector:r.string(),frameId:r.string(),checked:r.boolean()});var Qr=r.object({scrollX:r.number(),scrollY:r.number(),elementSelector:r.string(),frameId:r.string()});var _s=r.object({id:r.number(),parentId:r.number().optional(),nodeType:r.number(),nodeName:r.string(),localName:r.string(),nodeValue:r.string(),attributes:r.record(r.string(),r.string()).optional(),documentURL:r.string().optional(),baseURL:r.string().optional(),publicId:r.string().optional(),systemId:r.string().optional(),internalSubset:r.string().optional(),name:r.string().optional(),value:r.string().optional(),frameId:r.string().optional(),childNodeCount:r.number().optional(),shadowRootType:r.enum(["closed","open","user-agent"]).or(r.string()).optional(),isSVG:r.boolean().optional(),compatibilityMode:r.enum(["QuirksMode","LimitedQuirksMode","NoQuirksMode"]).or(r.string()).optional(),xmlVersion:r.string().optional()}),Te=_s.extend({children:r.lazy(()=>Te.array()),contentDocument:r.lazy(()=>Te.optional()),shadowRoots:r.lazy(()=>Te.array())});var en=r.object({node:Te});var Bt=r.object({parentId:r.number(),node:Te,previousId:r.number().optional()});var tn=r.object({parentId:r.number(),id:r.number()});var pt=r.object({elementSelector:r.string(),checked:r.boolean(),name:r.string().optional(),frameId:r.string()});var mt=r.object({elementSelector:r.string(),frameId:r.string(),values:r.array(r.string())});var rn=r.object({elementSelector:r.string(),frameId:r.string(),value:r.string()});var nn=r.object({scrollX:r.number(),scrollY:r.number(),frameId:r.string()});var Ts=r.enum(["High","Low","Medium"]).or(r.string()),ws=r.enum(["Lax","None","Strict"]).or(r.string()),Es=r.enum(["NonSecure","Secure","Unset"]).or(r.string()),ht=r.enum(["Local","Private","Public","Unknown"]).or(r.string()),ft=r.object({domain:r.string(),expires:r.number(),httpOnly:r.boolean(),name:r.string(),partitionKey:r.string().optional(),partitionKeyOpaque:r.boolean().optional(),path:r.string(),priority:Ts,sameParty:r.boolean(),sameSite:ws.optional(),secure:r.boolean(),session:r.boolean(),size:r.number(),sourceScheme:Es,sourcePort:r.number(),value:r.string()}),ze=r.enum(["Document","Stylesheet","Image","Media","Font","Script","TextTrack","XHR","Fetch","Prefetch","EventSource","WebSocket","Manifest","SignedExchange","Ping","CSPViolationReport","Preflight","Other"]).or(r.string());var Is=r.enum(["content-type","coep-frame-resource-needs-coep-header","coop-sandboxed-iframe-cannot-navigate-to-coop-page","corp-not-same-origin","corp-not-same-origin-after-defaulted-to-same-origin-by-coep","corp-not-same-site","csp","inspector","mixed-content","other","origin","subresource-filter"]).or(r.string()),Rs=r.enum(["Aborted","AccessDenied","AddressUnreachable","BlockedByClient","BlockedByResponse","ConnectionClosed","ConnectionReset","ConnectionRefused","ConnectionAborted","ConnectionFailed","Failed","InternetDisconnected","NameNotResolved","TimedOut"]).or(r.string()),Ns=r.object({corsError:Rs,failedParameter:r.string()}).optional(),an=r.object({requestId:r.string(),timestamp:r.number(),type:ze,errorText:r.string(),canceled:r.boolean().optional(),blockedReason:Is.optional(),corsErrorStatus:Ns.optional()});var sn=r.object({encodedDataLength:r.number(),requestId:r.string(),timestamp:r.number(),shouldReportCorbBlocking:r.boolean().optional()});var on=r.object({requestId:r.string()});var Os=r.enum(["DomainMismatch","NameValuePairExceedsMaxSize","NotOnPath","SamePartyFromCrossPartyContext","SameSiteStrict","SameSiteLax","SameSiteNoneInsecure","SameSiteUnspecifiedTreatedAsLax","SchemefulSameSiteStrict","SchemefulSameSiteLax","SchemefulSameSiteUnspecifiedTreatedAsLax","SecureOnly","ThirdPartyBlockedInFirstPartySet","UnknownError","UserPreferences"]).or(r.string()),Ps=r.enum(["Allow","BlockFromInsecureToMorePrivate","PreflightBlock","PreflightWarn","WarnFromInsecureToMorePrivate"]).or(r.string()),dn=r.object({associatedCookies:r.array(r.object({blockedReasons:r.array(Os),cookie:ft})),clientSecurityState:r.object({initiatorIsSecureContext:r.boolean(),initiatorIPAddressSpace:ht,privateNetworkRequestPolicy:Ps}).optional(),connectTiming:r.object({requestTime:r.number()}),headers:r.record(r.string(),r.string()),requestId:r.string(),siteHasCookieInOtherPartition:r.boolean().optional()});var cn=r.object({documentURL:r.string(),frameId:r.string().optional(),initiator:r.object({type:r.string(),stack:te.optional(),url:r.string().optional(),lineNumber:r.number().optional(),columnNumber:r.number().optional(),requestId:r.string().optional()}),loaderId:r.string(),request:r.object({url:r.string(),urlFragment:r.string().optional(),method:r.string(),headers:r.record(r.string(),r.string()),postData:r.string().optional(),hasPostData:r.boolean().optional(),postDataEntries:r.array(r.object({bytes:r.string().optional()})).optional(),mixedContentType:r.string().optional(),initialPriority:r.string(),referrerPolicy:r.string(),isLinkPreload:r.boolean().optional(),trustTokenParams:r.object({operation:r.string(),refreshPolicy:r.string(),issuers:r.array(r.string()).optional()}).optional(),isSameSite:r.boolean().optional()}),requestId:r.string(),timestamp:r.number(),wallTime:r.number().optional(),hasUserGesture:r.boolean().optional(),type:ze.optional(),redirectHasExtraInfo:r.boolean()});var As=r.enum(["InvalidDomain","InvalidPrefix","NameValuePairExceedsMaxSize","OverwriteSecure","SamePartyFromCrossPartyContext","SamePartyConflictsWithOtherAttributes","SameSiteLax","SameSiteNoneInsecure","SameSiteStrict","SameSiteUnspecifiedTreatedAsLax","SchemefulSameSiteStrict","SchemefulSameSiteLax","SchemefulSameSiteUnspecifiedTreatedAsLax","SchemeNotSupported","SecureOnly","SyntaxError","ThirdPartyBlockedInFirstPartySet","UnknownError","UserPreferences"]).or(r.string()),ln=r.object({requestId:r.string(),blockedCookies:r.array(r.object({blockedReasons:r.array(As),cookieLine:r.string(),cookie:ft.optional()})),headers:r.record(r.string(),r.string()),resourceIPAddressSpace:ht,statusCode:r.number(),headersText:r.string().optional(),cookiePartitionKey:r.string().optional(),cookiePartitionKeyOpaque:r.boolean().optional()});var un=r.object({loaderId:r.string(),requestId:r.string(),response:r.object({url:r.string(),status:r.number(),statusText:r.string(),headers:r.record(r.string(),r.string()),headersText:r.string().optional(),mimeType:r.string().optional(),requestHeaders:r.record(r.string(),r.string()).optional(),requestHeadersText:r.string().optional(),connectionReused:r.boolean(),connectionId:r.number(),remoteIPAddress:r.string().optional(),remotePort:r.number().optional(),fromDiskCache:r.boolean().optional(),fromServiceWorker:r.boolean().optional(),fromPrefetchCache:r.boolean().optional(),encodedDataLength:r.number(),timing:r.object({requestTime:r.number(),proxyStart:r.number(),proxyEnd:r.number(),dnsStart:r.number(),dnsEnd:r.number(),connectStart:r.number(),connectEnd:r.number(),sslStart:r.number(),sslEnd:r.number(),workerStart:r.number(),workerReady:r.number(),workerFetchStart:r.number(),workerRespondWithSettled:r.number(),sendStart:r.number(),sendEnd:r.number(),pushStart:r.number(),pushEnd:r.number(),receiveHeadersEnd:r.number()}).optional(),serviceWorkerResponseSource:r.enum(["cache-storage","http-cache","fallback-code","network"]).or(r.string()).optional(),responseTime:r.number().optional(),cacheStorageCacheName:r.string().optional(),protocol:r.string().optional(),alternateProtocolUsage:r.enum(["alternativeJobWonWithoutRace","alternativeJobWonRace","mainJobWonRace","mappingMissing","broken","dnsAlpnH3JobWonWithoutRace","dnsAlpnH3JobWonRace","unspecifiedReason"]).or(r.string()).optional(),securityState:r.enum(["unknown","neutral","insecure","secure","info","insecure-broken"]).or(r.string()),securityDetails:r.object({protocol:r.string(),keyExchange:r.string(),keyExchangeGroup:r.string().optional(),cipher:r.string(),mac:r.string().optional(),certificateId:r.number(),subjectName:r.string(),sanList:r.array(r.string()),issuer:r.string(),validFrom:r.number(),validTo:r.number(),signedCertificateTimestampList:r.array(r.object({status:r.string(),origin:r.string(),logDescription:r.string(),logId:r.string(),timestamp:r.number(),hashAlgorithm:r.string(),signatureAlgorithm:r.string(),signatureData:r.string()})),certificateTransparencyCompliance:r.enum(["unknown","not-compliant","compliant"]).or(r.string()),serverSignatureAlgorithm:r.number().optional(),encryptedClientHello:r.boolean()}).optional()}),timestamp:r.number(),type:ze,frameId:r.string().optional(),hasExtraInfo:r.boolean()});var M=require("perf_hooks"),hn=U(Ut());var B=(0,mn.default)("cypress:protocol:capture:dom"),gt=class extends W{constructor(){super(...arguments);this.afterTestReceived=!1;this.waitForAfterTest=async()=>{if(this.afterTestReceived){this.afterTestReceived=!1;return}this.deferredWaitForAfterTest=(0,hn.default)(),await this.deferredWaitForAfterTest.promise};this.frameAttached=t=>{this.state.domState.addChildFrame(t.frameId)};this.frameDetached=t=>{this.state.domState.removeChildFrame(t.frameId)};this.handleCypressProtocolInfo=({cypressProtocolInfo:t,serverTimestamp:a})=>{let s=JSON.parse(t),o=this.state.currentTimeRangeSyncData;this.state.addTimeRangeSyncData({clientSideStartTime:(o==null?void 0:o.clientSideEndTime)||0,clientSideEndTime:s.timestamp,serverSideStartTime:(o==null?void 0:o.serverSideEndTime)||0,serverSideEndTime:a,offset:a-s.timestamp}),this.db.flushPendingTimestampSyncEvents(),s.type==="test:after:run:async"&&(this.afterTestReceived=!0,this.deferredWaitForAfterTest&&(this.deferredWaitForAfterTest.resolve(),this.deferredWaitForAfterTest=void 0,this.afterTestReceived=!1))};this.documentUpdated=async()=>{B("document updated"),await this.cdpClient.send("DOM.getDocument",{depth:-1,pierce:!0})};this.childNodeInserted=async t=>{var l,g,x;let a=M.performance.now()+M.performance.timeOrigin,s=(l=this.state.activeRunnable)==null?void 0:l.id,o=(g=this.state.activeRunnable)==null?void 0:g.attempt;B("child node inserted %O",t);let i=Mt(t.node);if(i&&i.contentDocument){this.state.domState.autFrameId=i.frameId,this.state.domState.trackAndMapNodeAndChildren(i.contentDocument);let L=pe(i.contentDocument);this.insertEvent("dom:full-snapshot",{node:L},en,a,s,o)}let d=this.state.domState.getBackendNodeId(t.parentNodeId);if(d&&this.state.domState.isBackendNodeIdTracked(d)){let L=t.node;this.state.domState.trackAndMapNodeAndChildren(L),B("DOM.childNodeInserted node %O",L),this.insertEvent("dom:node-added",{node:pe(L,d),parentId:d,previousId:this.state.domState.getBackendNodeId(t.previousNodeId)},Bt,a,s,o)}let c=t.node.childNodeCount||0,u=((x=t.node.children)==null?void 0:x.length)||0;c!==u&&(d&&this.state.domState.isBackendNodeIdTracked(d)&&this.state.domState.addChildNodeRequest({backendNodeId:t.node.backendNodeId,timestamp:a,activeRunnableId:s,activeAttempt:o}),await this.cdpClient.send("DOM.requestChildNodes",{nodeId:t.node.nodeId,depth:-1,pierce:!0}))};this.childNodeCountUpdated=async t=>{var d,c;let a=M.performance.now()+M.performance.timeOrigin,s=(d=this.state.activeRunnable)==null?void 0:d.id,o=(c=this.state.activeRunnable)==null?void 0:c.attempt;B("child node count updated %O",t);let i=this.state.domState.getBackendNodeId(t.nodeId);i&&this.state.domState.isBackendNodeIdTracked(i)&&(B("DOM.childNodeCountUpdated %O",t),this.state.domState.addChildNodeRequest({backendNodeId:i,timestamp:a,activeRunnableId:s,activeAttempt:o})),await this.cdpClient.send("DOM.requestChildNodes",{nodeId:t.nodeId,depth:-1,pierce:!0})};this.setChildNodes=async t=>{B("set child nodes %O",t);let a=this.state.domState.getBackendNodeId(t.parentId);if(a){let s=this.state.domState.getChildNodeRequest(a);if(s){let{timestamp:o,activeRunnableId:i,activeAttempt:d}=s,c,u=[];for(let l of t.nodes||[])u.push({eventType:"dom:node-added",eventPayload:{node:pe(l,a),parentId:a,previousId:c},eventExpectedSchema:Bt,timestamp:o,runnableId:i,attempt:d}),c=l.backendNodeId,this.state.domState.trackAndMapNodeAndChildren(l);this.insertEvents(u)}}};this.childNodeRemoved=t=>{var c,u;let a=M.performance.now()+M.performance.timeOrigin,s=(c=this.state.activeRunnable)==null?void 0:c.id,o=(u=this.state.activeRunnable)==null?void 0:u.attempt,i=this.state.domState.getBackendNodeId(t.nodeId),d=this.state.domState.getBackendNodeId(t.parentNodeId);i&&d&&this.state.domState.isBackendNodeIdTracked(i)&&(B("DOM.childNodeRemoved %O",t),this.insertEvent("dom:node-removed",{id:i,parentId:d},tn,a,s,o))};this.attributeModified=t=>{var l,g;let a=M.performance.now()+M.performance.timeOrigin;if(t.name==="data-cypress-protocol-info"){this.handleCypressProtocolInfo({cypressProtocolInfo:t.value,serverTimestamp:a});return}if(this.cdpClient.domIsLoading)return;let s=(l=this.state.activeRunnable)==null?void 0:l.id,o=(g=this.state.activeRunnable)==null?void 0:g.attempt,{nodeId:i,name:d,value:c}=t,u=this.state.domState.getBackendNodeId(i);B("DOM.attributeModified %O",{nodeId:i,backendNodeId:u,name:d}),u&&this.state.domState.isBackendNodeIdTracked(u)&&this.insertEvent("dom:attribute-modified",{id:u,name:d,value:c},Xr,a,s,o)};this.attributeRemoved=t=>{var u,l;let a=M.performance.now()+M.performance.timeOrigin,s=(u=this.state.activeRunnable)==null?void 0:u.id,o=(l=this.state.activeRunnable)==null?void 0:l.attempt,{nodeId:i,name:d}=t,c=this.state.domState.getBackendNodeId(i);B("DOM.attributeRemoved %O",{nodeId:i,backendNodeId:c,name:d}),c&&this.state.domState.isBackendNodeIdTracked(c)&&this.insertEvent("dom:attribute-removed",{id:c,name:d},Jr,a,s,o)};this.characterDataModified=async t=>{var u,l;let a=M.performance.now()+M.performance.timeOrigin,s=(u=this.state.activeRunnable)==null?void 0:u.id,o=(l=this.state.activeRunnable)==null?void 0:l.attempt,{nodeId:i,characterData:d}=t;B("DOM.characterDataModified %O",{nodeId:i,characterData:d.length>16?`"${d.substring(0,16)}..."`:`${d}`});let c=this.state.domState.getBackendNodeId(t.nodeId);c&&this.state.domState.isBackendNodeIdTracked(c)&&this.insertEvent("dom:character-data-modified",{id:c,characterData:d},Yr,a,s,o)};this.executionContextCreated=t=>{var a,s;B("Runtime.executionContextCreated %O",t),(a=t.context.auxData)!=null&&a.frameId&&((s=this.state.activeRunnable)!=null&&s.id)&&this.state.domState.addExecutionContext(t.context.id,{frameId:t.context.auxData.frameId,runnableId:this.state.activeRunnable.id,attempt:this.state.activeRunnable.attempt}),B("execution contexts: %O",this.state.domState.getMetadataForExecutionContext(t.context.id))};this.radioInputChanged=({executionContextId:t,payload:a})=>{let s=this.state.domState.getMetadataForExecutionContext(t);if(s){let{elementSelector:o,timestamp:i,checked:d,name:c}=a,{frameId:u,runnableId:l,attempt:g}=s;this.insertEvent("dom:radio-input-changed",{elementSelector:o,frameId:u,checked:d,name:c},pt,i,l,g)}};this.checkboxInputChanged=({executionContextId:t,payload:a})=>{let s=this.state.domState.getMetadataForExecutionContext(t);if(s){let{elementSelector:o,timestamp:i,checked:d}=a,{frameId:c,runnableId:u,attempt:l}=s;this.insertEvent("dom:checkbox-input-changed",{elementSelector:o,frameId:c,checked:d},Kr,i,u,l)}};this.textInputChanged=({executionContextId:t,payload:a})=>{let s=this.state.domState.getMetadataForExecutionContext(t);if(s){let{elementSelector:o,timestamp:i,value:d}=a,{frameId:c,runnableId:u,attempt:l}=s;this.insertEvent("dom:text-input-changed",{elementSelector:o,frameId:c,value:d},rn,i,u,l)}};this.selectInputChanged=({executionContextId:t,payload:a})=>{let s=this.state.domState.getMetadataForExecutionContext(t);if(s){let{elementSelector:o,timestamp:i,values:d}=a,{frameId:c,runnableId:u,attempt:l}=s;this.insertEvent("dom:select-input-changed",{elementSelector:o,frameId:c,values:d},mt,i,u,l)}};this.elementScrolled=({executionContextId:t,payload:a})=>{let s=this.state.domState.getMetadataForExecutionContext(t);if(s){let o=a,{timestamp:i}=o,d=We(o,["timestamp"]),{frameId:c,runnableId:u,attempt:l}=s;this.insertEvent("dom:element-scrolled",Ve($e({},d),{frameId:c}),Qr,i,u,l)}};this.windowScrolled=({executionContextId:t,payload:a})=>{let s=this.state.domState.getMetadataForExecutionContext(t);if(s){let o=a,{timestamp:i}=o,d=We(o,["timestamp"]),{frameId:c,runnableId:u,attempt:l}=s;this.insertEvent("dom:window-scrolled",Ve($e({},d),{frameId:c}),nn,i,u,l)}}}async startCapturing(){await Promise.all([this.cdpClient.send("Page.enable"),this.cdpClient.send("DOM.enable")]),await this.cdpClient.send("Runtime.addBinding",{name:"cypressAutProtocolEvent"}),await this.cdpClient.send("Page.addScriptToEvaluateOnNewDocument",{source:`${Er()}`,worldName:"Cypress Protocol"}),this.cdpClient.on("Page.frameAttached",this.frameAttached),this.cdpClient.on("Page.frameDetached",this.frameDetached),this.cdpClient.on("Runtime.executionContextCreated",this.executionContextCreated),this.cdpClient.on("DOM.documentUpdated",this.documentUpdated),this.cdpClient.on("DOM.childNodeInserted",this.childNodeInserted),this.cdpClient.on("DOM.childNodeCountUpdated",this.childNodeCountUpdated),this.cdpClient.on("DOM.childNodeRemoved",this.childNodeRemoved),this.cdpClient.on("DOM.setChildNodes",this.setChildNodes),this.cdpClient.on("DOM.attributeModified",this.attributeModified),this.cdpClient.on("DOM.attributeRemoved",this.attributeRemoved),this.cdpClient.on("DOM.characterDataModified",this.characterDataModified),this.autBroker.on("select-input-changed",this.selectInputChanged),this.autBroker.on("radio-input-changed",this.radioInputChanged),this.autBroker.on("checkbox-input-changed",this.checkboxInputChanged),this.autBroker.on("text-input-changed",this.textInputChanged),this.autBroker.on("element-scrolled",this.elementScrolled),this.autBroker.on("window-scrolled",this.windowScrolled)}};var yt=class extends W{async startCapturing(){this.startCapturingLogEntriesAdded()}startCapturingLogEntriesAdded(){this.cdpClient.on("Log.entryAdded",e=>{this.insertEvent("log:added",e,Fr,e.entry.timestamp)})}};var vt=class extends W{async startCapturing(){await this.cdpClient.send("Runtime.enable"),this.startCapturingConsoleOutput(),this.startCapturingExceptionsThrown()}startCapturingConsoleOutput(){this.cdpClient.on("Runtime.consoleAPICalled",e=>{this.insertEvent("runtime:console-api-called",e,jr,e.timestamp)})}startCapturingExceptionsThrown(){this.cdpClient.on("Runtime.exceptionThrown",e=>{this.insertEvent("runtime:exception-thrown",e,qr,e.timestamp)})}};var we=require("perf_hooks");var $t=U(J()),fn=(0,$t.default)("cypress:protocol:capture:NetworkManager"),de=(0,$t.default)("cypress-verbose:protocol:capture:NetworkManager"),Ds=1e3,Ls=64*1024,bt=class extends W{constructor(){super(...arguments);this.convertToMs=t=>t*Ds;this.isChildFrame=t=>t&&this.state.domState.isChildFrame(t);this.requestServedFromCache=t=>{if(!this.state.networkState.getRequest(t.requestId)){de("Network.requestServedFromCache not added since the request is not being tracked: %O",t);return}this.insertEvent("network:request-served-from-cache",t,on,we.performance.now()+we.performance.timeOrigin)};this.requestWillBeSent=t=>{if(!this.isChildFrame(t.frameId)){de("Network.requestWillBeSent not added since it is not originating from a child frame: %O",t);return}let a=this.convertToMs(t.wallTime);this.insertEvent("network:request-will-be-sent",t,cn,a),this.state.networkState.addRequest({requestId:t.requestId,requestURL:t.request.url,type:t.type,requestWillBeSentTimestamp:t.timestamp,requestWillBeSentWallTime:a})};this.requestWillBeSentExtraInfo=t=>{if(!this.state.networkState.getRequest(t.requestId)){de("Network.requestWillBeSentExtraInfo not added since the request is not being tracked: %O",t);return}this.insertEvent("network:request-will-be-sent-extra-info",t,dn,we.performance.now()+we.performance.timeOrigin)};this.responseReceived=t=>{if(!this.isChildFrame(t.frameId)){de("Network.responseReceived not added since it is not originating from a child frame: %O",t);return}let a=this.state.networkState.getRequest(t.requestId);if(!a){de("Network.responseReceived not added since the request is not being tracked: %O",t);return}let s=this.convertToMs(t.timestamp-a.requestWillBeSentTimestamp);this.insertEvent("network:response-received",t,un,a.requestWillBeSentWallTime+s),this.state.networkState.addResponse({requestId:t.requestId,mimeType:t.response.mimeType,type:t.type})};this.responseReceivedExtraInfo=t=>{if(!this.state.networkState.getRequest(t.requestId)){de("Network.responseReceived not added since the request is not being tracked: %O",t);return}this.insertEvent("network:response-received-extra-info",t,ln,we.performance.now()+we.performance.timeOrigin)};this.loadingFinished=async t=>{var d,c;let a=this.state.networkState.getRequest(t.requestId),s=this.state.networkState.getResponse(t.requestId);if(!a||!s){de("Network.loadingFinished not added since the request and response are not being tracked: %O",t);return}this.state.networkState.removeRequest(t.requestId),this.state.networkState.removeResponse(t.requestId);let o=this.convertToMs(t.timestamp-a.requestWillBeSentTimestamp);if(this.insertEvent("network:loading-finished",t,sn,a.requestWillBeSentWallTime+o),fn("Network.loadingFinished %O",{request:a,response:s}),["Script"].includes(s.type))return;let i=await this.cdpClient.send("Network.getResponseBody",{requestId:t.requestId}).catch(()=>{});i&&this.db.addNetworkResponse({requestId:t.requestId,requestURL:a.requestURL,type:s.type,mimeType:s.mimeType,requestWillBeSentTimestamp:a.requestWillBeSentTimestamp,loadingFinishedTimestamp:t.timestamp,body:i.body,isBase64Encoded:i.base64Encoded,runnableId:(d=this.state.activeRunnable)==null?void 0:d.id,attempt:(c=this.state.activeRunnable)==null?void 0:c.attempt})};this.loadingFailed=t=>{let a=this.state.networkState.getRequest(t.requestId);if(!a){de("Network.loadingFailed not added since the request is not being tracked: %O",t);return}fn("Network.loadingFailed %O",{request:a}),this.state.networkState.removeRequest(t.requestId);let s=this.convertToMs(t.timestamp-a.requestWillBeSentTimestamp);this.insertEvent("network:loading-failed",t,an,a.requestWillBeSentWallTime+s)}}async startCapturing(){await this.cdpClient.send("Network.enable",{maxPostDataSize:Ls}),this.cdpClient.on("Network.requestServedFromCache",this.requestServedFromCache),this.cdpClient.on("Network.requestWillBeSent",this.requestWillBeSent),this.cdpClient.on("Network.requestWillBeSentExtraInfo",this.requestWillBeSentExtraInfo),this.cdpClient.on("Network.responseReceived",this.responseReceived),this.cdpClient.on("Network.responseReceivedExtraInfo",this.responseReceivedExtraInfo),this.cdpClient.on("Network.loadingFinished",this.loadingFinished),this.cdpClient.on("Network.loadingFailed",this.loadingFailed)}};var Wt=U(J());var D=(0,Wt.default)("cypress:protocol:capture:CypressEventsManager"),Vt=(0,Wt.default)("cypress-verbose:protocol:capture:CypressEventsManager"),St=class{constructor(e,t){this.db=e;this.state=t}viewportChanged(e){var a,s,o;let t=Gr.safeParse(e.viewport);if(!t.success){D("not adding viewport changed event to database due to failed parsing: %O",t.error);return}D("inserting viewport into database: %O",t.data),(o=this.db)==null||o.addEvent({source:"cypress",type:"viewport:changed",runnableId:(a=this.state.activeRunnable)==null?void 0:a.id,attempt:(s=this.state.activeRunnable)==null?void 0:s.attempt,payload:t.data,timestamp:e.timestamp})}urlChanged(e){var a,s,o;let t=Hr.safeParse(e.url);if(!t.success){D("not adding url changed event to database due to failed parsing: %O",t.error);return}D("inserting url into database: %O",t.data),(o=this.db)==null||o.addEvent({source:"cypress",type:"url:changed",runnableId:(a=this.state.activeRunnable)==null?void 0:a.id,attempt:(s=this.state.activeRunnable)==null?void 0:s.attempt,payload:t.data,timestamp:e.timestamp})}pageLoading(e){var a,s,o;let t=$r.safeParse(e.loading);if(!t.success){D("not adding page loading event to database due to failed parsing: %O",t.error);return}D("inserting page loading into database: %O",t.data),(o=this.db)==null||o.addEvent({source:"cypress",type:"page:loading",runnableId:(a=this.state.activeRunnable)==null?void 0:a.id,attempt:(s=this.state.activeRunnable)==null?void 0:s.attempt,payload:t.data,timestamp:e.timestamp})}beforeTest(e){var a;let t=_e.safeParse(e);if(!t.success){D("not adding before test lifecycle event to database due to failed parsing: %O",t.error);return}D("before test %s",e.id),Vt("before test details %O",e),(a=this.db)==null||a.addEvent({source:"cypress",type:"test:before:run:async",payload:t.data,runnableId:e.id,attempt:e.currentRetry+1,timestamp:new Date(e.wallClockStartedAt).getTime()}),this.state.activeRunnable={id:e.id,attempt:e.currentRetry+1}}afterTest(e){var a;let t=Vr.safeParse(e);if(!t.success){D("not adding after test lifecycle event to database due to failed parsing: %O",t.error);return}D("after test %s",t.data.id),Vt("after test details %O",t.data),(a=this.db)==null||a.addEvent({source:"cypress",type:"test:after:run",payload:t.data,runnableId:e.id,attempt:e.currentRetry+1,timestamp:new Date(e.wallClockStartedAt).getTime()+e.wallClockDuration})}addRunnables(e){var a;let t=Zr.safeParse(e);if(!t.success){D("not adding runnables to database due to failed parsing: %O",t.error);return}(a=this.db)==null||a.addEvent({source:"cypress",type:"runnables:ready",payload:t.data,timestamp:Date.now()})}commandLogAdded(e){this.insertCommandLogEvent({log:e,type:"log:added"})}commandLogChanged(e){this.insertCommandLogEvent({log:e,type:"log:changed"})}async insertCommandLogEvent({log:e,type:t}){var s;let a=Ur.safeParse(e);if(!a.success){D("not adding command log %s event to database due to failed parsing: %O",t,a.error);return}D("inserting command log into database, id: %s, type: %s",a.data.id,t),Vt("command log details: %O",a.data),(s=this.db)==null||s.addEvent({source:"cypress",type:t,runnableId:a.data.testId,attempt:a.data.testCurrentRetry!=null?a.data.testCurrentRetry+1:void 0,payload:a.data,timestamp:new Date(a.data.wallClockUpdatedAt).getTime()})}};var xn=U(J());var er=U(J()),yn=require("events");var Zt=r.object({type:r.literal("text-input-changed"),payload:r.object({elementSelector:r.string(),value:r.string(),timestamp:r.number()})});var Ht=r.object({type:r.literal("element-scrolled"),payload:r.object({timestamp:r.number(),scrollX:r.number(),scrollY:r.number(),elementSelector:r.string()})});var Gt=r.object({type:r.literal("window-scrolled"),payload:r.object({timestamp:r.number(),scrollX:r.number(),scrollY:r.number()})});var Xt=r.object({type:r.literal("select-input-changed"),payload:mt.omit({frameId:!0}).extend({timestamp:r.number()})});var Jt=r.object({type:r.literal("radio-input-changed"),payload:pt.omit({frameId:!0}).extend({timestamp:r.number()})});var Yt=r.object({type:r.literal("checkbox-input-changed"),payload:r.object({elementSelector:r.string(),checked:r.boolean(),timestamp:r.number()})});var Kt={"radio-input-changed":Jt,"checkbox-input-changed":Yt,"text-input-changed":Zt,"element-scrolled":Ht,"select-input-changed":Xt,"window-scrolled":Gt},_c=r.discriminatedUnion("type",[Jt,Yt,Zt,Ht,Xt,Gt]);var Qt=(0,er.default)("cypress:protocol:capture:AUTEventBroker"),gn=(0,er.default)("cypress-verbose:protocol:capture:AUTEventBroker"),xt=class{constructor(e){this.cdpClient=e;this.handleBindingCalled=e=>{Qt("Runtime.bindingCalled %O",{name:e.name,executionContextId:e.executionContextId}),gn("Event: %O",e);let t=JSON.parse(e.payload);if(!Kt[t.type]){Qt("Runtime.bindingCalled: Invalid event type %s",t.type);return}let a=Kt[t.type].safeParse(t);if(!a.success){Qt("Runtime.bindingCalled: (%s) Invalid event payload",t.type),gn(JSON.stringify(a.error.format(),void 0,2));return}let{type:s,payload:o}=a.data;this.emitter.emit(s,{executionContextId:e.executionContextId,payload:o})};this.emitter=new yn.EventEmitter,this.cdpClient.on("Runtime.bindingCalled",this.handleBindingCalled)}on(e,t){return this.emitter.on(e,t)}};var Ct=class{constructor(){this.backendNodeIdsToTrack=new Set;this.frontendNodeIdToBackendNodeId=new Map;this.childFrames=new Set;this.executionContextToMetadata=new Map;this.childNodeRequests=new Map;this.pendingAUTEvents=!1}trackAndMapNodeAndChildren(e){Ze(e,t=>{this.backendNodeIdsToTrack.add(t.backendNodeId),this.frontendNodeIdToBackendNodeId.set(t.nodeId,t.backendNodeId)})}addChildFrame(e){this.childFrames.add(e)}removeChildFrame(e){this.childFrames.delete(e)}isChildFrame(e){return this.childFrames.has(e)}addExecutionContext(e,t){this.executionContextToMetadata.set(e,t)}getMetadataForExecutionContext(e){return this.executionContextToMetadata.get(e)}isBackendNodeIdTracked(e){return this.backendNodeIdsToTrack.has(e)}getBackendNodeId(e){return this.frontendNodeIdToBackendNodeId.get(e)}resetAutState(){this.backendNodeIdsToTrack.clear(),this.frontendNodeIdToBackendNodeId.clear(),this.autFrameId=void 0}addChildNodeRequest(e){this.childNodeRequests.set(e.backendNodeId,e)}getChildNodeRequest(e){return this.childNodeRequests.get(e)}};var kt=class{constructor(){this.requestMap=new Map;this.responseMap=new Map}addRequest(e){this.requestMap.set(e.requestId,e)}getRequest(e){return this.requestMap.get(e)}removeRequest(e){this.requestMap.delete(e)}addResponse(e){this.responseMap.set(e.requestId,e)}getResponse(e){return this.responseMap.get(e)}removeResponse(e){this.responseMap.delete(e)}};var Be=class{constructor(){this.syncTimings=[];this.domState=new Ct;this.networkState=new kt}get currentTimeRangeSyncData(){return this.syncTimings[this.syncTimings.length-1]}addTimeRangeSyncData(e){this.syncTimings.push(e)}getTimingForTimestamp(e){return this.syncTimings.find(a=>a.serverSideStartTime<=e&&a.serverSideEndTime>=e)}};var bn=U(Ut()),Sn=U(J()),vn=(0,Sn.default)("cypress-verbose:protocol:capture:tracked-cdp"),_t=class{constructor(e){this.cdpClient=e;this.outstandingCallbacks=0;this.domIsLoading=!1}removeOutstandingCallback(){this.outstandingCallbacks-=1,this.outstandingCallbacks===0&&this.deferredCallbackDrain&&(this.deferredCallbackDrain.resolve(),this.deferredCallbackDrain=void 0)}on(e,t,a){this.cdpClient.on(e,async s=>{if(a!=null&&a.skipWhenDOMIsLoading&&this.domIsLoading){vn("skipping event while dom is loading",e);return}if(!(a!=null&&a.handleWhileDraining)&&this.isDrainInProgress()){vn("skipping event while draining",e);return}this.outstandingCallbacks+=1;try{await t(s)}catch(o){throw o}finally{this.removeOutstandingCallback()}})}async send(e,t){return this.cdpClient.send(e,t)}async drainEventCallbacks(){this.outstandingCallbacks!==0&&(this.deferredCallbackDrain=(0,bn.default)(),await this.deferredCallbackDrain.promise)}isDrainInProgress(){return!!this.deferredCallbackDrain}};var tr=(0,xn.default)("cypress:protocol:capture"),Tt=class{constructor(){this.state=new Be}beforeSpec(e){tr("initializing new spec"),this.state=new Be,this.db=new Oe({db:e,state:this.state}),this.cypressEventsManager=new St(this.db,this.state)}async connectToBrowser(e){if(tr("connecting to browser for new spec"),this.cdpClient=new _t(e),!this.db)throw new Error("Database not initialized. beforeSpec() must be called first");this.autBroker=new xt(this.cdpClient),this.cdpLogManager=new yt(this.cdpClient,this.db,this.state,this.autBroker),this.runtimeManager=new vt(this.cdpClient,this.db,this.state,this.autBroker),this.domManager=new gt(this.cdpClient,this.db,this.state,this.autBroker),this.networkManager=new bt(this.cdpClient,this.db,this.state,this.autBroker),await Promise.all([this.cdpLogManager.startCapturing(),this.domManager.startCapturing(),this.runtimeManager.startCapturing(),this.networkManager.startCapturing()])}addRunnables(e){var t;(t=this.cypressEventsManager)==null||t.addRunnables(e)}commandLogAdded(e){var t;(t=this.cypressEventsManager)==null||t.commandLogAdded(e)}commandLogChanged(e){var t;(t=this.cypressEventsManager)==null||t.commandLogChanged(e)}beforeTest(e){var t;(t=this.cypressEventsManager)==null||t.beforeTest(e)}async afterTest(e){var t,a,s,o;(t=this.cypressEventsManager)==null||t.afterTest(e),await((a=this.domManager)==null?void 0:a.waitForAfterTest()),await((s=this.cdpClient)==null?void 0:s.drainEventCallbacks()),(o=this.db)==null||o.flushPendingTimestampSyncEvents()}viewportChanged(e){var t;(t=this.cypressEventsManager)==null||t.viewportChanged(e)}urlChanged(e){var t;(t=this.cypressEventsManager)==null||t.urlChanged(e)}pageLoading(e){var t;(t=this.cypressEventsManager)==null||t.pageLoading(e)}resetTest(e){var t;(t=this.db)==null||t.resetTest(e),this.state=new Be}afterSpec(){return tr("after spec"),new Promise((e,t)=>{setTimeout(()=>{var a;try{(a=this.db)==null||a.close(),this.state.activeRunnable=void 0,e()}catch(s){t(s)}},10)})}};Tt.SCHEMA_VERSION=Oe.SCHEMA_VERSION;0&&(module.exports={AppCaptureProtocol});
