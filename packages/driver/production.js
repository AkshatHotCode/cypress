"use strict";var bn=Object.create;var Ue=Object.defineProperty,Sn=Object.defineProperties,xn=Object.getOwnPropertyDescriptor,Cn=Object.getOwnPropertyDescriptors,_n=Object.getOwnPropertyNames,He=Object.getOwnPropertySymbols,wn=Object.getPrototypeOf,kt=Object.prototype.hasOwnProperty,tr=Object.prototype.propertyIsEnumerable;var er=(n,e,t)=>e in n?Ue(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,Ge=(n,e)=>{for(var t in e||={})kt.call(e,t)&&er(n,t,e[t]);if(He)for(var t of He(e))tr.call(e,t)&&er(n,t,e[t]);return n},Xe=(n,e)=>Sn(n,Cn(e));var Je=(n,e)=>{var t={};for(var a in n)kt.call(n,a)&&e.indexOf(a)<0&&(t[a]=n[a]);if(n!=null&&He)for(var a of He(n))e.indexOf(a)<0&&tr.call(n,a)&&(t[a]=n[a]);return t};var H=(n,e)=>()=>(e||n((e={exports:{}}).exports,e),e.exports),Tn=(n,e)=>{for(var t in e)Ue(n,t,{get:e[t],enumerable:!0})},rr=(n,e,t,a)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of _n(e))!kt.call(n,s)&&s!==t&&Ue(n,s,{get:()=>e[s],enumerable:!(a=xn(e,s))||a.enumerable});return n};var z=(n,e,t)=>(t=n!=null?bn(wn(n)):{},rr(e||!n||!n.__esModule?Ue(t,"default",{value:n,enumerable:!0}):t,n)),kn=n=>rr(Ue({},"__esModule",{value:!0}),n);var ar=H((Ms,nr)=>{var ke=1e3,Ee=ke*60,Ie=Ee*60,de=Ie*24,En=de*7,In=de*365.25;nr.exports=function(n,e){e=e||{};var t=typeof n;if(t==="string"&&n.length>0)return Rn(n);if(t==="number"&&isFinite(n))return e.long?On(n):Nn(n);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(n))};function Rn(n){if(n=String(n),!(n.length>100)){var e=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(n);if(e){var t=parseFloat(e[1]),a=(e[2]||"ms").toLowerCase();switch(a){case"years":case"year":case"yrs":case"yr":case"y":return t*In;case"weeks":case"week":case"w":return t*En;case"days":case"day":case"d":return t*de;case"hours":case"hour":case"hrs":case"hr":case"h":return t*Ie;case"minutes":case"minute":case"mins":case"min":case"m":return t*Ee;case"seconds":case"second":case"secs":case"sec":case"s":return t*ke;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return t;default:return}}}}function Nn(n){var e=Math.abs(n);return e>=de?Math.round(n/de)+"d":e>=Ie?Math.round(n/Ie)+"h":e>=Ee?Math.round(n/Ee)+"m":e>=ke?Math.round(n/ke)+"s":n+"ms"}function On(n){var e=Math.abs(n);return e>=de?Ye(n,e,de,"day"):e>=Ie?Ye(n,e,Ie,"hour"):e>=Ee?Ye(n,e,Ee,"minute"):e>=ke?Ye(n,e,ke,"second"):n+" ms"}function Ye(n,e,t,a){var s=e>=t*1.5;return Math.round(n/t)+" "+a+(s?"s":"")}});var Et=H((Ds,sr)=>{function Pn(n){t.debug=t,t.default=t,t.coerce=d,t.disable=o,t.enable=s,t.enabled=i,t.humanize=ar(),t.destroy=l,Object.keys(n).forEach(u=>{t[u]=n[u]}),t.names=[],t.skips=[],t.formatters={};function e(u){let v=0;for(let C=0;C<u.length;C++)v=(v<<5)-v+u.charCodeAt(C),v|=0;return t.colors[Math.abs(v)%t.colors.length]}t.selectColor=e;function t(u){let v,C=null,Te,Ve;function I(...D){if(!I.enabled)return;let ce=I,We=Number(new Date),gn=We-(v||We);ce.diff=gn,ce.prev=v,ce.curr=We,v=We,D[0]=t.coerce(D[0]),typeof D[0]!="string"&&D.unshift("%O");let Ze=0;D[0]=D[0].replace(/%([a-zA-Z%])/g,(Tt,yn)=>{if(Tt==="%%")return"%";Ze++;let Qt=t.formatters[yn];if(typeof Qt=="function"){let vn=D[Ze];Tt=Qt.call(ce,vn),D.splice(Ze,1),Ze--}return Tt}),t.formatArgs.call(ce,D),(ce.log||t.log).apply(ce,D)}return I.namespace=u,I.useColors=t.useColors(),I.color=t.selectColor(u),I.extend=a,I.destroy=t.destroy,Object.defineProperty(I,"enabled",{enumerable:!0,configurable:!1,get:()=>C!==null?C:(Te!==t.namespaces&&(Te=t.namespaces,Ve=t.enabled(u)),Ve),set:D=>{C=D}}),typeof t.init=="function"&&t.init(I),I}function a(u,v){let C=t(this.namespace+(typeof v>"u"?":":v)+u);return C.log=this.log,C}function s(u){t.save(u),t.namespaces=u,t.names=[],t.skips=[];let v,C=(typeof u=="string"?u:"").split(/[\s,]+/),Te=C.length;for(v=0;v<Te;v++)C[v]&&(u=C[v].replace(/\*/g,".*?"),u[0]==="-"?t.skips.push(new RegExp("^"+u.slice(1)+"$")):t.names.push(new RegExp("^"+u+"$")))}function o(){let u=[...t.names.map(c),...t.skips.map(c).map(v=>"-"+v)].join(",");return t.enable(""),u}function i(u){if(u[u.length-1]==="*")return!0;let v,C;for(v=0,C=t.skips.length;v<C;v++)if(t.skips[v].test(u))return!1;for(v=0,C=t.names.length;v<C;v++)if(t.names[v].test(u))return!0;return!1}function c(u){return u.toString().substring(2,u.toString().length-2).replace(/\.\*\?$/,"*")}function d(u){return u instanceof Error?u.stack||u.message:u}function l(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return t.enable(t.load()),t}sr.exports=Pn});var or=H((R,Ke)=>{R.formatArgs=Mn;R.save=Dn;R.load=Ln;R.useColors=An;R.storage=jn();R.destroy=(()=>{let n=!1;return()=>{n||(n=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})();R.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function An(){return typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function Mn(n){if(n[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+n[0]+(this.useColors?"%c ":" ")+"+"+Ke.exports.humanize(this.diff),!this.useColors)return;let e="color: "+this.color;n.splice(1,0,e,"color: inherit");let t=0,a=0;n[0].replace(/%[a-zA-Z%]/g,s=>{s!=="%%"&&(t++,s==="%c"&&(a=t))}),n.splice(a,0,e)}R.log=console.debug||console.log||(()=>{});function Dn(n){try{n?R.storage.setItem("debug",n):R.storage.removeItem("debug")}catch{}}function Ln(){let n;try{n=R.storage.getItem("debug")}catch{}return!n&&typeof process<"u"&&"env"in process&&(n=process.env.DEBUG),n}function jn(){try{return localStorage}catch{}}Ke.exports=Et()(R);var{formatters:qn}=Ke.exports;qn.j=function(n){try{return JSON.stringify(n)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}});var cr=H((Ls,ir)=>{"use strict";ir.exports=(n,e=process.argv)=>{let t=n.startsWith("-")?"":n.length===1?"-":"--",a=e.indexOf(t+n),s=e.indexOf("--");return a!==-1&&(s===-1||a<s)}});var ur=H((js,lr)=>{"use strict";var zn=require("os"),dr=require("tty"),L=cr(),{env:w}=process,te;L("no-color")||L("no-colors")||L("color=false")||L("color=never")?te=0:(L("color")||L("colors")||L("color=true")||L("color=always"))&&(te=1);"FORCE_COLOR"in w&&(w.FORCE_COLOR==="true"?te=1:w.FORCE_COLOR==="false"?te=0:te=w.FORCE_COLOR.length===0?1:Math.min(parseInt(w.FORCE_COLOR,10),3));function It(n){return n===0?!1:{level:n,hasBasic:!0,has256:n>=2,has16m:n>=3}}function Rt(n,e){if(te===0)return 0;if(L("color=16m")||L("color=full")||L("color=truecolor"))return 3;if(L("color=256"))return 2;if(n&&!e&&te===void 0)return 0;let t=te||0;if(w.TERM==="dumb")return t;if(process.platform==="win32"){let a=zn.release().split(".");return Number(a[0])>=10&&Number(a[2])>=10586?Number(a[2])>=14931?3:2:1}if("CI"in w)return["TRAVIS","CIRCLECI","APPVEYOR","GITLAB_CI"].some(a=>a in w)||w.CI_NAME==="codeship"?1:t;if("TEAMCITY_VERSION"in w)return/^(9\.(0*[1-9]\d*)\.|\d{2,}\.)/.test(w.TEAMCITY_VERSION)?1:0;if("GITHUB_ACTIONS"in w)return 1;if(w.COLORTERM==="truecolor")return 3;if("TERM_PROGRAM"in w){let a=parseInt((w.TERM_PROGRAM_VERSION||"").split(".")[0],10);switch(w.TERM_PROGRAM){case"iTerm.app":return a>=3?3:2;case"Apple_Terminal":return 2}}return/-256(color)?$/i.test(w.TERM)?2:/^screen|^xterm|^vt100|^vt220|^rxvt|color|ansi|cygwin|linux/i.test(w.TERM)||"COLORTERM"in w?1:t}function Fn(n){let e=Rt(n,n&&n.isTTY);return It(e)}lr.exports={supportsColor:Fn,stdout:It(Rt(!0,dr.isatty(1))),stderr:It(Rt(!0,dr.isatty(2)))}});var mr=H((k,et)=>{var Un=require("tty"),Qe=require("util");k.init=Gn;k.log=Wn;k.formatArgs=$n;k.save=Zn;k.load=Hn;k.useColors=Bn;k.destroy=Qe.deprecate(()=>{},"Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.");k.colors=[6,2,3,4,5,1];try{let n=ur();n&&(n.stderr||n).level>=2&&(k.colors=[20,21,26,27,32,33,38,39,40,41,42,43,44,45,56,57,62,63,68,69,74,75,76,77,78,79,80,81,92,93,98,99,112,113,128,129,134,135,148,149,160,161,162,163,164,165,166,167,168,169,170,171,172,173,178,179,184,185,196,197,198,199,200,201,202,203,204,205,206,207,208,209,214,215,220,221])}catch{}k.inspectOpts=Object.keys(process.env).filter(n=>/^debug_/i.test(n)).reduce((n,e)=>{let t=e.substring(6).toLowerCase().replace(/_([a-z])/g,(s,o)=>o.toUpperCase()),a=process.env[e];return/^(yes|on|true|enabled)$/i.test(a)?a=!0:/^(no|off|false|disabled)$/i.test(a)?a=!1:a==="null"?a=null:a=Number(a),n[t]=a,n},{});function Bn(){return"colors"in k.inspectOpts?!!k.inspectOpts.colors:Un.isatty(process.stderr.fd)}function $n(n){let{namespace:e,useColors:t}=this;if(t){let a=this.color,s="\x1B[3"+(a<8?a:"8;5;"+a),o=`  ${s};1m${e} \x1B[0m`;n[0]=o+n[0].split(`
`).join(`
`+o),n.push(s+"m+"+et.exports.humanize(this.diff)+"\x1B[0m")}else n[0]=Vn()+e+" "+n[0]}function Vn(){return k.inspectOpts.hideDate?"":new Date().toISOString()+" "}function Wn(...n){return process.stderr.write(Qe.format(...n)+`
`)}function Zn(n){n?process.env.DEBUG=n:delete process.env.DEBUG}function Hn(){return process.env.DEBUG}function Gn(n){n.inspectOpts={};let e=Object.keys(k.inspectOpts);for(let t=0;t<e.length;t++)n.inspectOpts[e[t]]=k.inspectOpts[e[t]]}et.exports=Et()(k);var{formatters:pr}=et.exports;pr.o=function(n){return this.inspectOpts.colors=this.useColors,Qe.inspect(n,this.inspectOpts).split(`
`).map(e=>e.trim()).join(" ")};pr.O=function(n){return this.inspectOpts.colors=this.useColors,Qe.inspect(n,this.inspectOpts)}});var G=H((qs,Nt)=>{typeof process>"u"||process.type==="renderer"||process.browser===!0||process.__nwjs?Nt.exports=or():Nt.exports=mr()});var Cr=H((Gs,Yn)=>{Yn.exports='"use strict";var a,w;function u(e,t){if(e.nodeType!==Node.ELEMENT_NODE)throw new Error("Can\'t generate CSS selector for non-element node type.");if(e.tagName.toLowerCase()==="html")return"html";let n={root:document.body,idName:o=>!0,className:o=>!0,tagName:o=>!0,attr:(o,l)=>!1,seedMinLength:1,optimizedMinLength:2,threshold:1e3,maxNumberOfTries:1e4};a={...n,...t},w=T(a.root,n);let r=f(e,"all",()=>f(e,"two",()=>f(e,"one",()=>f(e,"none"))));if(r){let o=L(M(r,e));return o.length>0&&(r=o[0]),h(r)}else throw new Error("Selector was not found.")}function T(e,t){return e.nodeType===Node.DOCUMENT_NODE?e:e===t.root?e.ownerDocument:e}function f(e,t,n){let r=null,o=[],l=e,d=0;for(;l;){let i=p(b(l))||p(...D(l))||p(...A(l))||p(x(l))||[v()],c=I(l);if(t=="all")c&&(i=i.concat(i.filter(g).map(s=>m(s,c))));else if(t=="two")i=i.slice(0,1),c&&(i=i.concat(i.filter(g).map(s=>m(s,c))));else if(t=="one"){let[s]=i=i.slice(0,1);c&&g(s)&&(i=[m(s,c)])}else t=="none"&&(i=[v()],c&&(i=[m(i[0],c)]));for(let s of i)s.level=d;if(o.push(i),o.length>=a.seedMinLength&&(r=E(o,n),r))break;l=l.parentElement,d++}return r||(r=E(o,n)),!r&&n?n():r}function E(e,t){let n=L(N(e));if(n.length>a.threshold)return t?t():null;for(let r of n)if(S(r))return r;return null}function h(e){let t=e[0],n=t.name;for(let r=1;r<e.length;r++){let o=e[r].level||0;t.level===o-1?n=`${e[r].name} > ${n}`:n=`${e[r].name} ${n}`,t=e[r]}return n}function C(e){return e.map(t=>t.penalty).reduce((t,n)=>t+n,0)}function S(e){let t=h(e);switch(w.querySelectorAll(t).length){case 0:throw new Error(`Can\'t select any node with this selector: ${t}`);case 1:return!0;default:return!1}}function b(e){let t=e.getAttribute("id");return t&&a.idName(t)?{name:"#"+CSS.escape(t),penalty:0}:null}function D(e){return Array.from(e.attributes).filter(n=>a.attr(n.name,n.value)).map(n=>({name:`[${CSS.escape(n.name)}="${CSS.escape(n.value)}"]`,penalty:.5}))}function A(e){return Array.from(e.classList).filter(a.className).map(n=>({name:"."+CSS.escape(n),penalty:1}))}function x(e){let t=e.tagName.toLowerCase();return a.tagName(t)?{name:t,penalty:2}:null}function v(){return{name:"*",penalty:3}}function I(e){let t=e.parentNode;if(!t)return null;let n=t.firstChild;if(!n)return null;let r=0;for(;n&&(n.nodeType===Node.ELEMENT_NODE&&r++,n!==e);)n=n.nextSibling;return r}function m(e,t){return{name:e.name+`:nth-child(${t})`,penalty:e.penalty+1}}function g(e){return e.name!=="html"&&!e.name.startsWith("#")}function p(...e){let t=e.filter(O);return t.length>0?t:null}function O(e){return e!=null}function*N(e,t=[]){if(e.length>0)for(let n of e[0])yield*N(e.slice(1,e.length),t.concat(n));else yield t}function L(e){return[...e].sort((t,n)=>C(t)-C(n))}function*M(e,t,n={counter:0,visited:new Map}){if(e.length>2&&e.length>a.optimizedMinLength)for(let r=1;r<e.length-1;r++){if(n.counter>a.maxNumberOfTries)return;n.counter+=1;let o=[...e];o.splice(r,1);let l=h(o);if(n.visited.has(l))return;S(o)&&P(o,t)&&(yield o,n.visited.set(l,!0),yield*M(o,t,n))}}function P(e,t){return w.querySelector(h(e))===t}var R=(e,t)=>({type:"window-scrolled",payload:{timestamp:e,scrollX:t.scrollX,scrollY:t.scrollY}}),H=(e,t)=>({type:"element-scrolled",payload:{timestamp:e,scrollX:t.target.scrollLeft,scrollY:t.target.scrollTop,elementSelector:u(t.target)}}),y=class{constructor(t,n,r){this.windowRef=t;this.docRef=n;this.perfRef=r;this.handleDocumentScroll=t=>{let n=this.perfRef.now()+this.perfRef.timeOrigin,r=t.target instanceof Document?R(n,this.windowRef):H(n,t);this.windowRef.cypressAutProtocolEvent(JSON.stringify(r))}}register(){this.docRef.addEventListener("scroll",this.handleDocumentScroll,!0)}};window.top!==window&&(document.addEventListener("input",t=>{var o;let n=performance.now()+performance.timeOrigin,r=t.target;if(r.tagName==="SELECT"){let l={type:"select-input-changed",payload:{elementSelector:u(r),values:Array.from(r.selectedOptions).map(({value:d})=>d),timestamp:n}};window.cypressAutProtocolEvent&&window.cypressAutProtocolEvent(JSON.stringify(l))}else if(r.getAttribute("type")==="radio"){let l={type:"radio-input-changed",payload:{elementSelector:u(r),checked:r.checked,name:r.getAttribute("name")||void 0,timestamp:n}};window.cypressAutProtocolEvent&&window.cypressAutProtocolEvent(JSON.stringify(l))}else if(((o=r.attributes.getNamedItem("type"))==null?void 0:o.value)==="checkbox"){let l={type:"checkbox-input-changed",payload:{elementSelector:u(r),checked:r.checked,timestamp:n}};window.cypressAutProtocolEvent&&window.cypressAutProtocolEvent(JSON.stringify(l))}else{let l={type:"text-input-changed",payload:{elementSelector:u(r),value:r.value,timestamp:n}};window.cypressAutProtocolEvent&&window.cypressAutProtocolEvent(JSON.stringify(l))}}),new y(window,document,performance).register());\n'});var zt=H((wc,on)=>{"use strict";var Is=()=>{let n={};return n.promise=new Promise((e,t)=>{n.resolve=e,n.reject=t}),n};on.exports=Is});var Os={};Tn(Os,{AppCaptureProtocol:()=>wt});module.exports=kn(Os);var Ot=z(G()),xr=z(require("crypto"));var le=String.raw,hr=le`
CREATE TABLE IF NOT EXISTS events (
  /* autoincrementing id */
  id INTEGER PRIMARY KEY,
  /* source of the event (e.g. cdp, cypress, etc.) */
  source TEXT NOT NULL,
  /* type of the event (e.g. 'viewport:changed, log:added, runtime:console-api-called', etc.) */
  type TEXT NOT NULL,
  /* payload of the event. JSON stringified */
  payload TEXT,
  /**
   * id of the runnable (test) that the event belongs to.
   * Can be NULL when the event is not associated with a given runnable (e.g. event occurs before any tests start)
   */
  runnable_id TEXT,
  /**
   * attempt number of the runnable (test) that the event belong to. 1-based (i.e. 1 = first attempt, 2 = second attempt, etc.).
   * Can be NULL when the event is not associated with a given runnable (e.g. event occurs before any tests start)
   */
  attempt INTEGER,
  /* timestamp of the event */
  timestamp REAL NOT NULL
) STRICT
  `,fr=le`
CREATE TABLE IF NOT EXISTS network_responses (
  /* the request id of the network request - https://chromedevtools.github.io/devtools-protocol/tot/Network/#type-RequestId */
  request_id TEXT PRIMARY KEY NOT NULL,
  /* the request URL of the network request - https://chromedevtools.github.io/devtools-protocol/tot/Network/#type-Request */
  request_url TEXT NOT NULL,
  /* the type of the network request - https://chromedevtools.github.io/devtools-protocol/tot/Network/#type-ResourceType */
  type TEXT NOT NULL,
  /* the mime type of the response - https://chromedevtools.github.io/devtools-protocol/tot/Network/#type-Response */
  mime_type TEXT NOT NULL,
  /**
   * id of the runnable (test) that the event belongs to.
   * Can be NULL when the event is not associated with a given runnable (e.g. event occurs before any tests start)
   */
  runnable_id TEXT,
  /**
   * attempt number of the runnable (test) that the event belong to. 1-based (i.e. 1 = first attempt, 2 = second attempt, etc.).
   * Can be NULL when the event is not associated with a given runnable (e.g. event occurs before any tests start)
   */
  attempt INTEGER,
  /**
   * timestamp of the requestWillBeSent event for the network request
   */
  request_will_be_sent_timestamp REAL NOT NULL,
  /**
   * timestamp of the loadingFinished event for the network request
   */
  loading_finished_timestamp REAL NOT NULL,
  /**
   * hash of the response body
   */
  body_hash TEXT NOT NULL
) STRICT
  `,gr=le`
CREATE TABLE IF NOT EXISTS hashed_data (
  /* hash of the data */
  hash TEXT PRIMARY KEY NOT NULL,
  /* data that was hashed */
  data TEXT NOT NULL,
  /* whether the data is base64 encoded */
  is_base64_encoded INTEGER NOT NULL
) STRICT
  `,yr=le`
INSERT INTO events (source, type, payload, runnable_id, attempt, timestamp)
VALUES ($source, $type, $payload, $runnableId, $attempt, $timestamp)
`,vr=le`
INSERT INTO network_responses (request_id, request_url, type, mime_type, runnable_id, attempt, request_will_be_sent_timestamp, loading_finished_timestamp, body_hash)
VALUES ($requestId, $requestURL, $type, $mimeType, $runnableId, $attempt, $requestWillBeSentTimestamp, $loadingFinishedTimestamp, $bodyHash)
`,br=le`
INSERT OR IGNORE INTO hashed_data (hash, data, is_base64_encoded)
VALUES ($hash, $data, $isBase64Encoded)
`,Sr=le`
DELETE FROM events WHERE runnable_id = ?
`;var tt=n=>{n.pragma("journal_mode = WAL"),n.prepare(hr).run(),n.prepare(fr).run(),n.prepare(gr).run()};tt.SCHEMA_VERSION=1;var Re=(0,Ot.default)("cypress:protocol:capture:db"),Xn=(0,Ot.default)("cypress-verbose:protocol:capture:db"),Jn={"dom:attribute-modified":!0,"dom:attribute-removed":!0,"dom:character-data-modified":!0,"dom:full-snapshot":!0,"dom:node-added":!0,"dom:node-removed":!0,"network:request-served-from-cache":!0,"network:request-will-be-sent-extra-info":!0,"network:response-received-extra-info":!0,"dom:checkbox-input-changed":!1,"dom:element-scrolled":!1,"dom:radio-input-changed":!1,"dom:select-input-changed":!1,"dom:text-input-changed":!1,"dom:window-scrolled":!1,"log:added":!1,"network:loading-finished":!1,"network:request-will-be-sent":!1,"network:response-received":!1,"runtime:console-api-called":!1,"runtime:exception-thrown":!1,"network:loading-failed":!1},Ne=class{constructor({db:e,state:t}){this.pendingTimestampSyncEvents=[];Re("connecting to database"),this.db=e,this.state=t,tt(this.db)}addEvent(e){this.addEvents([e])}addEvents(e){let t=[];for(let a of e)a.source==="cdp"&&Jn[a.type]?this.pendingTimestampSyncEvents.push(a):t.push(a);this.insertEvents(t)}flushPendingTimestampSyncEvents(){let{toFlush:e,toKeep:t}=this.pendingTimestampSyncEvents.reduce((a,s)=>{let o=this.state.getTimingForTimestamp(s.timestamp);if(o){let i=o.offset,c=s.timestamp-i;s.timestamp=c>o.clientSideStartTime?c:o.clientSideStartTime+1e-4,Xn("flushing event type %s with offset %o",s.type,i),a.toFlush.push(s)}else a.toKeep.push(s);return a},{toFlush:[],toKeep:[]});this.pendingTimestampSyncEvents=t,this.insertEvents(e)}addNetworkResponse(e){if(!this.db.open){Re("database is closed, not adding event");return}let t=xr.default.createHash("md5").update(e.body).digest("hex");this.db.prepare(vr).run({requestId:e.requestId,requestURL:e.requestURL,type:e.type,mimeType:e.mimeType,runnableId:e.runnableId,attempt:e.attempt,requestWillBeSentTimestamp:e.requestWillBeSentTimestamp,loadingFinishedTimestamp:e.loadingFinishedTimestamp,bodyHash:t}),this.db.prepare(br).run({hash:t,data:e.body,isBase64Encoded:e.isBase64Encoded?1:0})}close(){Re("closing database"),this.db.prepare("VACUUM").run(),this.db.close()}resetTest(e){if(Re("resetting test: %s",e),!this.db.open){Re("database is closed, not resetting test");return}this.db.prepare(Sr).run(e),this.pendingTimestampSyncEvents=[]}insertEvents(e){if(!this.db.open){Re("database is closed, not adding events");return}let t=this.db.prepare(yr);this.db.transaction(()=>{e.forEach(a=>{t.run({source:a.source,type:a.type,payload:JSON.stringify(a.payload),runnableId:a.runnableId,attempt:a.attempt,timestamp:a.timestamp})})})()}};Ne.SCHEMA_VERSION=tt.SCHEMA_VERSION;var Pt=z(G()),B=class{constructor(e,t,a,s){this.cdpClient=e;this.db=t;this.state=a;this.autBroker=s;this._debug=(0,Pt.default)(`cypress:protocol:capture:${this.constructor.name}`),this._debugVerbose=(0,Pt.default)(`cypress-verbose:protocol:capture:${this.constructor.name}`)}insertEvents(e){var a,s,o,i,c;let t=[];for(let d of e){let{eventType:l,eventPayload:u,eventExpectedSchema:v,timestamp:C,runnableId:Te,attempt:Ve}=d;this._debug(`Insertion attempt for ${l}`),this._debugVerbose(`${l} called with payload: %O`,u);let I=v.safeParse(u);if(!I.success){this._debug(`not adding ${l} event to database due to failed parsing: %O`,I.error);continue}this._debug(`Inserting ${l} into events table with runnableId ${Te}, attempt ${Ve}`),t.push({source:"cdp",type:d.eventType,payload:I.data,runnableId:(s=d.runnableId)!=null?s:(a=this.state.activeRunnable)==null?void 0:a.id,attempt:(i=d.attempt)!=null?i:(o=this.state.activeRunnable)==null?void 0:o.attempt,timestamp:C})}(c=this.db)==null||c.addEvents(t)}insertEvent(e,t,a,s,o,i){this.insertEvents([{eventType:e,eventPayload:t,eventExpectedSchema:a,timestamp:s,runnableId:o,attempt:i}])}};var cn=z(G());var Kn=n=>n.shadowRootType!=="user-agent",Be=(n,e)=>{var t,a;e(n),(t=n.children)==null||t.forEach(s=>{Be(s,e)}),(a=n.shadowRoots)==null||a.filter(s=>Kn(s)).forEach(s=>{Be(s,e)}),n.contentDocument&&Be(n.contentDocument,e)};var _r=()=>Cr();var x;(function(n){n.assertEqual=s=>s;function e(s){}n.assertIs=e;function t(s){throw new Error}n.assertNever=t,n.arrayToEnum=s=>{let o={};for(let i of s)o[i]=i;return o},n.getValidEnumValues=s=>{let o=n.objectKeys(s).filter(c=>typeof s[s[c]]!="number"),i={};for(let c of o)i[c]=s[c];return n.objectValues(i)},n.objectValues=s=>n.objectKeys(s).map(function(o){return s[o]}),n.objectKeys=typeof Object.keys=="function"?s=>Object.keys(s):s=>{let o=[];for(let i in s)Object.prototype.hasOwnProperty.call(s,i)&&o.push(i);return o},n.find=(s,o)=>{for(let i of s)if(o(i))return i},n.isInteger=typeof Number.isInteger=="function"?s=>Number.isInteger(s):s=>typeof s=="number"&&isFinite(s)&&Math.floor(s)===s;function a(s,o=" | "){return s.map(i=>typeof i=="string"?`'${i}'`:i).join(o)}n.joinValues=a,n.jsonStringifyReplacer=(s,o)=>typeof o=="bigint"?o.toString():o})(x||(x={}));var At;(function(n){n.mergeShapes=(e,t)=>({...e,...t})})(At||(At={}));var m=x.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),re=n=>{switch(typeof n){case"undefined":return m.undefined;case"string":return m.string;case"number":return isNaN(n)?m.nan:m.number;case"boolean":return m.boolean;case"function":return m.function;case"bigint":return m.bigint;case"symbol":return m.symbol;case"object":return Array.isArray(n)?m.array:n===null?m.null:n.then&&typeof n.then=="function"&&n.catch&&typeof n.catch=="function"?m.promise:typeof Map<"u"&&n instanceof Map?m.map:typeof Set<"u"&&n instanceof Set?m.set:typeof Date<"u"&&n instanceof Date?m.date:m.object;default:return m.unknown}},p=x.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),Qn=n=>JSON.stringify(n,null,2).replace(/"([^"]+)":/g,"$1:"),O=class extends Error{constructor(e){super(),this.issues=[],this.addIssue=a=>{this.issues=[...this.issues,a]},this.addIssues=(a=[])=>{this.issues=[...this.issues,...a]};let t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}get errors(){return this.issues}format(e){let t=e||function(o){return o.message},a={_errors:[]},s=o=>{for(let i of o.issues)if(i.code==="invalid_union")i.unionErrors.map(s);else if(i.code==="invalid_return_type")s(i.returnTypeError);else if(i.code==="invalid_arguments")s(i.argumentsError);else if(i.path.length===0)a._errors.push(t(i));else{let c=a,d=0;for(;d<i.path.length;){let l=i.path[d];d===i.path.length-1?(c[l]=c[l]||{_errors:[]},c[l]._errors.push(t(i))):c[l]=c[l]||{_errors:[]},c=c[l],d++}}};return s(this),a}toString(){return this.message}get message(){return JSON.stringify(this.issues,x.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=t=>t.message){let t={},a=[];for(let s of this.issues)s.path.length>0?(t[s.path[0]]=t[s.path[0]]||[],t[s.path[0]].push(e(s))):a.push(e(s));return{formErrors:a,fieldErrors:t}}get formErrors(){return this.flatten()}};O.create=n=>new O(n);var $e=(n,e)=>{let t;switch(n.code){case p.invalid_type:n.received===m.undefined?t="Required":t=`Expected ${n.expected}, received ${n.received}`;break;case p.invalid_literal:t=`Invalid literal value, expected ${JSON.stringify(n.expected,x.jsonStringifyReplacer)}`;break;case p.unrecognized_keys:t=`Unrecognized key(s) in object: ${x.joinValues(n.keys,", ")}`;break;case p.invalid_union:t="Invalid input";break;case p.invalid_union_discriminator:t=`Invalid discriminator value. Expected ${x.joinValues(n.options)}`;break;case p.invalid_enum_value:t=`Invalid enum value. Expected ${x.joinValues(n.options)}, received '${n.received}'`;break;case p.invalid_arguments:t="Invalid function arguments";break;case p.invalid_return_type:t="Invalid function return type";break;case p.invalid_date:t="Invalid date";break;case p.invalid_string:typeof n.validation=="object"?"includes"in n.validation?(t=`Invalid input: must include "${n.validation.includes}"`,typeof n.validation.position=="number"&&(t=`${t} at one or more positions greater than or equal to ${n.validation.position}`)):"startsWith"in n.validation?t=`Invalid input: must start with "${n.validation.startsWith}"`:"endsWith"in n.validation?t=`Invalid input: must end with "${n.validation.endsWith}"`:x.assertNever(n.validation):n.validation!=="regex"?t=`Invalid ${n.validation}`:t="Invalid";break;case p.too_small:n.type==="array"?t=`Array must contain ${n.exact?"exactly":n.inclusive?"at least":"more than"} ${n.minimum} element(s)`:n.type==="string"?t=`String must contain ${n.exact?"exactly":n.inclusive?"at least":"over"} ${n.minimum} character(s)`:n.type==="number"?t=`Number must be ${n.exact?"exactly equal to ":n.inclusive?"greater than or equal to ":"greater than "}${n.minimum}`:n.type==="date"?t=`Date must be ${n.exact?"exactly equal to ":n.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(n.minimum))}`:t="Invalid input";break;case p.too_big:n.type==="array"?t=`Array must contain ${n.exact?"exactly":n.inclusive?"at most":"less than"} ${n.maximum} element(s)`:n.type==="string"?t=`String must contain ${n.exact?"exactly":n.inclusive?"at most":"under"} ${n.maximum} character(s)`:n.type==="number"?t=`Number must be ${n.exact?"exactly":n.inclusive?"less than or equal to":"less than"} ${n.maximum}`:n.type==="bigint"?t=`BigInt must be ${n.exact?"exactly":n.inclusive?"less than or equal to":"less than"} ${n.maximum}`:n.type==="date"?t=`Date must be ${n.exact?"exactly":n.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(n.maximum))}`:t="Invalid input";break;case p.custom:t="Invalid input";break;case p.invalid_intersection_types:t="Intersection results could not be merged";break;case p.not_multiple_of:t=`Number must be a multiple of ${n.multipleOf}`;break;case p.not_finite:t="Number must be finite";break;default:t=e.defaultError,x.assertNever(n)}return{message:t}},kr=$e;function ea(n){kr=n}function nt(){return kr}var at=n=>{let{data:e,path:t,errorMaps:a,issueData:s}=n,o=[...t,...s.path||[]],i={...s,path:o},c="",d=a.filter(l=>!!l).slice().reverse();for(let l of d)c=l(i,{data:e,defaultError:c}).message;return{...s,path:o,message:s.message||c}},ta=[];function h(n,e){let t=at({issueData:e,data:n.data,path:n.path,errorMaps:[n.common.contextualErrorMap,n.schemaErrorMap,nt(),$e].filter(a=>!!a)});n.common.issues.push(t)}var T=class{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,t){let a=[];for(let s of t){if(s.status==="aborted")return y;s.status==="dirty"&&e.dirty(),a.push(s.value)}return{status:e.value,value:a}}static async mergeObjectAsync(e,t){let a=[];for(let s of t)a.push({key:await s.key,value:await s.value});return T.mergeObjectSync(e,a)}static mergeObjectSync(e,t){let a={};for(let s of t){let{key:o,value:i}=s;if(o.status==="aborted"||i.status==="aborted")return y;o.status==="dirty"&&e.dirty(),i.status==="dirty"&&e.dirty(),(typeof i.value<"u"||s.alwaysSet)&&(a[o.value]=i.value)}return{status:e.value,value:a}}},y=Object.freeze({status:"aborted"}),Er=n=>({status:"dirty",value:n}),E=n=>({status:"valid",value:n}),Mt=n=>n.status==="aborted",Dt=n=>n.status==="dirty",st=n=>n.status==="valid",ot=n=>typeof Promise<"u"&&n instanceof Promise,f;(function(n){n.errToObj=e=>typeof e=="string"?{message:e}:e||{},n.toString=e=>typeof e=="string"?e:e?.message})(f||(f={}));var j=class{constructor(e,t,a,s){this._cachedPath=[],this.parent=e,this.data=t,this._path=a,this._key=s}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}},wr=(n,e)=>{if(st(e))return{success:!0,data:e.value};if(!n.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;let t=new O(n.common.issues);return this._error=t,this._error}}};function b(n){if(!n)return{};let{errorMap:e,invalid_type_error:t,required_error:a,description:s}=n;if(e&&(t||a))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:s}:{errorMap:(i,c)=>i.code!=="invalid_type"?{message:c.defaultError}:typeof c.data>"u"?{message:a??c.defaultError}:{message:t??c.defaultError},description:s}}var S=class{constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this)}get description(){return this._def.description}_getType(e){return re(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:re(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new T,ctx:{common:e.parent.common,data:e.data,parsedType:re(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){let t=this._parse(e);if(ot(t))throw new Error("Synchronous parse encountered promise.");return t}_parseAsync(e){let t=this._parse(e);return Promise.resolve(t)}parse(e,t){let a=this.safeParse(e,t);if(a.success)return a.data;throw a.error}safeParse(e,t){var a;let s={common:{issues:[],async:(a=t?.async)!==null&&a!==void 0?a:!1,contextualErrorMap:t?.errorMap},path:t?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:re(e)},o=this._parseSync({data:e,path:s.path,parent:s});return wr(s,o)}async parseAsync(e,t){let a=await this.safeParseAsync(e,t);if(a.success)return a.data;throw a.error}async safeParseAsync(e,t){let a={common:{issues:[],contextualErrorMap:t?.errorMap,async:!0},path:t?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:re(e)},s=this._parse({data:e,path:a.path,parent:a}),o=await(ot(s)?s:Promise.resolve(s));return wr(a,o)}refine(e,t){let a=s=>typeof t=="string"||typeof t>"u"?{message:t}:typeof t=="function"?t(s):t;return this._refinement((s,o)=>{let i=e(s),c=()=>o.addIssue({code:p.custom,...a(s)});return typeof Promise<"u"&&i instanceof Promise?i.then(d=>d?!0:(c(),!1)):i?!0:(c(),!1)})}refinement(e,t){return this._refinement((a,s)=>e(a)?!0:(s.addIssue(typeof t=="function"?t(a,s):t),!1))}_refinement(e){return new A({schema:this,typeName:g.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}optional(){return F.create(this,this._def)}nullable(){return K.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return P.create(this,this._def)}promise(){return se.create(this,this._def)}or(e){return he.create([this,e],this._def)}and(e){return fe.create(this,e,this._def)}transform(e){return new A({...b(this._def),schema:this,typeName:g.ZodEffects,effect:{type:"transform",transform:e}})}default(e){let t=typeof e=="function"?e:()=>e;return new Se({...b(this._def),innerType:this,defaultValue:t,typeName:g.ZodDefault})}brand(){return new it({typeName:g.ZodBranded,type:this,...b(this._def)})}catch(e){let t=typeof e=="function"?e:()=>e;return new Le({...b(this._def),innerType:this,catchValue:t,typeName:g.ZodCatch})}describe(e){let t=this.constructor;return new t({...this._def,description:e})}pipe(e){return xe.create(this,e)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}},ra=/^c[^\s-]{8,}$/i,na=/^[a-z][a-z0-9]*$/,aa=/[0-9A-HJKMNP-TV-Z]{26}/,sa=/^([a-f0-9]{8}-[a-f0-9]{4}-[1-5][a-f0-9]{3}-[a-f0-9]{4}-[a-f0-9]{12}|00000000-0000-0000-0000-000000000000)$/i,oa=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\])|(\[IPv6:(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))\])|([A-Za-z0-9]([A-Za-z0-9-]*[A-Za-z0-9])*(\.[A-Za-z]{2,})+))$/,ia=/^(\p{Extended_Pictographic}|\p{Emoji_Component})+$/u,ca=/^(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))$/,da=/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,la=n=>n.precision?n.offset?new RegExp(`^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}\\.\\d{${n.precision}}(([+-]\\d{2}(:?\\d{2})?)|Z)$`):new RegExp(`^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}\\.\\d{${n.precision}}Z$`):n.precision===0?n.offset?new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(([+-]\\d{2}(:?\\d{2})?)|Z)$"):new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}Z$"):n.offset?new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(\\.\\d+)?(([+-]\\d{2}(:?\\d{2})?)|Z)$"):new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(\\.\\d+)?Z$");function ua(n,e){return!!((e==="v4"||!e)&&ca.test(n)||(e==="v6"||!e)&&da.test(n))}var N=class extends S{constructor(){super(...arguments),this._regex=(e,t,a)=>this.refinement(s=>e.test(s),{validation:t,code:p.invalid_string,...f.errToObj(a)}),this.nonempty=e=>this.min(1,f.errToObj(e)),this.trim=()=>new N({...this._def,checks:[...this._def.checks,{kind:"trim"}]}),this.toLowerCase=()=>new N({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]}),this.toUpperCase=()=>new N({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==m.string){let o=this._getOrReturnCtx(e);return h(o,{code:p.invalid_type,expected:m.string,received:o.parsedType}),y}let a=new T,s;for(let o of this._def.checks)if(o.kind==="min")e.data.length<o.value&&(s=this._getOrReturnCtx(e,s),h(s,{code:p.too_small,minimum:o.value,type:"string",inclusive:!0,exact:!1,message:o.message}),a.dirty());else if(o.kind==="max")e.data.length>o.value&&(s=this._getOrReturnCtx(e,s),h(s,{code:p.too_big,maximum:o.value,type:"string",inclusive:!0,exact:!1,message:o.message}),a.dirty());else if(o.kind==="length"){let i=e.data.length>o.value,c=e.data.length<o.value;(i||c)&&(s=this._getOrReturnCtx(e,s),i?h(s,{code:p.too_big,maximum:o.value,type:"string",inclusive:!0,exact:!0,message:o.message}):c&&h(s,{code:p.too_small,minimum:o.value,type:"string",inclusive:!0,exact:!0,message:o.message}),a.dirty())}else if(o.kind==="email")oa.test(e.data)||(s=this._getOrReturnCtx(e,s),h(s,{validation:"email",code:p.invalid_string,message:o.message}),a.dirty());else if(o.kind==="emoji")ia.test(e.data)||(s=this._getOrReturnCtx(e,s),h(s,{validation:"emoji",code:p.invalid_string,message:o.message}),a.dirty());else if(o.kind==="uuid")sa.test(e.data)||(s=this._getOrReturnCtx(e,s),h(s,{validation:"uuid",code:p.invalid_string,message:o.message}),a.dirty());else if(o.kind==="cuid")ra.test(e.data)||(s=this._getOrReturnCtx(e,s),h(s,{validation:"cuid",code:p.invalid_string,message:o.message}),a.dirty());else if(o.kind==="cuid2")na.test(e.data)||(s=this._getOrReturnCtx(e,s),h(s,{validation:"cuid2",code:p.invalid_string,message:o.message}),a.dirty());else if(o.kind==="ulid")aa.test(e.data)||(s=this._getOrReturnCtx(e,s),h(s,{validation:"ulid",code:p.invalid_string,message:o.message}),a.dirty());else if(o.kind==="url")try{new URL(e.data)}catch{s=this._getOrReturnCtx(e,s),h(s,{validation:"url",code:p.invalid_string,message:o.message}),a.dirty()}else o.kind==="regex"?(o.regex.lastIndex=0,o.regex.test(e.data)||(s=this._getOrReturnCtx(e,s),h(s,{validation:"regex",code:p.invalid_string,message:o.message}),a.dirty())):o.kind==="trim"?e.data=e.data.trim():o.kind==="includes"?e.data.includes(o.value,o.position)||(s=this._getOrReturnCtx(e,s),h(s,{code:p.invalid_string,validation:{includes:o.value,position:o.position},message:o.message}),a.dirty()):o.kind==="toLowerCase"?e.data=e.data.toLowerCase():o.kind==="toUpperCase"?e.data=e.data.toUpperCase():o.kind==="startsWith"?e.data.startsWith(o.value)||(s=this._getOrReturnCtx(e,s),h(s,{code:p.invalid_string,validation:{startsWith:o.value},message:o.message}),a.dirty()):o.kind==="endsWith"?e.data.endsWith(o.value)||(s=this._getOrReturnCtx(e,s),h(s,{code:p.invalid_string,validation:{endsWith:o.value},message:o.message}),a.dirty()):o.kind==="datetime"?la(o).test(e.data)||(s=this._getOrReturnCtx(e,s),h(s,{code:p.invalid_string,validation:"datetime",message:o.message}),a.dirty()):o.kind==="ip"?ua(e.data,o.version)||(s=this._getOrReturnCtx(e,s),h(s,{validation:"ip",code:p.invalid_string,message:o.message}),a.dirty()):x.assertNever(o);return{status:a.value,value:e.data}}_addCheck(e){return new N({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...f.errToObj(e)})}url(e){return this._addCheck({kind:"url",...f.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...f.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...f.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...f.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...f.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...f.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...f.errToObj(e)})}datetime(e){var t;return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof e?.precision>"u"?null:e?.precision,offset:(t=e?.offset)!==null&&t!==void 0?t:!1,...f.errToObj(e?.message)})}regex(e,t){return this._addCheck({kind:"regex",regex:e,...f.errToObj(t)})}includes(e,t){return this._addCheck({kind:"includes",value:e,position:t?.position,...f.errToObj(t?.message)})}startsWith(e,t){return this._addCheck({kind:"startsWith",value:e,...f.errToObj(t)})}endsWith(e,t){return this._addCheck({kind:"endsWith",value:e,...f.errToObj(t)})}min(e,t){return this._addCheck({kind:"min",value:e,...f.errToObj(t)})}max(e,t){return this._addCheck({kind:"max",value:e,...f.errToObj(t)})}length(e,t){return this._addCheck({kind:"length",value:e,...f.errToObj(t)})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get minLength(){let e=null;for(let t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(let t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}};N.create=n=>{var e;return new N({checks:[],typeName:g.ZodString,coerce:(e=n?.coerce)!==null&&e!==void 0?e:!1,...b(n)})};function pa(n,e){let t=(n.toString().split(".")[1]||"").length,a=(e.toString().split(".")[1]||"").length,s=t>a?t:a,o=parseInt(n.toFixed(s).replace(".","")),i=parseInt(e.toFixed(s).replace(".",""));return o%i/Math.pow(10,s)}var $=class extends S{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==m.number){let o=this._getOrReturnCtx(e);return h(o,{code:p.invalid_type,expected:m.number,received:o.parsedType}),y}let a,s=new T;for(let o of this._def.checks)o.kind==="int"?x.isInteger(e.data)||(a=this._getOrReturnCtx(e,a),h(a,{code:p.invalid_type,expected:"integer",received:"float",message:o.message}),s.dirty()):o.kind==="min"?(o.inclusive?e.data<o.value:e.data<=o.value)&&(a=this._getOrReturnCtx(e,a),h(a,{code:p.too_small,minimum:o.value,type:"number",inclusive:o.inclusive,exact:!1,message:o.message}),s.dirty()):o.kind==="max"?(o.inclusive?e.data>o.value:e.data>=o.value)&&(a=this._getOrReturnCtx(e,a),h(a,{code:p.too_big,maximum:o.value,type:"number",inclusive:o.inclusive,exact:!1,message:o.message}),s.dirty()):o.kind==="multipleOf"?pa(e.data,o.value)!==0&&(a=this._getOrReturnCtx(e,a),h(a,{code:p.not_multiple_of,multipleOf:o.value,message:o.message}),s.dirty()):o.kind==="finite"?Number.isFinite(e.data)||(a=this._getOrReturnCtx(e,a),h(a,{code:p.not_finite,message:o.message}),s.dirty()):x.assertNever(o);return{status:s.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,f.toString(t))}gt(e,t){return this.setLimit("min",e,!1,f.toString(t))}lte(e,t){return this.setLimit("max",e,!0,f.toString(t))}lt(e,t){return this.setLimit("max",e,!1,f.toString(t))}setLimit(e,t,a,s){return new $({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:a,message:f.toString(s)}]})}_addCheck(e){return new $({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:f.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:f.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:f.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:f.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:f.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:f.toString(t)})}finite(e){return this._addCheck({kind:"finite",message:f.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:f.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:f.toString(e)})}get minValue(){let e=null;for(let t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(let t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&x.isInteger(e.value))}get isFinite(){let e=null,t=null;for(let a of this._def.checks){if(a.kind==="finite"||a.kind==="int"||a.kind==="multipleOf")return!0;a.kind==="min"?(t===null||a.value>t)&&(t=a.value):a.kind==="max"&&(e===null||a.value<e)&&(e=a.value)}return Number.isFinite(t)&&Number.isFinite(e)}};$.create=n=>new $({checks:[],typeName:g.ZodNumber,coerce:n?.coerce||!1,...b(n)});var V=class extends S{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce&&(e.data=BigInt(e.data)),this._getType(e)!==m.bigint){let o=this._getOrReturnCtx(e);return h(o,{code:p.invalid_type,expected:m.bigint,received:o.parsedType}),y}let a,s=new T;for(let o of this._def.checks)o.kind==="min"?(o.inclusive?e.data<o.value:e.data<=o.value)&&(a=this._getOrReturnCtx(e,a),h(a,{code:p.too_small,type:"bigint",minimum:o.value,inclusive:o.inclusive,message:o.message}),s.dirty()):o.kind==="max"?(o.inclusive?e.data>o.value:e.data>=o.value)&&(a=this._getOrReturnCtx(e,a),h(a,{code:p.too_big,type:"bigint",maximum:o.value,inclusive:o.inclusive,message:o.message}),s.dirty()):o.kind==="multipleOf"?e.data%o.value!==BigInt(0)&&(a=this._getOrReturnCtx(e,a),h(a,{code:p.not_multiple_of,multipleOf:o.value,message:o.message}),s.dirty()):x.assertNever(o);return{status:s.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,f.toString(t))}gt(e,t){return this.setLimit("min",e,!1,f.toString(t))}lte(e,t){return this.setLimit("max",e,!0,f.toString(t))}lt(e,t){return this.setLimit("max",e,!1,f.toString(t))}setLimit(e,t,a,s){return new V({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:a,message:f.toString(s)}]})}_addCheck(e){return new V({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:f.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:f.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:f.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:f.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:f.toString(t)})}get minValue(){let e=null;for(let t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(let t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}};V.create=n=>{var e;return new V({checks:[],typeName:g.ZodBigInt,coerce:(e=n?.coerce)!==null&&e!==void 0?e:!1,...b(n)})};var ue=class extends S{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==m.boolean){let a=this._getOrReturnCtx(e);return h(a,{code:p.invalid_type,expected:m.boolean,received:a.parsedType}),y}return E(e.data)}};ue.create=n=>new ue({typeName:g.ZodBoolean,coerce:n?.coerce||!1,...b(n)});var J=class extends S{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==m.date){let o=this._getOrReturnCtx(e);return h(o,{code:p.invalid_type,expected:m.date,received:o.parsedType}),y}if(isNaN(e.data.getTime())){let o=this._getOrReturnCtx(e);return h(o,{code:p.invalid_date}),y}let a=new T,s;for(let o of this._def.checks)o.kind==="min"?e.data.getTime()<o.value&&(s=this._getOrReturnCtx(e,s),h(s,{code:p.too_small,message:o.message,inclusive:!0,exact:!1,minimum:o.value,type:"date"}),a.dirty()):o.kind==="max"?e.data.getTime()>o.value&&(s=this._getOrReturnCtx(e,s),h(s,{code:p.too_big,message:o.message,inclusive:!0,exact:!1,maximum:o.value,type:"date"}),a.dirty()):x.assertNever(o);return{status:a.value,value:new Date(e.data.getTime())}}_addCheck(e){return new J({...this._def,checks:[...this._def.checks,e]})}min(e,t){return this._addCheck({kind:"min",value:e.getTime(),message:f.toString(t)})}max(e,t){return this._addCheck({kind:"max",value:e.getTime(),message:f.toString(t)})}get minDate(){let e=null;for(let t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(let t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e!=null?new Date(e):null}};J.create=n=>new J({checks:[],coerce:n?.coerce||!1,typeName:g.ZodDate,...b(n)});var Pe=class extends S{_parse(e){if(this._getType(e)!==m.symbol){let a=this._getOrReturnCtx(e);return h(a,{code:p.invalid_type,expected:m.symbol,received:a.parsedType}),y}return E(e.data)}};Pe.create=n=>new Pe({typeName:g.ZodSymbol,...b(n)});var pe=class extends S{_parse(e){if(this._getType(e)!==m.undefined){let a=this._getOrReturnCtx(e);return h(a,{code:p.invalid_type,expected:m.undefined,received:a.parsedType}),y}return E(e.data)}};pe.create=n=>new pe({typeName:g.ZodUndefined,...b(n)});var me=class extends S{_parse(e){if(this._getType(e)!==m.null){let a=this._getOrReturnCtx(e);return h(a,{code:p.invalid_type,expected:m.null,received:a.parsedType}),y}return E(e.data)}};me.create=n=>new me({typeName:g.ZodNull,...b(n)});var ae=class extends S{constructor(){super(...arguments),this._any=!0}_parse(e){return E(e.data)}};ae.create=n=>new ae({typeName:g.ZodAny,...b(n)});var X=class extends S{constructor(){super(...arguments),this._unknown=!0}_parse(e){return E(e.data)}};X.create=n=>new X({typeName:g.ZodUnknown,...b(n)});var U=class extends S{_parse(e){let t=this._getOrReturnCtx(e);return h(t,{code:p.invalid_type,expected:m.never,received:t.parsedType}),y}};U.create=n=>new U({typeName:g.ZodNever,...b(n)});var Ae=class extends S{_parse(e){if(this._getType(e)!==m.undefined){let a=this._getOrReturnCtx(e);return h(a,{code:p.invalid_type,expected:m.void,received:a.parsedType}),y}return E(e.data)}};Ae.create=n=>new Ae({typeName:g.ZodVoid,...b(n)});var P=class extends S{_parse(e){let{ctx:t,status:a}=this._processInputParams(e),s=this._def;if(t.parsedType!==m.array)return h(t,{code:p.invalid_type,expected:m.array,received:t.parsedType}),y;if(s.exactLength!==null){let i=t.data.length>s.exactLength.value,c=t.data.length<s.exactLength.value;(i||c)&&(h(t,{code:i?p.too_big:p.too_small,minimum:c?s.exactLength.value:void 0,maximum:i?s.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:s.exactLength.message}),a.dirty())}if(s.minLength!==null&&t.data.length<s.minLength.value&&(h(t,{code:p.too_small,minimum:s.minLength.value,type:"array",inclusive:!0,exact:!1,message:s.minLength.message}),a.dirty()),s.maxLength!==null&&t.data.length>s.maxLength.value&&(h(t,{code:p.too_big,maximum:s.maxLength.value,type:"array",inclusive:!0,exact:!1,message:s.maxLength.message}),a.dirty()),t.common.async)return Promise.all([...t.data].map((i,c)=>s.type._parseAsync(new j(t,i,t.path,c)))).then(i=>T.mergeArray(a,i));let o=[...t.data].map((i,c)=>s.type._parseSync(new j(t,i,t.path,c)));return T.mergeArray(a,o)}get element(){return this._def.type}min(e,t){return new P({...this._def,minLength:{value:e,message:f.toString(t)}})}max(e,t){return new P({...this._def,maxLength:{value:e,message:f.toString(t)}})}length(e,t){return new P({...this._def,exactLength:{value:e,message:f.toString(t)}})}nonempty(e){return this.min(1,e)}};P.create=(n,e)=>new P({type:n,minLength:null,maxLength:null,exactLength:null,typeName:g.ZodArray,...b(e)});function Oe(n){if(n instanceof _){let e={};for(let t in n.shape){let a=n.shape[t];e[t]=F.create(Oe(a))}return new _({...n._def,shape:()=>e})}else return n instanceof P?new P({...n._def,type:Oe(n.element)}):n instanceof F?F.create(Oe(n.unwrap())):n instanceof K?K.create(Oe(n.unwrap())):n instanceof q?q.create(n.items.map(e=>Oe(e))):n}var _=class extends S{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;let e=this._def.shape(),t=x.objectKeys(e);return this._cached={shape:e,keys:t}}_parse(e){if(this._getType(e)!==m.object){let l=this._getOrReturnCtx(e);return h(l,{code:p.invalid_type,expected:m.object,received:l.parsedType}),y}let{status:a,ctx:s}=this._processInputParams(e),{shape:o,keys:i}=this._getCached(),c=[];if(!(this._def.catchall instanceof U&&this._def.unknownKeys==="strip"))for(let l in s.data)i.includes(l)||c.push(l);let d=[];for(let l of i){let u=o[l],v=s.data[l];d.push({key:{status:"valid",value:l},value:u._parse(new j(s,v,s.path,l)),alwaysSet:l in s.data})}if(this._def.catchall instanceof U){let l=this._def.unknownKeys;if(l==="passthrough")for(let u of c)d.push({key:{status:"valid",value:u},value:{status:"valid",value:s.data[u]}});else if(l==="strict")c.length>0&&(h(s,{code:p.unrecognized_keys,keys:c}),a.dirty());else if(l!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{let l=this._def.catchall;for(let u of c){let v=s.data[u];d.push({key:{status:"valid",value:u},value:l._parse(new j(s,v,s.path,u)),alwaysSet:u in s.data})}}return s.common.async?Promise.resolve().then(async()=>{let l=[];for(let u of d){let v=await u.key;l.push({key:v,value:await u.value,alwaysSet:u.alwaysSet})}return l}).then(l=>T.mergeObjectSync(a,l)):T.mergeObjectSync(a,d)}get shape(){return this._def.shape()}strict(e){return f.errToObj,new _({...this._def,unknownKeys:"strict",...e!==void 0?{errorMap:(t,a)=>{var s,o,i,c;let d=(i=(o=(s=this._def).errorMap)===null||o===void 0?void 0:o.call(s,t,a).message)!==null&&i!==void 0?i:a.defaultError;return t.code==="unrecognized_keys"?{message:(c=f.errToObj(e).message)!==null&&c!==void 0?c:d}:{message:d}}}:{}})}strip(){return new _({...this._def,unknownKeys:"strip"})}passthrough(){return new _({...this._def,unknownKeys:"passthrough"})}extend(e){return new _({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new _({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:g.ZodObject})}setKey(e,t){return this.augment({[e]:t})}catchall(e){return new _({...this._def,catchall:e})}pick(e){let t={};return x.objectKeys(e).forEach(a=>{e[a]&&this.shape[a]&&(t[a]=this.shape[a])}),new _({...this._def,shape:()=>t})}omit(e){let t={};return x.objectKeys(this.shape).forEach(a=>{e[a]||(t[a]=this.shape[a])}),new _({...this._def,shape:()=>t})}deepPartial(){return Oe(this)}partial(e){let t={};return x.objectKeys(this.shape).forEach(a=>{let s=this.shape[a];e&&!e[a]?t[a]=s:t[a]=s.optional()}),new _({...this._def,shape:()=>t})}required(e){let t={};return x.objectKeys(this.shape).forEach(a=>{if(e&&!e[a])t[a]=this.shape[a];else{let o=this.shape[a];for(;o instanceof F;)o=o._def.innerType;t[a]=o}}),new _({...this._def,shape:()=>t})}keyof(){return Ir(x.objectKeys(this.shape))}};_.create=(n,e)=>new _({shape:()=>n,unknownKeys:"strip",catchall:U.create(),typeName:g.ZodObject,...b(e)});_.strictCreate=(n,e)=>new _({shape:()=>n,unknownKeys:"strict",catchall:U.create(),typeName:g.ZodObject,...b(e)});_.lazycreate=(n,e)=>new _({shape:n,unknownKeys:"strip",catchall:U.create(),typeName:g.ZodObject,...b(e)});var he=class extends S{_parse(e){let{ctx:t}=this._processInputParams(e),a=this._def.options;function s(o){for(let c of o)if(c.result.status==="valid")return c.result;for(let c of o)if(c.result.status==="dirty")return t.common.issues.push(...c.ctx.common.issues),c.result;let i=o.map(c=>new O(c.ctx.common.issues));return h(t,{code:p.invalid_union,unionErrors:i}),y}if(t.common.async)return Promise.all(a.map(async o=>{let i={...t,common:{...t.common,issues:[]},parent:null};return{result:await o._parseAsync({data:t.data,path:t.path,parent:i}),ctx:i}})).then(s);{let o,i=[];for(let d of a){let l={...t,common:{...t.common,issues:[]},parent:null},u=d._parseSync({data:t.data,path:t.path,parent:l});if(u.status==="valid")return u;u.status==="dirty"&&!o&&(o={result:u,ctx:l}),l.common.issues.length&&i.push(l.common.issues)}if(o)return t.common.issues.push(...o.ctx.common.issues),o.result;let c=i.map(d=>new O(d));return h(t,{code:p.invalid_union,unionErrors:c}),y}}get options(){return this._def.options}};he.create=(n,e)=>new he({options:n,typeName:g.ZodUnion,...b(e)});var rt=n=>n instanceof ye?rt(n.schema):n instanceof A?rt(n.innerType()):n instanceof ve?[n.value]:n instanceof W?n.options:n instanceof be?Object.keys(n.enum):n instanceof Se?rt(n._def.innerType):n instanceof pe?[void 0]:n instanceof me?[null]:null,Me=class extends S{_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==m.object)return h(t,{code:p.invalid_type,expected:m.object,received:t.parsedType}),y;let a=this.discriminator,s=t.data[a],o=this.optionsMap.get(s);return o?t.common.async?o._parseAsync({data:t.data,path:t.path,parent:t}):o._parseSync({data:t.data,path:t.path,parent:t}):(h(t,{code:p.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[a]}),y)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,t,a){let s=new Map;for(let o of t){let i=rt(o.shape[e]);if(!i)throw new Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(let c of i){if(s.has(c))throw new Error(`Discriminator property ${String(e)} has duplicate value ${String(c)}`);s.set(c,o)}}return new Me({typeName:g.ZodDiscriminatedUnion,discriminator:e,options:t,optionsMap:s,...b(a)})}};function Lt(n,e){let t=re(n),a=re(e);if(n===e)return{valid:!0,data:n};if(t===m.object&&a===m.object){let s=x.objectKeys(e),o=x.objectKeys(n).filter(c=>s.indexOf(c)!==-1),i={...n,...e};for(let c of o){let d=Lt(n[c],e[c]);if(!d.valid)return{valid:!1};i[c]=d.data}return{valid:!0,data:i}}else if(t===m.array&&a===m.array){if(n.length!==e.length)return{valid:!1};let s=[];for(let o=0;o<n.length;o++){let i=n[o],c=e[o],d=Lt(i,c);if(!d.valid)return{valid:!1};s.push(d.data)}return{valid:!0,data:s}}else return t===m.date&&a===m.date&&+n==+e?{valid:!0,data:n}:{valid:!1}}var fe=class extends S{_parse(e){let{status:t,ctx:a}=this._processInputParams(e),s=(o,i)=>{if(Mt(o)||Mt(i))return y;let c=Lt(o.value,i.value);return c.valid?((Dt(o)||Dt(i))&&t.dirty(),{status:t.value,value:c.data}):(h(a,{code:p.invalid_intersection_types}),y)};return a.common.async?Promise.all([this._def.left._parseAsync({data:a.data,path:a.path,parent:a}),this._def.right._parseAsync({data:a.data,path:a.path,parent:a})]).then(([o,i])=>s(o,i)):s(this._def.left._parseSync({data:a.data,path:a.path,parent:a}),this._def.right._parseSync({data:a.data,path:a.path,parent:a}))}};fe.create=(n,e,t)=>new fe({left:n,right:e,typeName:g.ZodIntersection,...b(t)});var q=class extends S{_parse(e){let{status:t,ctx:a}=this._processInputParams(e);if(a.parsedType!==m.array)return h(a,{code:p.invalid_type,expected:m.array,received:a.parsedType}),y;if(a.data.length<this._def.items.length)return h(a,{code:p.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),y;!this._def.rest&&a.data.length>this._def.items.length&&(h(a,{code:p.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),t.dirty());let o=[...a.data].map((i,c)=>{let d=this._def.items[c]||this._def.rest;return d?d._parse(new j(a,i,a.path,c)):null}).filter(i=>!!i);return a.common.async?Promise.all(o).then(i=>T.mergeArray(t,i)):T.mergeArray(t,o)}get items(){return this._def.items}rest(e){return new q({...this._def,rest:e})}};q.create=(n,e)=>{if(!Array.isArray(n))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new q({items:n,typeName:g.ZodTuple,rest:null,...b(e)})};var ge=class extends S{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:t,ctx:a}=this._processInputParams(e);if(a.parsedType!==m.object)return h(a,{code:p.invalid_type,expected:m.object,received:a.parsedType}),y;let s=[],o=this._def.keyType,i=this._def.valueType;for(let c in a.data)s.push({key:o._parse(new j(a,c,a.path,c)),value:i._parse(new j(a,a.data[c],a.path,c))});return a.common.async?T.mergeObjectAsync(t,s):T.mergeObjectSync(t,s)}get element(){return this._def.valueType}static create(e,t,a){return t instanceof S?new ge({keyType:e,valueType:t,typeName:g.ZodRecord,...b(a)}):new ge({keyType:N.create(),valueType:e,typeName:g.ZodRecord,...b(t)})}},De=class extends S{_parse(e){let{status:t,ctx:a}=this._processInputParams(e);if(a.parsedType!==m.map)return h(a,{code:p.invalid_type,expected:m.map,received:a.parsedType}),y;let s=this._def.keyType,o=this._def.valueType,i=[...a.data.entries()].map(([c,d],l)=>({key:s._parse(new j(a,c,a.path,[l,"key"])),value:o._parse(new j(a,d,a.path,[l,"value"]))}));if(a.common.async){let c=new Map;return Promise.resolve().then(async()=>{for(let d of i){let l=await d.key,u=await d.value;if(l.status==="aborted"||u.status==="aborted")return y;(l.status==="dirty"||u.status==="dirty")&&t.dirty(),c.set(l.value,u.value)}return{status:t.value,value:c}})}else{let c=new Map;for(let d of i){let l=d.key,u=d.value;if(l.status==="aborted"||u.status==="aborted")return y;(l.status==="dirty"||u.status==="dirty")&&t.dirty(),c.set(l.value,u.value)}return{status:t.value,value:c}}}};De.create=(n,e,t)=>new De({valueType:e,keyType:n,typeName:g.ZodMap,...b(t)});var Y=class extends S{_parse(e){let{status:t,ctx:a}=this._processInputParams(e);if(a.parsedType!==m.set)return h(a,{code:p.invalid_type,expected:m.set,received:a.parsedType}),y;let s=this._def;s.minSize!==null&&a.data.size<s.minSize.value&&(h(a,{code:p.too_small,minimum:s.minSize.value,type:"set",inclusive:!0,exact:!1,message:s.minSize.message}),t.dirty()),s.maxSize!==null&&a.data.size>s.maxSize.value&&(h(a,{code:p.too_big,maximum:s.maxSize.value,type:"set",inclusive:!0,exact:!1,message:s.maxSize.message}),t.dirty());let o=this._def.valueType;function i(d){let l=new Set;for(let u of d){if(u.status==="aborted")return y;u.status==="dirty"&&t.dirty(),l.add(u.value)}return{status:t.value,value:l}}let c=[...a.data.values()].map((d,l)=>o._parse(new j(a,d,a.path,l)));return a.common.async?Promise.all(c).then(d=>i(d)):i(c)}min(e,t){return new Y({...this._def,minSize:{value:e,message:f.toString(t)}})}max(e,t){return new Y({...this._def,maxSize:{value:e,message:f.toString(t)}})}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}};Y.create=(n,e)=>new Y({valueType:n,minSize:null,maxSize:null,typeName:g.ZodSet,...b(e)});var ne=class extends S{constructor(){super(...arguments),this.validate=this.implement}_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==m.function)return h(t,{code:p.invalid_type,expected:m.function,received:t.parsedType}),y;function a(c,d){return at({data:c,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,nt(),$e].filter(l=>!!l),issueData:{code:p.invalid_arguments,argumentsError:d}})}function s(c,d){return at({data:c,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,nt(),$e].filter(l=>!!l),issueData:{code:p.invalid_return_type,returnTypeError:d}})}let o={errorMap:t.common.contextualErrorMap},i=t.data;return this._def.returns instanceof se?E(async(...c)=>{let d=new O([]),l=await this._def.args.parseAsync(c,o).catch(C=>{throw d.addIssue(a(c,C)),d}),u=await i(...l);return await this._def.returns._def.type.parseAsync(u,o).catch(C=>{throw d.addIssue(s(u,C)),d})}):E((...c)=>{let d=this._def.args.safeParse(c,o);if(!d.success)throw new O([a(c,d.error)]);let l=i(...d.data),u=this._def.returns.safeParse(l,o);if(!u.success)throw new O([s(l,u.error)]);return u.data})}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new ne({...this._def,args:q.create(e).rest(X.create())})}returns(e){return new ne({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,t,a){return new ne({args:e||q.create([]).rest(X.create()),returns:t||X.create(),typeName:g.ZodFunction,...b(a)})}},ye=class extends S{get schema(){return this._def.getter()}_parse(e){let{ctx:t}=this._processInputParams(e);return this._def.getter()._parse({data:t.data,path:t.path,parent:t})}};ye.create=(n,e)=>new ye({getter:n,typeName:g.ZodLazy,...b(e)});var ve=class extends S{_parse(e){if(e.data!==this._def.value){let t=this._getOrReturnCtx(e);return h(t,{received:t.data,code:p.invalid_literal,expected:this._def.value}),y}return{status:"valid",value:e.data}}get value(){return this._def.value}};ve.create=(n,e)=>new ve({value:n,typeName:g.ZodLiteral,...b(e)});function Ir(n,e){return new W({values:n,typeName:g.ZodEnum,...b(e)})}var W=class extends S{_parse(e){if(typeof e.data!="string"){let t=this._getOrReturnCtx(e),a=this._def.values;return h(t,{expected:x.joinValues(a),received:t.parsedType,code:p.invalid_type}),y}if(this._def.values.indexOf(e.data)===-1){let t=this._getOrReturnCtx(e),a=this._def.values;return h(t,{received:t.data,code:p.invalid_enum_value,options:a}),y}return E(e.data)}get options(){return this._def.values}get enum(){let e={};for(let t of this._def.values)e[t]=t;return e}get Values(){let e={};for(let t of this._def.values)e[t]=t;return e}get Enum(){let e={};for(let t of this._def.values)e[t]=t;return e}extract(e){return W.create(e)}exclude(e){return W.create(this.options.filter(t=>!e.includes(t)))}};W.create=Ir;var be=class extends S{_parse(e){let t=x.getValidEnumValues(this._def.values),a=this._getOrReturnCtx(e);if(a.parsedType!==m.string&&a.parsedType!==m.number){let s=x.objectValues(t);return h(a,{expected:x.joinValues(s),received:a.parsedType,code:p.invalid_type}),y}if(t.indexOf(e.data)===-1){let s=x.objectValues(t);return h(a,{received:a.data,code:p.invalid_enum_value,options:s}),y}return E(e.data)}get enum(){return this._def.values}};be.create=(n,e)=>new be({values:n,typeName:g.ZodNativeEnum,...b(e)});var se=class extends S{unwrap(){return this._def.type}_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==m.promise&&t.common.async===!1)return h(t,{code:p.invalid_type,expected:m.promise,received:t.parsedType}),y;let a=t.parsedType===m.promise?t.data:Promise.resolve(t.data);return E(a.then(s=>this._def.type.parseAsync(s,{path:t.path,errorMap:t.common.contextualErrorMap})))}};se.create=(n,e)=>new se({type:n,typeName:g.ZodPromise,...b(e)});var A=class extends S{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===g.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){let{status:t,ctx:a}=this._processInputParams(e),s=this._def.effect||null;if(s.type==="preprocess"){let i=s.transform(a.data);return a.common.async?Promise.resolve(i).then(c=>this._def.schema._parseAsync({data:c,path:a.path,parent:a})):this._def.schema._parseSync({data:i,path:a.path,parent:a})}let o={addIssue:i=>{h(a,i),i.fatal?t.abort():t.dirty()},get path(){return a.path}};if(o.addIssue=o.addIssue.bind(o),s.type==="refinement"){let i=c=>{let d=s.refinement(c,o);if(a.common.async)return Promise.resolve(d);if(d instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return c};if(a.common.async===!1){let c=this._def.schema._parseSync({data:a.data,path:a.path,parent:a});return c.status==="aborted"?y:(c.status==="dirty"&&t.dirty(),i(c.value),{status:t.value,value:c.value})}else return this._def.schema._parseAsync({data:a.data,path:a.path,parent:a}).then(c=>c.status==="aborted"?y:(c.status==="dirty"&&t.dirty(),i(c.value).then(()=>({status:t.value,value:c.value}))))}if(s.type==="transform")if(a.common.async===!1){let i=this._def.schema._parseSync({data:a.data,path:a.path,parent:a});if(!st(i))return i;let c=s.transform(i.value,o);if(c instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:t.value,value:c}}else return this._def.schema._parseAsync({data:a.data,path:a.path,parent:a}).then(i=>st(i)?Promise.resolve(s.transform(i.value,o)).then(c=>({status:t.value,value:c})):i);x.assertNever(s)}};A.create=(n,e,t)=>new A({schema:n,typeName:g.ZodEffects,effect:e,...b(t)});A.createWithPreprocess=(n,e,t)=>new A({schema:e,effect:{type:"preprocess",transform:n},typeName:g.ZodEffects,...b(t)});var F=class extends S{_parse(e){return this._getType(e)===m.undefined?E(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}};F.create=(n,e)=>new F({innerType:n,typeName:g.ZodOptional,...b(e)});var K=class extends S{_parse(e){return this._getType(e)===m.null?E(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}};K.create=(n,e)=>new K({innerType:n,typeName:g.ZodNullable,...b(e)});var Se=class extends S{_parse(e){let{ctx:t}=this._processInputParams(e),a=t.data;return t.parsedType===m.undefined&&(a=this._def.defaultValue()),this._def.innerType._parse({data:a,path:t.path,parent:t})}removeDefault(){return this._def.innerType}};Se.create=(n,e)=>new Se({innerType:n,typeName:g.ZodDefault,defaultValue:typeof e.default=="function"?e.default:()=>e.default,...b(e)});var Le=class extends S{_parse(e){let{ctx:t}=this._processInputParams(e),a={...t,common:{...t.common,issues:[]}},s=this._def.innerType._parse({data:a.data,path:a.path,parent:{...a}});return ot(s)?s.then(o=>({status:"valid",value:o.status==="valid"?o.value:this._def.catchValue({get error(){return new O(a.common.issues)},input:a.data})})):{status:"valid",value:s.status==="valid"?s.value:this._def.catchValue({get error(){return new O(a.common.issues)},input:a.data})}}removeCatch(){return this._def.innerType}};Le.create=(n,e)=>new Le({innerType:n,typeName:g.ZodCatch,catchValue:typeof e.catch=="function"?e.catch:()=>e.catch,...b(e)});var je=class extends S{_parse(e){if(this._getType(e)!==m.nan){let a=this._getOrReturnCtx(e);return h(a,{code:p.invalid_type,expected:m.nan,received:a.parsedType}),y}return{status:"valid",value:e.data}}};je.create=n=>new je({typeName:g.ZodNaN,...b(n)});var ma=Symbol("zod_brand"),it=class extends S{_parse(e){let{ctx:t}=this._processInputParams(e),a=t.data;return this._def.type._parse({data:a,path:t.path,parent:t})}unwrap(){return this._def.type}},xe=class extends S{_parse(e){let{status:t,ctx:a}=this._processInputParams(e);if(a.common.async)return(async()=>{let o=await this._def.in._parseAsync({data:a.data,path:a.path,parent:a});return o.status==="aborted"?y:o.status==="dirty"?(t.dirty(),Er(o.value)):this._def.out._parseAsync({data:o.value,path:a.path,parent:a})})();{let s=this._def.in._parseSync({data:a.data,path:a.path,parent:a});return s.status==="aborted"?y:s.status==="dirty"?(t.dirty(),{status:"dirty",value:s.value}):this._def.out._parseSync({data:s.value,path:a.path,parent:a})}}static create(e,t){return new xe({in:e,out:t,typeName:g.ZodPipeline})}},Rr=(n,e={},t)=>n?ae.create().superRefine((a,s)=>{var o,i;if(!n(a)){let c=typeof e=="function"?e(a):typeof e=="string"?{message:e}:e,d=(i=(o=c.fatal)!==null&&o!==void 0?o:t)!==null&&i!==void 0?i:!0,l=typeof c=="string"?{message:c}:c;s.addIssue({code:"custom",...l,fatal:d})}}):ae.create(),ha={object:_.lazycreate},g;(function(n){n.ZodString="ZodString",n.ZodNumber="ZodNumber",n.ZodNaN="ZodNaN",n.ZodBigInt="ZodBigInt",n.ZodBoolean="ZodBoolean",n.ZodDate="ZodDate",n.ZodSymbol="ZodSymbol",n.ZodUndefined="ZodUndefined",n.ZodNull="ZodNull",n.ZodAny="ZodAny",n.ZodUnknown="ZodUnknown",n.ZodNever="ZodNever",n.ZodVoid="ZodVoid",n.ZodArray="ZodArray",n.ZodObject="ZodObject",n.ZodUnion="ZodUnion",n.ZodDiscriminatedUnion="ZodDiscriminatedUnion",n.ZodIntersection="ZodIntersection",n.ZodTuple="ZodTuple",n.ZodRecord="ZodRecord",n.ZodMap="ZodMap",n.ZodSet="ZodSet",n.ZodFunction="ZodFunction",n.ZodLazy="ZodLazy",n.ZodLiteral="ZodLiteral",n.ZodEnum="ZodEnum",n.ZodEffects="ZodEffects",n.ZodNativeEnum="ZodNativeEnum",n.ZodOptional="ZodOptional",n.ZodNullable="ZodNullable",n.ZodDefault="ZodDefault",n.ZodCatch="ZodCatch",n.ZodPromise="ZodPromise",n.ZodBranded="ZodBranded",n.ZodPipeline="ZodPipeline"})(g||(g={}));var fa=(n,e={message:`Input not instance of ${n.name}`})=>Rr(t=>t instanceof n,e),Nr=N.create,Or=$.create,ga=je.create,ya=V.create,Pr=ue.create,va=J.create,ba=Pe.create,Sa=pe.create,xa=me.create,Ca=ae.create,_a=X.create,wa=U.create,Ta=Ae.create,ka=P.create,Ea=_.create,Ia=_.strictCreate,Ra=he.create,Na=Me.create,Oa=fe.create,Pa=q.create,Aa=ge.create,Ma=De.create,Da=Y.create,La=ne.create,ja=ye.create,qa=ve.create,za=W.create,Fa=be.create,Ua=se.create,Tr=A.create,Ba=F.create,$a=K.create,Va=A.createWithPreprocess,Wa=xe.create,Za=()=>Nr().optional(),Ha=()=>Or().optional(),Ga=()=>Pr().optional(),Xa={string:n=>N.create({...n,coerce:!0}),number:n=>$.create({...n,coerce:!0}),boolean:n=>ue.create({...n,coerce:!0}),bigint:n=>V.create({...n,coerce:!0}),date:n=>J.create({...n,coerce:!0})},Ja=y,r=Object.freeze({__proto__:null,defaultErrorMap:$e,setErrorMap:ea,getErrorMap:nt,makeIssue:at,EMPTY_PATH:ta,addIssueToContext:h,ParseStatus:T,INVALID:y,DIRTY:Er,OK:E,isAborted:Mt,isDirty:Dt,isValid:st,isAsync:ot,get util(){return x},get objectUtil(){return At},ZodParsedType:m,getParsedType:re,ZodType:S,ZodString:N,ZodNumber:$,ZodBigInt:V,ZodBoolean:ue,ZodDate:J,ZodSymbol:Pe,ZodUndefined:pe,ZodNull:me,ZodAny:ae,ZodUnknown:X,ZodNever:U,ZodVoid:Ae,ZodArray:P,ZodObject:_,ZodUnion:he,ZodDiscriminatedUnion:Me,ZodIntersection:fe,ZodTuple:q,ZodRecord:ge,ZodMap:De,ZodSet:Y,ZodFunction:ne,ZodLazy:ye,ZodLiteral:ve,ZodEnum:W,ZodNativeEnum:be,ZodPromise:se,ZodEffects:A,ZodTransformer:A,ZodOptional:F,ZodNullable:K,ZodDefault:Se,ZodCatch:Le,ZodNaN:je,BRAND:ma,ZodBranded:it,ZodPipeline:xe,custom:Rr,Schema:S,ZodSchema:S,late:ha,get ZodFirstPartyTypeKind(){return g},coerce:Xa,any:Ca,array:ka,bigint:ya,boolean:Pr,date:va,discriminatedUnion:Na,effect:Tr,enum:za,function:La,instanceof:fa,intersection:Oa,lazy:ja,literal:qa,map:Ma,nan:ga,nativeEnum:Fa,never:wa,null:xa,nullable:$a,number:Or,object:Ea,oboolean:Ga,onumber:Ha,optional:Ba,ostring:Za,pipeline:Wa,preprocess:Va,promise:Ua,record:Aa,set:Da,strictObject:Ia,string:Nr,symbol:ba,transformer:Tr,tuple:Pa,undefined:Sa,union:Ra,unknown:_a,void:Ta,NEVER:Ja,ZodIssueCode:p,quotelessJson:Qn,ZodError:O});var Ya=r.object({name:r.string(),type:r.enum(["object","function","undefined","string","number","boolean","symbol","bigint","accessor"]).or(r.string()),value:r.string().optional(),valuePreview:r.lazy(()=>ct).optional(),subtype:r.enum(["array","node","null","regexp","date","map","set","weakmap","weakset","iterator","generator","error","proxy","promise","typedarray","arraybuffer","dataview","webassemblymemory","wasmvalue"]).or(r.string()).optional()}),Ka=r.object({type:r.enum(["object","function","undefined","string","number","boolean","symbol","bigint"]).or(r.string()),subtype:r.enum(["array","node","null","regexp","date","map","set","weakmap","weakset","iterator","generator","error","proxy","promise","typedarray","arraybuffer","dataview","webassemblymemory","wasmvalue"]).or(r.string()).optional(),description:r.string().optional(),overflow:r.boolean()}),ct=Ka.extend({properties:r.array(Ya),entries:r.array(r.object({key:r.lazy(()=>ct).optional(),value:r.lazy(()=>ct)})).optional()}),qe=r.object({type:r.enum(["object","function","undefined","string","number","boolean","symbol","bigint","wasm"]).or(r.string()),subtype:r.enum(["array","node","null","regexp","date","map","set","weakmap","weakset","iterator","generator","error","proxy","promise","typedarray","arraybuffer","dataview","webassemblymemory","wasmvalue","i32","i64","f32","f64","v128","externref"]).or(r.string()).optional(),className:r.string().optional(),value:r.any().optional(),unserializableValue:r.string().optional(),description:r.string().optional(),objectId:r.string().optional(),preview:ct.optional(),customPreview:r.object({header:r.string().optional(),bodyGetterId:r.string().optional()}).optional()});var Qa=r.object({description:r.string().optional(),callFrames:r.array(r.object({functionName:r.string(),scriptId:r.string(),url:r.string(),lineNumber:r.number(),columnNumber:r.number()})),parentId:r.object({id:r.string(),debuggerId:r.string().optional()}).optional()}),Q=Qa.extend({parent:r.lazy(()=>Q).optional()});var Ar=r.object({type:r.enum(["error","log","debug","info","warning","dir","dirxml","table","trace","clear","startGroup","startGroupCollapsed","endGroup","assert","profile","profileEnd","count","timeEnd"]),args:r.array(qe),executionContextId:r.number(),timestamp:r.number(),stackTrace:Q.optional(),context:r.string().optional()});var Mr=r.object({exceptionDetails:r.object({exceptionId:r.number(),text:r.string(),lineNumber:r.number(),columnNumber:r.number(),scriptId:r.string().optional(),url:r.string().optional(),stackTrace:Q.optional(),exception:qe.optional(),executionContextId:r.number().optional(),exceptionMetaData:r.any().optional()}),timestamp:r.number()});var Dr=r.object({entry:r.object({source:r.enum(["xml","javascript","network","storage","appcache","rendering","security","deprecation","worker","violation","intervention","recommendation","other"]).or(r.string()),level:r.enum(["verbose","info","warning","error"]),text:r.string(),category:r.literal("cors").optional(),timestamp:r.number(),url:r.string().optional(),lineNumber:r.number().optional(),stackTrace:Q.optional(),networkRequestId:r.string().optional(),workerId:r.string().optional(),args:r.array(qe).optional()})});var oe=r.object({absoluteFile:r.string().optional(),column:r.number(),displayFile:r.any().optional(),line:r.number(),originalFile:r.string(),relativeFile:r.string().optional()});var es=r.object({message:r.string(),whitespace:r.string()}),ts=oe.extend({fileUrl:r.string(),function:r.string(),whitespace:r.string()}),rs=r.union([es,ts]),ns=oe.extend({frame:r.string(),language:r.string().optional().nullable()}),dt=r.object({name:r.string(),message:r.string(),isRecovered:r.boolean().default(!1).optional(),stack:r.string(),parsedStack:r.array(rs).optional(),docsUrl:r.union([r.string(),r.array(r.string())]).optional(),codeFrame:ns.optional()});var as=r.enum(["req modified","req + res modified","res modified"]),ss=r.union([r.literal("---"),r.literal("(canceled)"),r.literal("(aborted)"),r.string()]),Lr=r.object({name:r.string(),cardinal:r.number().optional(),ordinal:r.string().optional()}),jr=r.union([r.string(),r.array(r.string()),Lr,r.array(Lr)]).nullable(),jt=r.object({id:r.string(),alias:jr.optional(),aliasType:r.enum(["agent","dom","primitive","route","intercept"]).optional(),displayName:r.string().optional(),name:r.string().optional(),message:r.string().optional(),type:r.enum(["parent","child","system"]).optional(),testCurrentRetry:r.number().optional(),state:r.enum(["active","failed","pending","passed","processing","warned"]),referencesAlias:jr.optional(),testId:r.string(),wallClockUpdatedAt:r.string(),snapshots:r.array(r.object({name:r.string().optional(),timestamp:r.number(),elToHighlightSelectors:r.array(r.string()).optional()})).optional(),coords:r.object({top:r.number(),left:r.number(),topCenter:r.number(),leftCenter:r.number(),x:r.number(),y:r.number()}).optional(),scrollBy:r.object({x:r.number(),y:r.number()}).optional(),highlightAttr:r.string().optional()}),os=r.object({message:r.string().optional(),indicator:r.enum(["successful","pending","aborted","bad"]).optional(),interceptions:r.array(r.object({command:r.enum(["intercept","route"]),alias:r.string().optional(),type:r.enum(["function","stub","spy"])})).optional(),status:r.union([as,ss]).optional(),wentToOrigin:r.boolean().optional()}),is=jt.extend({callCount:r.number(),functionName:r.string(),instrument:r.literal("agent")}),cs=jt.extend({isStubbed:r.boolean(),method:r.string(),numResponses:r.number(),url:r.string(),instrument:r.literal("route")}),ds=r.object({id:r.string(),isGlobalSession:r.boolean(),status:r.enum(["creating","created","restoring","restored","recreating","recreated","failed"])}),ls=jt.extend({err:dt.optional(),event:r.boolean().optional(),numElements:r.number().optional(),number:r.number().optional(),renderProps:os.optional(),sessionInfo:ds.optional(),timeout:r.number().optional(),visible:r.boolean().optional(),wallClockStartedAt:r.string().optional(),hookId:r.string(),group:r.string().optional(),groupLevel:r.number().optional(),instrument:r.literal("command")}),qr=r.discriminatedUnion("instrument",[ls,cs,is]);var zr=r.boolean();var us=r.enum(["active","failed","pending","passed","processing","warned"]),ps=r.enum(["before all","before each","after all","after each","test body","studio commands"]),ms=r.object({hookId:r.string(),hookName:ps,invocationDetails:oe.optional()}),qt=r.object({id:r.string(),title:r.string().optional(),hooks:r.array(ms).optional()}),lt=qt.extend({state:us.optional(),err:dt.optional(),currentRetry:r.number(),retries:r.number().optional(),final:r.boolean().optional(),invocationDetails:oe.optional()}),Ce=lt.extend({wallClockStartedAt:r.string()}),Fr=r.object({id:Ce.shape.id,state:Ce.shape.state,err:Ce.shape.err,hookId:r.string().optional(),failedFromHookId:r.string().optional(),currentRetry:Ce.shape.currentRetry,retries:Ce.shape.retries,wallClockStartedAt:r.string(),wallClockDuration:r.number().optional()});var hs=r.enum(["before each","before all","after all","after each","test body","studio commands"]),fs=r.union([r.any(),r.undefined()]),gs=r.object({hookId:r.string(),hookName:hs,invocationDetails:oe.optional(),isStudio:r.boolean().optional()}),ys=qt.extend({tests:r.array(lt)}),Ur=ys.extend({suites:r.lazy(()=>r.array(Ur))}),Br=r.object({hooks:r.array(gs).optional(),tests:r.array(lt).optional(),suites:r.array(Ur).optional(),testFilter:fs.optional(),totalTests:r.number().optional(),totalUnfilteredTests:r.number().optional()});var $r=r.string();var Vr=r.object({width:r.number(),height:r.number()});var Wr=r.object({id:r.number(),name:r.string(),value:r.string()});var Zr=r.object({id:r.number(),name:r.string()});var Hr=r.object({id:r.number(),characterData:r.string()});var Gr=r.object({elementSelector:r.string(),frameId:r.string(),checked:r.boolean()});var Xr=r.object({scrollX:r.number(),scrollY:r.number(),elementSelector:r.string(),frameId:r.string()});var vs=r.object({id:r.number(),parentId:r.number().optional(),nodeType:r.number(),nodeName:r.string(),localName:r.string(),nodeValue:r.string(),attributes:r.record(r.string(),r.string()).optional(),documentURL:r.string().optional(),baseURL:r.string().optional(),publicId:r.string().optional(),systemId:r.string().optional(),internalSubset:r.string().optional(),name:r.string().optional(),value:r.string().optional(),frameId:r.string().optional(),childNodeCount:r.number().optional(),shadowRootType:r.enum(["closed","open","user-agent"]).or(r.string()).optional(),isSVG:r.boolean().optional(),compatibilityMode:r.enum(["QuirksMode","LimitedQuirksMode","NoQuirksMode"]).or(r.string()).optional(),xmlVersion:r.string().optional()}),_e=vs.extend({children:r.lazy(()=>_e.array()),contentDocument:r.lazy(()=>_e.optional()),shadowRoots:r.lazy(()=>_e.array())});var li=r.object({node:_e});var hi=r.object({parentId:r.number(),node:_e,previousId:r.number().optional()});var Jr=r.object({parentId:r.number(),id:r.number()});var ut=r.object({elementSelector:r.string(),checked:r.boolean(),name:r.string().optional(),frameId:r.string()});var pt=r.object({elementSelector:r.string(),frameId:r.string(),values:r.array(r.string())});var Yr=r.object({elementSelector:r.string(),frameId:r.string(),value:r.string()});var Kr=r.object({scrollX:r.number(),scrollY:r.number(),frameId:r.string()});var bs=r.enum(["High","Low","Medium"]).or(r.string()),Ss=r.enum(["Lax","None","Strict"]).or(r.string()),xs=r.enum(["NonSecure","Secure","Unset"]).or(r.string()),mt=r.enum(["Local","Private","Public","Unknown"]).or(r.string()),ht=r.object({domain:r.string(),expires:r.number(),httpOnly:r.boolean(),name:r.string(),partitionKey:r.string().optional(),partitionKeyOpaque:r.boolean().optional(),path:r.string(),priority:bs,sameParty:r.boolean(),sameSite:Ss.optional(),secure:r.boolean(),session:r.boolean(),size:r.number(),sourceScheme:xs,sourcePort:r.number(),value:r.string()}),ze=r.enum(["Document","Stylesheet","Image","Media","Font","Script","TextTrack","XHR","Fetch","Prefetch","EventSource","WebSocket","Manifest","SignedExchange","Ping","CSPViolationReport","Preflight","Other"]).or(r.string());var Cs=r.enum(["content-type","coep-frame-resource-needs-coep-header","coop-sandboxed-iframe-cannot-navigate-to-coop-page","corp-not-same-origin","corp-not-same-origin-after-defaulted-to-same-origin-by-coep","corp-not-same-site","csp","inspector","mixed-content","other","origin","subresource-filter"]).or(r.string()),_s=r.enum(["Aborted","AccessDenied","AddressUnreachable","BlockedByClient","BlockedByResponse","ConnectionClosed","ConnectionReset","ConnectionRefused","ConnectionAborted","ConnectionFailed","Failed","InternetDisconnected","NameNotResolved","TimedOut"]).or(r.string()),ws=r.object({corsError:_s,failedParameter:r.string()}).optional(),Qr=r.object({requestId:r.string(),timestamp:r.number(),type:ze,errorText:r.string(),canceled:r.boolean().optional(),blockedReason:Cs.optional(),corsErrorStatus:ws.optional()});var en=r.object({encodedDataLength:r.number(),requestId:r.string(),timestamp:r.number(),shouldReportCorbBlocking:r.boolean().optional()});var tn=r.object({requestId:r.string()});var Ts=r.enum(["DomainMismatch","NameValuePairExceedsMaxSize","NotOnPath","SamePartyFromCrossPartyContext","SameSiteStrict","SameSiteLax","SameSiteNoneInsecure","SameSiteUnspecifiedTreatedAsLax","SchemefulSameSiteStrict","SchemefulSameSiteLax","SchemefulSameSiteUnspecifiedTreatedAsLax","SecureOnly","ThirdPartyBlockedInFirstPartySet","UnknownError","UserPreferences"]).or(r.string()),ks=r.enum(["Allow","BlockFromInsecureToMorePrivate","PreflightBlock","PreflightWarn","WarnFromInsecureToMorePrivate"]).or(r.string()),rn=r.object({associatedCookies:r.array(r.object({blockedReasons:r.array(Ts),cookie:ht})),clientSecurityState:r.object({initiatorIsSecureContext:r.boolean(),initiatorIPAddressSpace:mt,privateNetworkRequestPolicy:ks}).optional(),connectTiming:r.object({requestTime:r.number()}),headers:r.record(r.string(),r.string()),requestId:r.string(),siteHasCookieInOtherPartition:r.boolean().optional()});var nn=r.object({documentURL:r.string(),frameId:r.string().optional(),initiator:r.object({type:r.string(),stack:Q.optional(),url:r.string().optional(),lineNumber:r.number().optional(),columnNumber:r.number().optional(),requestId:r.string().optional()}),loaderId:r.string(),request:r.object({url:r.string(),urlFragment:r.string().optional(),method:r.string(),headers:r.record(r.string(),r.string()),postData:r.string().optional(),hasPostData:r.boolean().optional(),postDataEntries:r.array(r.object({bytes:r.string().optional()})).optional(),mixedContentType:r.string().optional(),initialPriority:r.string(),referrerPolicy:r.string(),isLinkPreload:r.boolean().optional(),trustTokenParams:r.object({operation:r.string(),refreshPolicy:r.string(),issuers:r.array(r.string()).optional()}).optional(),isSameSite:r.boolean().optional()}),requestId:r.string(),timestamp:r.number(),wallTime:r.number().optional(),hasUserGesture:r.boolean().optional(),type:ze.optional(),redirectHasExtraInfo:r.boolean()});var Es=r.enum(["InvalidDomain","InvalidPrefix","NameValuePairExceedsMaxSize","OverwriteSecure","SamePartyFromCrossPartyContext","SamePartyConflictsWithOtherAttributes","SameSiteLax","SameSiteNoneInsecure","SameSiteStrict","SameSiteUnspecifiedTreatedAsLax","SchemefulSameSiteStrict","SchemefulSameSiteLax","SchemefulSameSiteUnspecifiedTreatedAsLax","SchemeNotSupported","SecureOnly","SyntaxError","ThirdPartyBlockedInFirstPartySet","UnknownError","UserPreferences"]).or(r.string()),an=r.object({requestId:r.string(),blockedCookies:r.array(r.object({blockedReasons:r.array(Es),cookieLine:r.string(),cookie:ht.optional()})),headers:r.record(r.string(),r.string()),resourceIPAddressSpace:mt,statusCode:r.number(),headersText:r.string().optional(),cookiePartitionKey:r.string().optional(),cookiePartitionKeyOpaque:r.boolean().optional()});var sn=r.object({loaderId:r.string(),requestId:r.string(),response:r.object({url:r.string(),status:r.number(),statusText:r.string(),headers:r.record(r.string(),r.string()),headersText:r.string().optional(),mimeType:r.string().optional(),requestHeaders:r.record(r.string(),r.string()).optional(),requestHeadersText:r.string().optional(),connectionReused:r.boolean(),connectionId:r.number(),remoteIPAddress:r.string().optional(),remotePort:r.number().optional(),fromDiskCache:r.boolean().optional(),fromServiceWorker:r.boolean().optional(),fromPrefetchCache:r.boolean().optional(),encodedDataLength:r.number(),timing:r.object({requestTime:r.number(),proxyStart:r.number(),proxyEnd:r.number(),dnsStart:r.number(),dnsEnd:r.number(),connectStart:r.number(),connectEnd:r.number(),sslStart:r.number(),sslEnd:r.number(),workerStart:r.number(),workerReady:r.number(),workerFetchStart:r.number(),workerRespondWithSettled:r.number(),sendStart:r.number(),sendEnd:r.number(),pushStart:r.number(),pushEnd:r.number(),receiveHeadersEnd:r.number()}).optional(),serviceWorkerResponseSource:r.enum(["cache-storage","http-cache","fallback-code","network"]).or(r.string()).optional(),responseTime:r.number().optional(),cacheStorageCacheName:r.string().optional(),protocol:r.string().optional(),alternateProtocolUsage:r.enum(["alternativeJobWonWithoutRace","alternativeJobWonRace","mainJobWonRace","mappingMissing","broken","dnsAlpnH3JobWonWithoutRace","dnsAlpnH3JobWonRace","unspecifiedReason"]).or(r.string()).optional(),securityState:r.enum(["unknown","neutral","insecure","secure","info","insecure-broken"]).or(r.string()),securityDetails:r.object({protocol:r.string(),keyExchange:r.string(),keyExchangeGroup:r.string().optional(),cipher:r.string(),mac:r.string().optional(),certificateId:r.number(),subjectName:r.string(),sanList:r.array(r.string()),issuer:r.string(),validFrom:r.number(),validTo:r.number(),signedCertificateTimestampList:r.array(r.object({status:r.string(),origin:r.string(),logDescription:r.string(),logId:r.string(),timestamp:r.number(),hashAlgorithm:r.string(),signatureAlgorithm:r.string(),signatureData:r.string()})),certificateTransparencyCompliance:r.enum(["unknown","not-compliant","compliant"]).or(r.string()),serverSignatureAlgorithm:r.number().optional(),encryptedClientHello:r.boolean()}).optional()}),timestamp:r.number(),type:ze,frameId:r.string().optional(),hasExtraInfo:r.boolean()});var ee=require("perf_hooks"),Ac=z(zt());var Z=(0,cn.default)("cypress:protocol:capture:dom"),ft=class extends B{constructor(){super(...arguments);this.afterTestReceived=!1;this.waitForAfterTest=async()=>{};this.frameAttached=t=>{this.state.domState.addChildFrame(t.frameId)};this.frameDetached=t=>{this.state.domState.removeChildFrame(t.frameId)};this.handleCypressProtocolInfo=({cypressProtocolInfo:t,serverTimestamp:a})=>{let s=JSON.parse(t),o=this.state.currentTimeRangeSyncData;this.state.addTimeRangeSyncData({clientSideStartTime:(o==null?void 0:o.clientSideEndTime)||0,clientSideEndTime:s.timestamp,serverSideStartTime:(o==null?void 0:o.serverSideEndTime)||0,serverSideEndTime:a,offset:a-s.timestamp}),this.db.flushPendingTimestampSyncEvents(),s.type==="test:after:run:async"&&(this.afterTestReceived=!0,this.deferredWaitForAfterTest&&(this.deferredWaitForAfterTest.resolve(),this.deferredWaitForAfterTest=void 0,this.afterTestReceived=!1))};this.documentUpdated=async()=>{Z("document updated"),await this.cdpClient.send("DOM.getDocument",{depth:-1,pierce:!0})};this.childNodeInserted=async t=>{var o;Z("child node inserted %O",t);let a=t.node.childNodeCount||0,s=((o=t.node.children)==null?void 0:o.length)||0;a!==s&&await this.cdpClient.send("DOM.requestChildNodes",{nodeId:t.node.nodeId,depth:-1,pierce:!0})};this.childNodeCountUpdated=async t=>{Z("child node count updated %O",t),await this.cdpClient.send("DOM.requestChildNodes",{nodeId:t.nodeId,depth:-1,pierce:!0})};this.setChildNodes=async t=>{Z("set child nodes %O",t)};this.childNodeRemoved=t=>{var d,l;let a=ee.performance.now()+ee.performance.timeOrigin,s=(d=this.state.activeRunnable)==null?void 0:d.id,o=(l=this.state.activeRunnable)==null?void 0:l.attempt,i=this.state.domState.getBackendNodeId(t.nodeId),c=this.state.domState.getBackendNodeId(t.parentNodeId);i&&c&&this.state.domState.isBackendNodeIdTracked(i)&&(Z("DOM.childNodeRemoved %O",t),this.insertEvent("dom:node-removed",{id:i,parentId:c},Jr,a,s,o))};this.attributeModified=t=>{var u,v;let a=ee.performance.now()+ee.performance.timeOrigin;if(t.name==="data-cypress-protocol-info"){this.handleCypressProtocolInfo({cypressProtocolInfo:t.value,serverTimestamp:a});return}if(this.cdpClient.domIsLoading)return;let s=(u=this.state.activeRunnable)==null?void 0:u.id,o=(v=this.state.activeRunnable)==null?void 0:v.attempt,{nodeId:i,name:c,value:d}=t,l=this.state.domState.getBackendNodeId(i);Z("DOM.attributeModified %O",{nodeId:i,backendNodeId:l,name:c}),l&&this.state.domState.isBackendNodeIdTracked(l)&&this.insertEvent("dom:attribute-modified",{id:l,name:c,value:d},Wr,a,s,o)};this.attributeRemoved=t=>{var l,u;let a=ee.performance.now()+ee.performance.timeOrigin,s=(l=this.state.activeRunnable)==null?void 0:l.id,o=(u=this.state.activeRunnable)==null?void 0:u.attempt,{nodeId:i,name:c}=t,d=this.state.domState.getBackendNodeId(i);Z("DOM.attributeRemoved %O",{nodeId:i,backendNodeId:d,name:c}),d&&this.state.domState.isBackendNodeIdTracked(d)&&this.insertEvent("dom:attribute-removed",{id:d,name:c},Zr,a,s,o)};this.characterDataModified=async t=>{var l,u;let a=ee.performance.now()+ee.performance.timeOrigin,s=(l=this.state.activeRunnable)==null?void 0:l.id,o=(u=this.state.activeRunnable)==null?void 0:u.attempt,{nodeId:i,characterData:c}=t;Z("DOM.characterDataModified %O",{nodeId:i,characterData:c.length>16?`"${c.substring(0,16)}..."`:`${c}`});let d=this.state.domState.getBackendNodeId(t.nodeId);d&&this.state.domState.isBackendNodeIdTracked(d)&&this.insertEvent("dom:character-data-modified",{id:d,characterData:c},Hr,a,s,o)};this.executionContextCreated=t=>{var a,s;Z("Runtime.executionContextCreated %O",t),(a=t.context.auxData)!=null&&a.frameId&&((s=this.state.activeRunnable)!=null&&s.id)&&this.state.domState.addExecutionContext(t.context.id,{frameId:t.context.auxData.frameId,runnableId:this.state.activeRunnable.id,attempt:this.state.activeRunnable.attempt}),Z("execution contexts: %O",this.state.domState.getMetadataForExecutionContext(t.context.id))};this.radioInputChanged=({executionContextId:t,payload:a})=>{let s=this.state.domState.getMetadataForExecutionContext(t);if(s){let{elementSelector:o,timestamp:i,checked:c,name:d}=a,{frameId:l,runnableId:u,attempt:v}=s;this.insertEvent("dom:radio-input-changed",{elementSelector:o,frameId:l,checked:c,name:d},ut,i,u,v)}};this.checkboxInputChanged=({executionContextId:t,payload:a})=>{let s=this.state.domState.getMetadataForExecutionContext(t);if(s){let{elementSelector:o,timestamp:i,checked:c}=a,{frameId:d,runnableId:l,attempt:u}=s;this.insertEvent("dom:checkbox-input-changed",{elementSelector:o,frameId:d,checked:c},Gr,i,l,u)}};this.textInputChanged=({executionContextId:t,payload:a})=>{let s=this.state.domState.getMetadataForExecutionContext(t);if(s){let{elementSelector:o,timestamp:i,value:c}=a,{frameId:d,runnableId:l,attempt:u}=s;this.insertEvent("dom:text-input-changed",{elementSelector:o,frameId:d,value:c},Yr,i,l,u)}};this.selectInputChanged=({executionContextId:t,payload:a})=>{let s=this.state.domState.getMetadataForExecutionContext(t);if(s){let{elementSelector:o,timestamp:i,values:c}=a,{frameId:d,runnableId:l,attempt:u}=s;this.insertEvent("dom:select-input-changed",{elementSelector:o,frameId:d,values:c},pt,i,l,u)}};this.elementScrolled=({executionContextId:t,payload:a})=>{let s=this.state.domState.getMetadataForExecutionContext(t);if(s){let o=a,{timestamp:i}=o,c=Je(o,["timestamp"]),{frameId:d,runnableId:l,attempt:u}=s;this.insertEvent("dom:element-scrolled",Xe(Ge({},c),{frameId:d}),Xr,i,l,u)}};this.windowScrolled=({executionContextId:t,payload:a})=>{let s=this.state.domState.getMetadataForExecutionContext(t);if(s){let o=a,{timestamp:i}=o,c=Je(o,["timestamp"]),{frameId:d,runnableId:l,attempt:u}=s;this.insertEvent("dom:window-scrolled",Xe(Ge({},c),{frameId:d}),Kr,i,l,u)}}}async startCapturing(){await Promise.all([this.cdpClient.send("Page.enable"),this.cdpClient.send("DOM.enable")]),await this.cdpClient.send("Runtime.addBinding",{name:"cypressAutProtocolEvent"}),await this.cdpClient.send("Page.addScriptToEvaluateOnNewDocument",{source:`${_r()}`,worldName:"Cypress Protocol"}),this.cdpClient.on("Page.frameAttached",this.frameAttached),this.cdpClient.on("Page.frameDetached",this.frameDetached),this.cdpClient.on("Runtime.executionContextCreated",this.executionContextCreated),this.cdpClient.on("DOM.documentUpdated",this.documentUpdated),this.cdpClient.on("DOM.childNodeInserted",this.childNodeInserted),this.cdpClient.on("DOM.childNodeCountUpdated",this.childNodeCountUpdated),this.cdpClient.on("DOM.setChildNodes",this.setChildNodes)}};var gt=class extends B{async startCapturing(){this.startCapturingLogEntriesAdded()}startCapturingLogEntriesAdded(){this.cdpClient.on("Log.entryAdded",e=>{this.insertEvent("log:added",e,Dr,e.entry.timestamp)})}};var yt=class extends B{async startCapturing(){await this.cdpClient.send("Runtime.enable"),this.startCapturingConsoleOutput(),this.startCapturingExceptionsThrown()}startCapturingConsoleOutput(){this.cdpClient.on("Runtime.consoleAPICalled",e=>{this.insertEvent("runtime:console-api-called",e,Ar,e.timestamp)})}startCapturingExceptionsThrown(){this.cdpClient.on("Runtime.exceptionThrown",e=>{this.insertEvent("runtime:exception-thrown",e,Mr,e.timestamp)})}};var we=require("perf_hooks");var Ft=z(G()),dn=(0,Ft.default)("cypress:protocol:capture:NetworkManager"),ie=(0,Ft.default)("cypress-verbose:protocol:capture:NetworkManager"),Rs=1e3,Ns=64*1024,vt=class extends B{constructor(){super(...arguments);this.convertToMs=t=>t*Rs;this.isChildFrame=t=>t&&this.state.domState.isChildFrame(t);this.requestServedFromCache=t=>{if(!this.state.networkState.getRequest(t.requestId)){ie("Network.requestServedFromCache not added since the request is not being tracked: %O",t);return}this.insertEvent("network:request-served-from-cache",t,tn,we.performance.now()+we.performance.timeOrigin)};this.requestWillBeSent=t=>{if(!this.isChildFrame(t.frameId)){ie("Network.requestWillBeSent not added since it is not originating from a child frame: %O",t);return}let a=this.convertToMs(t.wallTime);this.insertEvent("network:request-will-be-sent",t,nn,a),this.state.networkState.addRequest({requestId:t.requestId,requestURL:t.request.url,type:t.type,requestWillBeSentTimestamp:t.timestamp,requestWillBeSentWallTime:a})};this.requestWillBeSentExtraInfo=t=>{if(!this.state.networkState.getRequest(t.requestId)){ie("Network.requestWillBeSentExtraInfo not added since the request is not being tracked: %O",t);return}this.insertEvent("network:request-will-be-sent-extra-info",t,rn,we.performance.now()+we.performance.timeOrigin)};this.responseReceived=t=>{if(!this.isChildFrame(t.frameId)){ie("Network.responseReceived not added since it is not originating from a child frame: %O",t);return}let a=this.state.networkState.getRequest(t.requestId);if(!a){ie("Network.responseReceived not added since the request is not being tracked: %O",t);return}let s=this.convertToMs(t.timestamp-a.requestWillBeSentTimestamp);this.insertEvent("network:response-received",t,sn,a.requestWillBeSentWallTime+s),this.state.networkState.addResponse({requestId:t.requestId,mimeType:t.response.mimeType,type:t.type})};this.responseReceivedExtraInfo=t=>{if(!this.state.networkState.getRequest(t.requestId)){ie("Network.responseReceived not added since the request is not being tracked: %O",t);return}this.insertEvent("network:response-received-extra-info",t,an,we.performance.now()+we.performance.timeOrigin)};this.loadingFinished=async t=>{var c,d;let a=this.state.networkState.getRequest(t.requestId),s=this.state.networkState.getResponse(t.requestId);if(!a||!s){ie("Network.loadingFinished not added since the request and response are not being tracked: %O",t);return}this.state.networkState.removeRequest(t.requestId),this.state.networkState.removeResponse(t.requestId);let o=this.convertToMs(t.timestamp-a.requestWillBeSentTimestamp);if(this.insertEvent("network:loading-finished",t,en,a.requestWillBeSentWallTime+o),dn("Network.loadingFinished %O",{request:a,response:s}),["Script"].includes(s.type))return;let i=await this.cdpClient.send("Network.getResponseBody",{requestId:t.requestId}).catch(()=>{});i&&this.db.addNetworkResponse({requestId:t.requestId,requestURL:a.requestURL,type:s.type,mimeType:s.mimeType,requestWillBeSentTimestamp:a.requestWillBeSentTimestamp,loadingFinishedTimestamp:t.timestamp,body:i.body,isBase64Encoded:i.base64Encoded,runnableId:(c=this.state.activeRunnable)==null?void 0:c.id,attempt:(d=this.state.activeRunnable)==null?void 0:d.attempt})};this.loadingFailed=t=>{let a=this.state.networkState.getRequest(t.requestId);if(!a){ie("Network.loadingFailed not added since the request is not being tracked: %O",t);return}dn("Network.loadingFailed %O",{request:a}),this.state.networkState.removeRequest(t.requestId);let s=this.convertToMs(t.timestamp-a.requestWillBeSentTimestamp);this.insertEvent("network:loading-failed",t,Qr,a.requestWillBeSentWallTime+s)}}async startCapturing(){await this.cdpClient.send("Network.enable",{maxPostDataSize:Ns}),this.cdpClient.on("Network.requestServedFromCache",this.requestServedFromCache),this.cdpClient.on("Network.requestWillBeSent",this.requestWillBeSent),this.cdpClient.on("Network.requestWillBeSentExtraInfo",this.requestWillBeSentExtraInfo),this.cdpClient.on("Network.responseReceived",this.responseReceived),this.cdpClient.on("Network.responseReceivedExtraInfo",this.responseReceivedExtraInfo),this.cdpClient.on("Network.loadingFinished",this.loadingFinished),this.cdpClient.on("Network.loadingFailed",this.loadingFailed)}};var Bt=z(G());var M=(0,Bt.default)("cypress:protocol:capture:CypressEventsManager"),Ut=(0,Bt.default)("cypress-verbose:protocol:capture:CypressEventsManager"),bt=class{constructor(e,t){this.db=e;this.state=t}viewportChanged(e){var a,s,o;let t=Vr.safeParse(e.viewport);if(!t.success){M("not adding viewport changed event to database due to failed parsing: %O",t.error);return}M("inserting viewport into database: %O",t.data),(o=this.db)==null||o.addEvent({source:"cypress",type:"viewport:changed",runnableId:(a=this.state.activeRunnable)==null?void 0:a.id,attempt:(s=this.state.activeRunnable)==null?void 0:s.attempt,payload:t.data,timestamp:e.timestamp})}urlChanged(e){var a,s,o;let t=$r.safeParse(e.url);if(!t.success){M("not adding url changed event to database due to failed parsing: %O",t.error);return}M("inserting url into database: %O",t.data),(o=this.db)==null||o.addEvent({source:"cypress",type:"url:changed",runnableId:(a=this.state.activeRunnable)==null?void 0:a.id,attempt:(s=this.state.activeRunnable)==null?void 0:s.attempt,payload:t.data,timestamp:e.timestamp})}pageLoading(e){var a,s,o;let t=zr.safeParse(e.loading);if(!t.success){M("not adding page loading event to database due to failed parsing: %O",t.error);return}M("inserting page loading into database: %O",t.data),(o=this.db)==null||o.addEvent({source:"cypress",type:"page:loading",runnableId:(a=this.state.activeRunnable)==null?void 0:a.id,attempt:(s=this.state.activeRunnable)==null?void 0:s.attempt,payload:t.data,timestamp:e.timestamp})}beforeTest(e){var a;let t=Ce.safeParse(e);if(!t.success){M("not adding before test lifecycle event to database due to failed parsing: %O",t.error);return}M("before test %s",e.id),Ut("before test details %O",e),(a=this.db)==null||a.addEvent({source:"cypress",type:"test:before:run:async",payload:t.data,runnableId:e.id,attempt:e.currentRetry+1,timestamp:new Date(e.wallClockStartedAt).getTime()}),this.state.activeRunnable={id:e.id,attempt:e.currentRetry+1}}afterTest(e){var a;let t=Fr.safeParse(e);if(!t.success){M("not adding after test lifecycle event to database due to failed parsing: %O",t.error);return}M("after test %s",t.data.id),Ut("after test details %O",t.data),(a=this.db)==null||a.addEvent({source:"cypress",type:"test:after:run",payload:t.data,runnableId:e.id,attempt:e.currentRetry+1,timestamp:new Date(e.wallClockStartedAt).getTime()+e.wallClockDuration})}addRunnables(e){var a;let t=Br.safeParse(e);if(!t.success){M("not adding runnables to database due to failed parsing: %O",t.error);return}(a=this.db)==null||a.addEvent({source:"cypress",type:"runnables:ready",payload:t.data,timestamp:Date.now()})}commandLogAdded(e){this.insertCommandLogEvent({log:e,type:"log:added"})}commandLogChanged(e){this.insertCommandLogEvent({log:e,type:"log:changed"})}async insertCommandLogEvent({log:e,type:t}){var s;let a=qr.safeParse(e);if(!a.success){M("not adding command log %s event to database due to failed parsing: %O",t,a.error);return}M("inserting command log into database, id: %s, type: %s",a.data.id,t),Ut("command log details: %O",a.data),(s=this.db)==null||s.addEvent({source:"cypress",type:t,runnableId:a.data.testId,attempt:a.data.testCurrentRetry!=null?a.data.testCurrentRetry+1:void 0,payload:a.data,timestamp:new Date(a.data.wallClockUpdatedAt).getTime()})}};var fn=z(G());var Yt=z(G()),un=require("events");var $t=r.object({type:r.literal("text-input-changed"),payload:r.object({elementSelector:r.string(),value:r.string(),timestamp:r.number()})});var Vt=r.object({type:r.literal("element-scrolled"),payload:r.object({timestamp:r.number(),scrollX:r.number(),scrollY:r.number(),elementSelector:r.string()})});var Wt=r.object({type:r.literal("window-scrolled"),payload:r.object({timestamp:r.number(),scrollX:r.number(),scrollY:r.number()})});var Zt=r.object({type:r.literal("select-input-changed"),payload:pt.omit({frameId:!0}).extend({timestamp:r.number()})});var Ht=r.object({type:r.literal("radio-input-changed"),payload:ut.omit({frameId:!0}).extend({timestamp:r.number()})});var Gt=r.object({type:r.literal("checkbox-input-changed"),payload:r.object({elementSelector:r.string(),checked:r.boolean(),timestamp:r.number()})});var Xt={"radio-input-changed":Ht,"checkbox-input-changed":Gt,"text-input-changed":$t,"element-scrolled":Vt,"select-input-changed":Zt,"window-scrolled":Wt},kd=r.discriminatedUnion("type",[Ht,Gt,$t,Vt,Zt,Wt]);var Jt=(0,Yt.default)("cypress:protocol:capture:AUTEventBroker"),ln=(0,Yt.default)("cypress-verbose:protocol:capture:AUTEventBroker"),St=class{constructor(e){this.cdpClient=e;this.handleBindingCalled=e=>{Jt("Runtime.bindingCalled %O",{name:e.name,executionContextId:e.executionContextId}),ln("Event: %O",e);let t=JSON.parse(e.payload);if(!Xt[t.type]){Jt("Runtime.bindingCalled: Invalid event type %s",t.type);return}let a=Xt[t.type].safeParse(t);if(!a.success){Jt("Runtime.bindingCalled: (%s) Invalid event payload",t.type),ln(JSON.stringify(a.error.format(),void 0,2));return}let{type:s,payload:o}=a.data;this.emitter.emit(s,{executionContextId:e.executionContextId,payload:o})};this.emitter=new un.EventEmitter,this.cdpClient.on("Runtime.bindingCalled",this.handleBindingCalled)}on(e,t){return this.emitter.on(e,t)}};var xt=class{constructor(){this.backendNodeIdsToTrack=new Set;this.frontendNodeIdToBackendNodeId=new Map;this.childFrames=new Set;this.executionContextToMetadata=new Map;this.childNodeRequests=new Map;this.pendingAUTEvents=!1}trackAndMapNodeAndChildren(e){Be(e,t=>{this.backendNodeIdsToTrack.add(t.backendNodeId),this.frontendNodeIdToBackendNodeId.set(t.nodeId,t.backendNodeId)})}addChildFrame(e){this.childFrames.add(e)}removeChildFrame(e){this.childFrames.delete(e)}isChildFrame(e){return this.childFrames.has(e)}addExecutionContext(e,t){this.executionContextToMetadata.set(e,t)}getMetadataForExecutionContext(e){return this.executionContextToMetadata.get(e)}isBackendNodeIdTracked(e){return this.backendNodeIdsToTrack.has(e)}getBackendNodeId(e){return this.frontendNodeIdToBackendNodeId.get(e)}resetAutState(){this.backendNodeIdsToTrack.clear(),this.frontendNodeIdToBackendNodeId.clear(),this.autFrameId=void 0}addChildNodeRequest(e){this.childNodeRequests.set(e.backendNodeId,e)}getChildNodeRequest(e){return this.childNodeRequests.get(e)}};var Ct=class{constructor(){this.requestMap=new Map;this.responseMap=new Map}addRequest(e){this.requestMap.set(e.requestId,e)}getRequest(e){return this.requestMap.get(e)}removeRequest(e){this.requestMap.delete(e)}addResponse(e){this.responseMap.set(e.requestId,e)}getResponse(e){return this.responseMap.get(e)}removeResponse(e){this.responseMap.delete(e)}};var Fe=class{constructor(){this.syncTimings=[];this.domState=new xt;this.networkState=new Ct}get currentTimeRangeSyncData(){return this.syncTimings[this.syncTimings.length-1]}addTimeRangeSyncData(e){this.syncTimings.push(e)}getTimingForTimestamp(e){return this.syncTimings.find(a=>a.serverSideStartTime<=e&&a.serverSideEndTime>=e)}};var mn=z(zt()),hn=z(G()),pn=(0,hn.default)("cypress-verbose:protocol:capture:tracked-cdp"),_t=class{constructor(e){this.cdpClient=e;this.outstandingCallbacks=0;this.domIsLoading=!1}removeOutstandingCallback(){this.outstandingCallbacks-=1,this.outstandingCallbacks===0&&this.deferredCallbackDrain&&(this.deferredCallbackDrain.resolve(),this.deferredCallbackDrain=void 0)}on(e,t,a){this.cdpClient.on(e,async s=>{if(a!=null&&a.skipWhenDOMIsLoading&&this.domIsLoading){pn("skipping event while dom is loading",e);return}if(!(a!=null&&a.handleWhileDraining)&&this.isDrainInProgress()){pn("skipping event while draining",e);return}this.outstandingCallbacks+=1;try{await t(s)}catch(o){throw o}finally{this.removeOutstandingCallback()}})}async send(e,t){return this.cdpClient.send(e,t)}async drainEventCallbacks(){this.outstandingCallbacks!==0&&(this.deferredCallbackDrain=(0,mn.default)(),await this.deferredCallbackDrain.promise)}isDrainInProgress(){return!!this.deferredCallbackDrain}};var Kt=(0,fn.default)("cypress:protocol:capture"),wt=class{constructor(){this.state=new Fe}beforeSpec(e){Kt("initializing new spec"),this.state=new Fe,this.db=new Ne({db:e,state:this.state}),this.cypressEventsManager=new bt(this.db,this.state)}async connectToBrowser(e){if(Kt("connecting to browser for new spec"),this.cdpClient=new _t(e),!this.db)throw new Error("Database not initialized. beforeSpec() must be called first");this.autBroker=new St(this.cdpClient),this.cdpLogManager=new gt(this.cdpClient,this.db,this.state,this.autBroker),this.runtimeManager=new yt(this.cdpClient,this.db,this.state,this.autBroker),this.domManager=new ft(this.cdpClient,this.db,this.state,this.autBroker),this.networkManager=new vt(this.cdpClient,this.db,this.state,this.autBroker),await Promise.all([this.cdpLogManager.startCapturing(),this.domManager.startCapturing(),this.runtimeManager.startCapturing(),this.networkManager.startCapturing()])}addRunnables(e){var t;(t=this.cypressEventsManager)==null||t.addRunnables(e)}commandLogAdded(e){var t;(t=this.cypressEventsManager)==null||t.commandLogAdded(e)}commandLogChanged(e){var t;(t=this.cypressEventsManager)==null||t.commandLogChanged(e)}beforeTest(e){var t;(t=this.cypressEventsManager)==null||t.beforeTest(e)}async afterTest(e){var t,a,s,o;(t=this.cypressEventsManager)==null||t.afterTest(e),await((a=this.domManager)==null?void 0:a.waitForAfterTest()),await((s=this.cdpClient)==null?void 0:s.drainEventCallbacks()),(o=this.db)==null||o.flushPendingTimestampSyncEvents()}viewportChanged(e){var t;(t=this.cypressEventsManager)==null||t.viewportChanged(e)}urlChanged(e){var t;(t=this.cypressEventsManager)==null||t.urlChanged(e)}pageLoading(e){var t;(t=this.cypressEventsManager)==null||t.pageLoading(e)}resetTest(e){var t;(t=this.db)==null||t.resetTest(e),this.state=new Fe}afterSpec(){return Kt("after spec"),new Promise((e,t)=>{setTimeout(()=>{var a;try{(a=this.db)==null||a.close(),this.state.activeRunnable=void 0,e()}catch(s){t(s)}},10)})}};wt.SCHEMA_VERSION=Ne.SCHEMA_VERSION;0&&(module.exports={AppCaptureProtocol});
