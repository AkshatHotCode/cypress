"use strict";var Lr=Object.create;var He=Object.defineProperty,jr=Object.defineProperties,qr=Object.getOwnPropertyDescriptor,Fr=Object.getOwnPropertyDescriptors,zr=Object.getOwnPropertyNames,et=Object.getOwnPropertySymbols,Br=Object.getPrototypeOf,Mt=Object.prototype.hasOwnProperty,gn=Object.prototype.propertyIsEnumerable;var fn=(a,e,t)=>e in a?He(a,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[e]=t,ae=(a,e)=>{for(var t in e||={})Mt.call(e,t)&&fn(a,t,e[t]);if(et)for(var t of et(e))gn.call(e,t)&&fn(a,t,e[t]);return a},se=(a,e)=>jr(a,Fr(e));var Xe=(a,e)=>{var t={};for(var r in a)Mt.call(a,r)&&e.indexOf(r)<0&&(t[r]=a[r]);if(a!=null&&et)for(var r of et(a))e.indexOf(r)<0&&gn.call(a,r)&&(t[r]=a[r]);return t};var K=(a,e)=>()=>(e||a((e={exports:{}}).exports,e),e.exports),Ur=(a,e)=>{for(var t in e)He(a,t,{get:e[t],enumerable:!0})},yn=(a,e,t,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of zr(e))!Mt.call(a,s)&&s!==t&&He(a,s,{get:()=>e[s],enumerable:!(r=qr(e,s))||r.enumerable});return a};var z=(a,e,t)=>(t=a!=null?Lr(Br(a)):{},yn(e||!a||!a.__esModule?He(t,"default",{value:a,enumerable:!0}):t,a)),$r=a=>yn(He({},"__esModule",{value:!0}),a);var bn=K((Ys,vn)=>{var Me=1e3,De=Me*60,Ae=De*60,he=Ae*24,Wr=he*7,Vr=he*365.25;vn.exports=function(a,e){e=e||{};var t=typeof a;if(t==="string"&&a.length>0)return Zr(a);if(t==="number"&&isFinite(a))return e.long?Xr(a):Hr(a);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(a))};function Zr(a){if(a=String(a),!(a.length>100)){var e=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(a);if(e){var t=parseFloat(e[1]),r=(e[2]||"ms").toLowerCase();switch(r){case"years":case"year":case"yrs":case"yr":case"y":return t*Vr;case"weeks":case"week":case"w":return t*Wr;case"days":case"day":case"d":return t*he;case"hours":case"hour":case"hrs":case"hr":case"h":return t*Ae;case"minutes":case"minute":case"mins":case"min":case"m":return t*De;case"seconds":case"second":case"secs":case"sec":case"s":return t*Me;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return t;default:return}}}}function Hr(a){var e=Math.abs(a);return e>=he?Math.round(a/he)+"d":e>=Ae?Math.round(a/Ae)+"h":e>=De?Math.round(a/De)+"m":e>=Me?Math.round(a/Me)+"s":a+"ms"}function Xr(a){var e=Math.abs(a);return e>=he?tt(a,e,he,"day"):e>=Ae?tt(a,e,Ae,"hour"):e>=De?tt(a,e,De,"minute"):e>=Me?tt(a,e,Me,"second"):a+" ms"}function tt(a,e,t,r){var s=e>=t*1.5;return Math.round(a/t)+" "+r+(s?"s":"")}});var Dt=K((Ks,Sn)=>{function Gr(a){t.debug=t,t.default=t,t.coerce=c,t.disable=o,t.enable=s,t.enabled=i,t.humanize=bn(),t.destroy=u,Object.keys(a).forEach(l=>{t[l]=a[l]}),t.names=[],t.skips=[],t.formatters={};function e(l){let f=0;for(let x=0;x<l.length;x++)f=(f<<5)-f+l.charCodeAt(x),f|=0;return t.colors[Math.abs(f)%t.colors.length]}t.selectColor=e;function t(l){let f,x=null,k,M;function R(...w){if(!R.enabled)return;let Y=R,Ke=Number(new Date),Mr=Ke-(f||Ke);Y.diff=Mr,Y.prev=f,Y.curr=Ke,f=Ke,w[0]=t.coerce(w[0]),typeof w[0]!="string"&&w.unshift("%O");let Qe=0;w[0]=w[0].replace(/%([a-zA-Z%])/g,(Pt,Dr)=>{if(Pt==="%%")return"%";Qe++;let hn=t.formatters[Dr];if(typeof hn=="function"){let Ar=w[Qe];Pt=hn.call(Y,Ar),w.splice(Qe,1),Qe--}return Pt}),t.formatArgs.call(Y,w),(Y.log||t.log).apply(Y,w)}return R.namespace=l,R.useColors=t.useColors(),R.color=t.selectColor(l),R.extend=r,R.destroy=t.destroy,Object.defineProperty(R,"enabled",{enumerable:!0,configurable:!1,get:()=>x!==null?x:(k!==t.namespaces&&(k=t.namespaces,M=t.enabled(l)),M),set:w=>{x=w}}),typeof t.init=="function"&&t.init(R),R}function r(l,f){let x=t(this.namespace+(typeof f>"u"?":":f)+l);return x.log=this.log,x}function s(l){t.save(l),t.namespaces=l,t.names=[],t.skips=[];let f,x=(typeof l=="string"?l:"").split(/[\s,]+/),k=x.length;for(f=0;f<k;f++)x[f]&&(l=x[f].replace(/\*/g,".*?"),l[0]==="-"?t.skips.push(new RegExp("^"+l.slice(1)+"$")):t.names.push(new RegExp("^"+l+"$")))}function o(){let l=[...t.names.map(d),...t.skips.map(d).map(f=>"-"+f)].join(",");return t.enable(""),l}function i(l){if(l[l.length-1]==="*")return!0;let f,x;for(f=0,x=t.skips.length;f<x;f++)if(t.skips[f].test(l))return!1;for(f=0,x=t.names.length;f<x;f++)if(t.names[f].test(l))return!0;return!1}function d(l){return l.toString().substring(2,l.toString().length-2).replace(/\.\*\?$/,"*")}function c(l){return l instanceof Error?l.stack||l.message:l}function u(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return t.enable(t.load()),t}Sn.exports=Gr});var xn=K((D,nt)=>{D.formatArgs=Yr;D.save=Kr;D.load=Qr;D.useColors=Jr;D.storage=ea();D.destroy=(()=>{let a=!1;return()=>{a||(a=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})();D.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function Jr(){return typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function Yr(a){if(a[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+a[0]+(this.useColors?"%c ":" ")+"+"+nt.exports.humanize(this.diff),!this.useColors)return;let e="color: "+this.color;a.splice(1,0,e,"color: inherit");let t=0,r=0;a[0].replace(/%[a-zA-Z%]/g,s=>{s!=="%%"&&(t++,s==="%c"&&(r=t))}),a.splice(r,0,e)}D.log=console.debug||console.log||(()=>{});function Kr(a){try{a?D.storage.setItem("debug",a):D.storage.removeItem("debug")}catch{}}function Qr(){let a;try{a=D.storage.getItem("debug")}catch{}return!a&&typeof process<"u"&&"env"in process&&(a=process.env.DEBUG),a}function ea(){try{return localStorage}catch{}}nt.exports=Dt()(D);var{formatters:ta}=nt.exports;ta.j=function(a){try{return JSON.stringify(a)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}});var Tn=K((Qs,Cn)=>{"use strict";Cn.exports=(a,e=process.argv)=>{let t=a.startsWith("-")?"":a.length===1?"-":"--",r=e.indexOf(t+a),s=e.indexOf("--");return r!==-1&&(s===-1||r<s)}});var _n=K((eo,wn)=>{"use strict";var na=require("os"),kn=require("tty"),B=Tn(),{env:_}=process,oe;B("no-color")||B("no-colors")||B("color=false")||B("color=never")?oe=0:(B("color")||B("colors")||B("color=true")||B("color=always"))&&(oe=1);"FORCE_COLOR"in _&&(_.FORCE_COLOR==="true"?oe=1:_.FORCE_COLOR==="false"?oe=0:oe=_.FORCE_COLOR.length===0?1:Math.min(parseInt(_.FORCE_COLOR,10),3));function At(a){return a===0?!1:{level:a,hasBasic:!0,has256:a>=2,has16m:a>=3}}function Lt(a,e){if(oe===0)return 0;if(B("color=16m")||B("color=full")||B("color=truecolor"))return 3;if(B("color=256"))return 2;if(a&&!e&&oe===void 0)return 0;let t=oe||0;if(_.TERM==="dumb")return t;if(process.platform==="win32"){let r=na.release().split(".");return Number(r[0])>=10&&Number(r[2])>=10586?Number(r[2])>=14931?3:2:1}if("CI"in _)return["TRAVIS","CIRCLECI","APPVEYOR","GITLAB_CI"].some(r=>r in _)||_.CI_NAME==="codeship"?1:t;if("TEAMCITY_VERSION"in _)return/^(9\.(0*[1-9]\d*)\.|\d{2,}\.)/.test(_.TEAMCITY_VERSION)?1:0;if("GITHUB_ACTIONS"in _)return 1;if(_.COLORTERM==="truecolor")return 3;if("TERM_PROGRAM"in _){let r=parseInt((_.TERM_PROGRAM_VERSION||"").split(".")[0],10);switch(_.TERM_PROGRAM){case"iTerm.app":return r>=3?3:2;case"Apple_Terminal":return 2}}return/-256(color)?$/i.test(_.TERM)?2:/^screen|^xterm|^vt100|^vt220|^rxvt|color|ansi|cygwin|linux/i.test(_.TERM)||"COLORTERM"in _?1:t}function ra(a){let e=Lt(a,a&&a.isTTY);return At(e)}wn.exports={supportsColor:ra,stdout:At(Lt(!0,kn.isatty(1))),stderr:At(Lt(!0,kn.isatty(2)))}});var En=K((E,at)=>{var aa=require("tty"),rt=require("util");E.init=ua;E.log=da;E.formatArgs=oa;E.save=ca;E.load=la;E.useColors=sa;E.destroy=rt.deprecate(()=>{},"Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.");E.colors=[6,2,3,4,5,1];try{let a=_n();a&&(a.stderr||a).level>=2&&(E.colors=[20,21,26,27,32,33,38,39,40,41,42,43,44,45,56,57,62,63,68,69,74,75,76,77,78,79,80,81,92,93,98,99,112,113,128,129,134,135,148,149,160,161,162,163,164,165,166,167,168,169,170,171,172,173,178,179,184,185,196,197,198,199,200,201,202,203,204,205,206,207,208,209,214,215,220,221])}catch{}E.inspectOpts=Object.keys(process.env).filter(a=>/^debug_/i.test(a)).reduce((a,e)=>{let t=e.substring(6).toLowerCase().replace(/_([a-z])/g,(s,o)=>o.toUpperCase()),r=process.env[e];return/^(yes|on|true|enabled)$/i.test(r)?r=!0:/^(no|off|false|disabled)$/i.test(r)?r=!1:r==="null"?r=null:r=Number(r),a[t]=r,a},{});function sa(){return"colors"in E.inspectOpts?!!E.inspectOpts.colors:aa.isatty(process.stderr.fd)}function oa(a){let{namespace:e,useColors:t}=this;if(t){let r=this.color,s="\x1B[3"+(r<8?r:"8;5;"+r),o=`  ${s};1m${e} \x1B[0m`;a[0]=o+a[0].split(`
`).join(`
`+o),a.push(s+"m+"+at.exports.humanize(this.diff)+"\x1B[0m")}else a[0]=ia()+e+" "+a[0]}function ia(){return E.inspectOpts.hideDate?"":new Date().toISOString()+" "}function da(...a){return process.stderr.write(rt.format(...a)+`
`)}function ca(a){a?process.env.DEBUG=a:delete process.env.DEBUG}function la(){return process.env.DEBUG}function ua(a){a.inspectOpts={};let e=Object.keys(E.inspectOpts);for(let t=0;t<e.length;t++)a.inspectOpts[e[t]]=E.inspectOpts[e[t]]}at.exports=Dt()(E);var{formatters:In}=at.exports;In.o=function(a){return this.inspectOpts.colors=this.useColors,rt.inspect(a,this.inspectOpts).split(`
`).map(e=>e.trim()).join(" ")};In.O=function(a){return this.inspectOpts.colors=this.useColors,rt.inspect(a,this.inspectOpts)}});var H=K((to,jt)=>{typeof process>"u"||process.type==="renderer"||process.browser===!0||process.__nwjs?jt.exports=xn():jt.exports=En()});var Ln=K((po,ha)=>{ha.exports='"use strict";var D=Object.defineProperty;var C=Object.getOwnPropertySymbols;var A=Object.prototype.hasOwnProperty,_=Object.prototype.propertyIsEnumerable;var v=(e,t,n)=>t in e?D(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,d=(e,t)=>{for(var n in t||={})A.call(t,n)&&v(e,n,t[n]);if(C)for(var n of C(t))_.call(t,n)&&v(e,n,t[n]);return e};var a,E;function u(e,t){if(e.nodeType!==Node.ELEMENT_NODE)throw new Error("Can\'t generate CSS selector for non-element node type.");if(e.tagName.toLowerCase()==="html")return"html";let n={root:document.body,idName:o=>!0,className:o=>!0,tagName:o=>!0,attr:(o,l)=>!1,seedMinLength:1,optimizedMinLength:2,threshold:1e3,maxNumberOfTries:1e4};a={...n,...t},E=I(a.root,n);let r=f(e,"all",()=>f(e,"two",()=>f(e,"one",()=>f(e,"none"))));if(r){let o=P(T(r,e));return o.length>0&&(r=o[0]),h(r)}else throw new Error("Selector was not found.")}function I(e,t){return e.nodeType===Node.DOCUMENT_NODE?e:e===t.root?e.ownerDocument:e}function f(e,t,n){let r=null,o=[],l=e,m=0;for(;l;){let i=y(x(l))||y(...O(l))||y(...R(l))||y(W(l))||[N()],c=H(l);if(t=="all")c&&(i=i.concat(i.filter(g).map(s=>p(s,c))));else if(t=="two")i=i.slice(0,1),c&&(i=i.concat(i.filter(g).map(s=>p(s,c))));else if(t=="one"){let[s]=i=i.slice(0,1);c&&g(s)&&(i=[p(s,c)])}else t=="none"&&(i=[N()],c&&(i=[p(i[0],c)]));for(let s of i)s.level=m;if(o.push(i),o.length>=a.seedMinLength&&(r=S(o,n),r))break;l=l.parentElement,m++}return r||(r=S(o,n)),!r&&n?n():r}function S(e,t){let n=P(L(e));if(n.length>a.threshold)return t?t():null;for(let r of n)if(b(r))return r;return null}function h(e){let t=e[0],n=t.name;for(let r=1;r<e.length;r++){let o=e[r].level||0;t.level===o-1?n=`${e[r].name} > ${n}`:n=`${e[r].name} ${n}`,t=e[r]}return n}function M(e){return e.map(t=>t.penalty).reduce((t,n)=>t+n,0)}function b(e){let t=h(e);switch(E.querySelectorAll(t).length){case 0:throw new Error(`Can\'t select any node with this selector: ${t}`);case 1:return!0;default:return!1}}function x(e){let t=e.getAttribute("id");return t&&a.idName(t)?{name:"#"+CSS.escape(t),penalty:0}:null}function O(e){return Array.from(e.attributes).filter(n=>a.attr(n.name,n.value)).map(n=>({name:`[${CSS.escape(n.name)}="${CSS.escape(n.value)}"]`,penalty:.5}))}function R(e){return Array.from(e.classList).filter(a.className).map(n=>({name:"."+CSS.escape(n),penalty:1}))}function W(e){let t=e.tagName.toLowerCase();return a.tagName(t)?{name:t,penalty:2}:null}function N(){return{name:"*",penalty:3}}function H(e){let t=e.parentNode;if(!t)return null;let n=t.firstChild;if(!n)return null;let r=0;for(;n&&(n.nodeType===Node.ELEMENT_NODE&&r++,n!==e);)n=n.nextSibling;return r}function p(e,t){return{name:e.name+`:nth-child(${t})`,penalty:e.penalty+1}}function g(e){return e.name!=="html"&&!e.name.startsWith("#")}function y(...e){let t=e.filter($);return t.length>0?t:null}function $(e){return e!=null}function*L(e,t=[]){if(e.length>0)for(let n of e[0])yield*L(e.slice(1,e.length),t.concat(n));else yield t}function P(e){return[...e].sort((t,n)=>M(t)-M(n))}function*T(e,t,n={counter:0,visited:new Map}){if(e.length>2&&e.length>a.optimizedMinLength)for(let r=1;r<e.length-1;r++){if(n.counter>a.maxNumberOfTries)return;n.counter+=1;let o=[...e];o.splice(r,1);let l=h(o);if(n.visited.has(l))return;b(o)&&k(o,t)&&(yield o,n.visited.set(l,!0),yield*T(o,t,n))}}function k(e,t){return E.querySelector(h(e))===t}var q=(e,t)=>({type:"window-scrolled",payload:d({timestamp:e,scrollX:t.scrollX,scrollY:t.scrollY},t.__cypressProtocolMetadata)}),J=(e,t,n)=>({type:"element-scrolled",payload:d({timestamp:e,scrollX:t.target.scrollLeft,scrollY:t.target.scrollTop,elementSelector:u(t.target)},n.__cypressProtocolMetadata)}),w=class{constructor(t,n,r){this.windowRef=t;this.docRef=n;this.perfRef=r;this.handleDocumentScroll=t=>{let n=this.perfRef.now()+this.perfRef.timeOrigin,r=t.target instanceof Document?q(n,this.windowRef):J(n,t,this.windowRef);this.windowRef.cypressAutProtocolEvent(JSON.stringify(r))}}register(){this.docRef.addEventListener("scroll",this.handleDocumentScroll,!0)}};window.top!==window&&(document.addEventListener("input",t=>{var o;let n=performance.now()+performance.timeOrigin,r=t.target;if(r.tagName==="SELECT"){let l={type:"select-input-changed",payload:d({elementSelector:u(r),values:Array.from(r.selectedOptions).map(({value:m})=>m),timestamp:n},window.__cypressProtocolMetadata)};window.cypressAutProtocolEvent&&window.cypressAutProtocolEvent(JSON.stringify(l))}else if(r.getAttribute("type")==="radio"){let l={type:"radio-input-changed",payload:d({elementSelector:u(r),checked:r.checked,name:r.getAttribute("name")||void 0,timestamp:n},window.__cypressProtocolMetadata)};window.cypressAutProtocolEvent&&window.cypressAutProtocolEvent(JSON.stringify(l))}else if(((o=r.attributes.getNamedItem("type"))==null?void 0:o.value)==="checkbox"){let l={type:"checkbox-input-changed",payload:d({elementSelector:u(r),checked:r.checked,timestamp:n},window.__cypressProtocolMetadata)};window.cypressAutProtocolEvent&&window.cypressAutProtocolEvent(JSON.stringify(l))}else{let l={type:"text-input-changed",payload:d({elementSelector:u(r),value:r.value,timestamp:n},window.__cypressProtocolMetadata)};window.cypressAutProtocolEvent&&window.cypressAutProtocolEvent(JSON.stringify(l))}}),new w(window,document,performance).register());\n'});var Ht=K((mi,sr)=>{"use strict";var fs=()=>{let a={};return a.promise=new Promise((e,t)=>{a.resolve=e,a.reject=t}),a};sr.exports=fs});var Xs={};Ur(Xs,{AppCaptureProtocol:()=>Ot});module.exports=$r(Xs);var mn=require("perf_hooks");var Ft=z(H()),An=z(require("crypto"));var fe=String.raw,Nn=fe`
CREATE TABLE IF NOT EXISTS events (
  /* autoincrementing id */
  id INTEGER PRIMARY KEY,
  /* source of the event (e.g. cdp, cypress, etc.) */
  source TEXT NOT NULL,
  /* type of the event (e.g. 'viewport:changed, log:added, runtime:console-api-called', etc.) */
  type TEXT NOT NULL,
  /* payload of the event. JSON stringified */
  payload TEXT,
  /**
   * id of the runnable (test) that the event belongs to.
   * Can be NULL when the event is not associated with a given runnable (e.g. event occurs before any tests start)
   */
  runnable_id TEXT,
  /**
   * attempt number of the runnable (test) that the event belong to. 1-based (i.e. 1 = first attempt, 2 = second attempt, etc.).
   * Can be NULL when the event is not associated with a given runnable (e.g. event occurs before any tests start)
   */
  attempt INTEGER,
  /* timestamp of the event */
  timestamp REAL NOT NULL
) STRICT
  `,Rn=fe`
CREATE TABLE IF NOT EXISTS network_responses (
  /* the request id of the network request - https://chromedevtools.github.io/devtools-protocol/tot/Network/#type-RequestId */
  request_id TEXT NOT NULL,
  /* the request URL of the network request - https://chromedevtools.github.io/devtools-protocol/tot/Network/#type-Request */
  request_url TEXT NOT NULL,
  /* the type of the network request - https://chromedevtools.github.io/devtools-protocol/tot/Network/#type-ResourceType */
  type TEXT NOT NULL,
  /* the mime type of the response - https://chromedevtools.github.io/devtools-protocol/tot/Network/#type-Response */
  mime_type TEXT NOT NULL,
  /**
   * id of the runnable (test) that the event belongs to.
   * Can be NULL when the event is not associated with a given runnable (e.g. event occurs before any tests start)
   */
  runnable_id TEXT,
  /**
   * attempt number of the runnable (test) that the event belong to. 1-based (i.e. 1 = first attempt, 2 = second attempt, etc.).
   * Can be NULL when the event is not associated with a given runnable (e.g. event occurs before any tests start)
   */
  attempt INTEGER,
  /**
   * timestamp of the requestWillBeSent event for the network request
   */
  request_will_be_sent_timestamp REAL NOT NULL,
  /**
   * timestamp of the loadingFinished event for the network request
   */
  loading_finished_timestamp REAL NOT NULL,
  /**
   * hash of the response body
   */
  body_hash TEXT NOT NULL,
  /**
   * whether the response was served from cache
   */
  is_cached INTEGER NOT NULL
) STRICT
  `,On=fe`
CREATE TABLE IF NOT EXISTS hashed_data (
  /* hash of the data */
  hash TEXT PRIMARY KEY NOT NULL,
  /* data that was hashed */
  data TEXT NOT NULL,
  /* whether the data is base64 encoded */
  is_base64_encoded INTEGER NOT NULL
) STRICT
  `,Pn=fe`
INSERT INTO events (source, type, payload, runnable_id, attempt, timestamp)
VALUES ($source, $type, $payload, $runnableId, $attempt, $timestamp)
`,qt=fe`
INSERT INTO network_responses (request_id, request_url, type, mime_type, runnable_id, attempt, request_will_be_sent_timestamp, loading_finished_timestamp, body_hash, is_cached)
VALUES ($requestId, $requestURL, $type, $mimeType, $runnableId, $attempt, $requestWillBeSentTimestamp, $loadingFinishedTimestamp, $bodyHash, $isCached)
`,Mn=fe`
INSERT OR IGNORE INTO hashed_data (hash, data, is_base64_encoded)
VALUES ($hash, $data, $isBase64Encoded)
`,Dn=fe`
DELETE FROM events WHERE runnable_id = ?
`;var st=a=>{a.pragma("journal_mode = WAL"),a.prepare(Nn).run(),a.prepare(Rn).run(),a.prepare(On).run()};st.SCHEMA_VERSION=1;var ge=(0,Ft.default)("cypress:protocol:capture:db"),pa=(0,Ft.default)("cypress-verbose:protocol:capture:db"),ma={"dom:attribute-modified":!0,"dom:attribute-removed":!0,"dom:character-data-modified":!0,"dom:full-snapshot":!0,"dom:node-added":!0,"dom:node-removed":!0,"dom:style-sheet-added":!0,"dom:style-sheet-changed":!0,"dom:style-sheet-removed":!0,"network:request-served-from-cache":!0,"network:request-will-be-sent-extra-info":!0,"network:response-received-extra-info":!0,"dom:checkbox-input-changed":!1,"dom:element-scrolled":!1,"dom:radio-input-changed":!1,"dom:select-input-changed":!1,"dom:text-input-changed":!1,"dom:window-scrolled":!1,"log:added":!1,"network:loading-finished":!1,"network:request-will-be-sent":!1,"network:response-received":!1,"runtime:console-api-called":!1,"runtime:exception-thrown":!1,"network:loading-failed":!1},Le=class{constructor({db:e,state:t}){this.pendingTimestampSyncEvents=[];ge("connecting to database"),this.db=e,this.state=t,st(this.db)}addEvent(e){this.addEvents([e])}addEvents(e,{flushImmediately:t=!1}={}){let r=[];for(let s of e)!t&&s.source==="cdp"&&ma[s.type]?this.pendingTimestampSyncEvents.push(s):r.push(s);this.insertEvents(r)}flushPendingTimestampSyncEvents(){let{toFlush:e,toKeep:t}=this.pendingTimestampSyncEvents.reduce((r,s)=>{let o=this.state.getTimingForTimestamp(s.timestamp);if(o){let i=o.offset,d=s.timestamp-i;s.timestamp=d>o.clientSideStartTime?d:o.clientSideStartTime+1e-4,pa("flushing event type %s with offset %o",s.type,i),r.toFlush.push(s)}else r.toKeep.push(s);return r},{toFlush:[],toKeep:[]});this.pendingTimestampSyncEvents=t,this.insertEvents(e)}addCachedNetworkResponse(e){if(!this.db.open){ge("database is closed, not adding event");return}let t=this.db.prepare(qt);this.db.transaction(()=>{e.requestURLs.forEach(r=>{t.run({requestId:e.requestId,requestURL:r,type:e.type,mimeType:e.mimeType,runnableId:e.runnableId,attempt:e.attempt,requestWillBeSentTimestamp:e.requestWillBeSentTimestamp,loadingFinishedTimestamp:e.loadingFinishedTimestamp,bodyHash:e.bodyHash,isCached:1})})})()}addNetworkResponse(e){if(!this.db.open){ge("database is closed, not adding event");return}let t=An.default.createHash("md5").update(e.body).digest("hex"),r=this.db.prepare(qt);return this.db.transaction(()=>{e.requestURLs.forEach(s=>{r.run({requestId:e.requestId,requestURL:s,type:e.type,mimeType:e.mimeType,runnableId:e.runnableId,attempt:e.attempt,requestWillBeSentTimestamp:e.requestWillBeSentTimestamp,loadingFinishedTimestamp:e.loadingFinishedTimestamp,bodyHash:t,isCached:0})})})(),this.db.prepare(Mn).run({hash:t,data:e.body,isBase64Encoded:e.isBase64Encoded?1:0}),t}close(){ge("closing database"),this.db.prepare("VACUUM").run(),this.db.close()}resetTest(e){if(ge("resetting test: %s",e),!this.db.open){ge("database is closed, not resetting test");return}this.db.prepare(Dn).run(e),this.pendingTimestampSyncEvents=[]}insertEvents(e){if(!this.db.open){ge("database is closed, not adding events");return}let t=this.db.prepare(Pn);this.db.transaction(()=>{e.forEach(r=>{t.run({source:r.source,type:r.type,payload:JSON.stringify(r.payload),runnableId:r.runnableId,attempt:r.attempt,timestamp:r.timestamp})})})()}};Le.SCHEMA_VERSION=st.SCHEMA_VERSION;var zt=z(H()),U=class{constructor(e,t,r,s){this.cdpClient=e;this.db=t;this.state=r;this.autBroker=s;this._debug=(0,zt.default)(`cypress:protocol:capture:${this.constructor.name}`),this._debugVerbose=(0,zt.default)(`cypress-verbose:protocol:capture:${this.constructor.name}`)}insertEvents(e,{flushImmediately:t}={}){var s,o,i,d,c;let r=[];for(let u of e){let{eventType:l,eventPayload:f,eventExpectedSchema:x,timestamp:k,runnableId:M,attempt:R}=u;this._debug(`Insertion attempt for ${l}`),this._debugVerbose(`${l} called with payload: %O`,f);let w=x.safeParse(f);if(!w.success){this._debug(`not adding ${l} event to database due to failed parsing: %O`,w.error);continue}this._debug(`Inserting ${l} into events table with runnableId ${M}, attempt ${R}`),r.push({source:"cdp",type:u.eventType,payload:w.data,runnableId:(o=u.runnableId)!=null?o:(s=this.state.activeRunnable)==null?void 0:s.id,attempt:(d=u.attempt)!=null?d:(i=this.state.activeRunnable)==null?void 0:i.attempt,timestamp:k})}(c=this.db)==null||c.addEvents(r,{flushImmediately:t})}insertEvent({eventType:e,eventPayload:t,eventExpectedSchema:r,timestamp:s,runnableId:o,attempt:i,flushImmediately:d}){this.insertEvents([{eventType:e,eventPayload:t,eventExpectedSchema:r,timestamp:s,runnableId:o,attempt:i}],{flushImmediately:d})}};var jn=a=>a.shadowRootType!=="user-agent";var Ge=(a,e)=>{var t,r;e(a),(t=a.children)==null||t.forEach(s=>{Ge(s,e)}),(r=a.shadowRoots)==null||r.filter(s=>jn(s)).forEach(s=>{Ge(s,e)}),a.contentDocument&&Ge(a.contentDocument,e)},ot=a=>{if(a.nodeType===1&&a.attributes){for(let e=0;e<a.attributes.length;e+=2)if(a.attributes[e]==="class"&&a.attributes[e+1]==="aut-iframe")return a}if(a.children)for(let e=0;e<a.children.length;e++){let t=ot(a.children[e]);if(t)return t}},fa=a=>{let e={};for(let t=0;t<a.length;t+=2)e[a[t]]=a[t+1];return e},ye=async(a,e,t)=>{var k;[3,4,8].includes(e.nodeType)&&e.nodeValue.length>1e4&&(e.nodeValue=(await a.send("DOM.getOuterHTML",{backendNodeId:e.backendNodeId})).outerHTML);let x=e,{nodeId:r,backendNodeId:s,pseudoElements:o,pseudoIdentifier:i,pseudoType:d}=x,c=Xe(x,["nodeId","backendNodeId","pseudoElements","pseudoIdentifier","pseudoType"]),u=e.children?await Promise.all((k=e.children)==null?void 0:k.map(M=>ye(a,M,e.backendNodeId))):[],l=e.shadowRoots?await Promise.all(e.shadowRoots.filter(M=>jn(M)).map(M=>ye(a,M))):[],f=e.contentDocument?await ye(a,e.contentDocument):void 0;return se(ae({},c),{children:u,shadowRoots:l,contentDocument:f,id:e.backendNodeId,parentId:t,attributes:fa(e.attributes||[])})},qn=()=>Ln();var C;(function(a){a.assertEqual=s=>s;function e(s){}a.assertIs=e;function t(s){throw new Error}a.assertNever=t,a.arrayToEnum=s=>{let o={};for(let i of s)o[i]=i;return o},a.getValidEnumValues=s=>{let o=a.objectKeys(s).filter(d=>typeof s[s[d]]!="number"),i={};for(let d of o)i[d]=s[d];return a.objectValues(i)},a.objectValues=s=>a.objectKeys(s).map(function(o){return s[o]}),a.objectKeys=typeof Object.keys=="function"?s=>Object.keys(s):s=>{let o=[];for(let i in s)Object.prototype.hasOwnProperty.call(s,i)&&o.push(i);return o},a.find=(s,o)=>{for(let i of s)if(o(i))return i},a.isInteger=typeof Number.isInteger=="function"?s=>Number.isInteger(s):s=>typeof s=="number"&&isFinite(s)&&Math.floor(s)===s;function r(s,o=" | "){return s.map(i=>typeof i=="string"?`'${i}'`:i).join(o)}a.joinValues=r,a.jsonStringifyReplacer=(s,o)=>typeof o=="bigint"?o.toString():o})(C||(C={}));var Bt;(function(a){a.mergeShapes=(e,t)=>({...e,...t})})(Bt||(Bt={}));var m=C.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),ie=a=>{switch(typeof a){case"undefined":return m.undefined;case"string":return m.string;case"number":return isNaN(a)?m.nan:m.number;case"boolean":return m.boolean;case"function":return m.function;case"bigint":return m.bigint;case"symbol":return m.symbol;case"object":return Array.isArray(a)?m.array:a===null?m.null:a.then&&typeof a.then=="function"&&a.catch&&typeof a.catch=="function"?m.promise:typeof Map<"u"&&a instanceof Map?m.map:typeof Set<"u"&&a instanceof Set?m.set:typeof Date<"u"&&a instanceof Date?m.date:m.object;default:return m.unknown}},p=C.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),ga=a=>JSON.stringify(a,null,2).replace(/"([^"]+)":/g,"$1:"),L=class extends Error{constructor(e){super(),this.issues=[],this.addIssue=r=>{this.issues=[...this.issues,r]},this.addIssues=(r=[])=>{this.issues=[...this.issues,...r]};let t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}get errors(){return this.issues}format(e){let t=e||function(o){return o.message},r={_errors:[]},s=o=>{for(let i of o.issues)if(i.code==="invalid_union")i.unionErrors.map(s);else if(i.code==="invalid_return_type")s(i.returnTypeError);else if(i.code==="invalid_arguments")s(i.argumentsError);else if(i.path.length===0)r._errors.push(t(i));else{let d=r,c=0;for(;c<i.path.length;){let u=i.path[c];c===i.path.length-1?(d[u]=d[u]||{_errors:[]},d[u]._errors.push(t(i))):d[u]=d[u]||{_errors:[]},d=d[u],c++}}};return s(this),r}toString(){return this.message}get message(){return JSON.stringify(this.issues,C.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=t=>t.message){let t={},r=[];for(let s of this.issues)s.path.length>0?(t[s.path[0]]=t[s.path[0]]||[],t[s.path[0]].push(e(s))):r.push(e(s));return{formErrors:r,fieldErrors:t}}get formErrors(){return this.flatten()}};L.create=a=>new L(a);var Je=(a,e)=>{let t;switch(a.code){case p.invalid_type:a.received===m.undefined?t="Required":t=`Expected ${a.expected}, received ${a.received}`;break;case p.invalid_literal:t=`Invalid literal value, expected ${JSON.stringify(a.expected,C.jsonStringifyReplacer)}`;break;case p.unrecognized_keys:t=`Unrecognized key(s) in object: ${C.joinValues(a.keys,", ")}`;break;case p.invalid_union:t="Invalid input";break;case p.invalid_union_discriminator:t=`Invalid discriminator value. Expected ${C.joinValues(a.options)}`;break;case p.invalid_enum_value:t=`Invalid enum value. Expected ${C.joinValues(a.options)}, received '${a.received}'`;break;case p.invalid_arguments:t="Invalid function arguments";break;case p.invalid_return_type:t="Invalid function return type";break;case p.invalid_date:t="Invalid date";break;case p.invalid_string:typeof a.validation=="object"?"includes"in a.validation?(t=`Invalid input: must include "${a.validation.includes}"`,typeof a.validation.position=="number"&&(t=`${t} at one or more positions greater than or equal to ${a.validation.position}`)):"startsWith"in a.validation?t=`Invalid input: must start with "${a.validation.startsWith}"`:"endsWith"in a.validation?t=`Invalid input: must end with "${a.validation.endsWith}"`:C.assertNever(a.validation):a.validation!=="regex"?t=`Invalid ${a.validation}`:t="Invalid";break;case p.too_small:a.type==="array"?t=`Array must contain ${a.exact?"exactly":a.inclusive?"at least":"more than"} ${a.minimum} element(s)`:a.type==="string"?t=`String must contain ${a.exact?"exactly":a.inclusive?"at least":"over"} ${a.minimum} character(s)`:a.type==="number"?t=`Number must be ${a.exact?"exactly equal to ":a.inclusive?"greater than or equal to ":"greater than "}${a.minimum}`:a.type==="date"?t=`Date must be ${a.exact?"exactly equal to ":a.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(a.minimum))}`:t="Invalid input";break;case p.too_big:a.type==="array"?t=`Array must contain ${a.exact?"exactly":a.inclusive?"at most":"less than"} ${a.maximum} element(s)`:a.type==="string"?t=`String must contain ${a.exact?"exactly":a.inclusive?"at most":"under"} ${a.maximum} character(s)`:a.type==="number"?t=`Number must be ${a.exact?"exactly":a.inclusive?"less than or equal to":"less than"} ${a.maximum}`:a.type==="bigint"?t=`BigInt must be ${a.exact?"exactly":a.inclusive?"less than or equal to":"less than"} ${a.maximum}`:a.type==="date"?t=`Date must be ${a.exact?"exactly":a.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(a.maximum))}`:t="Invalid input";break;case p.custom:t="Invalid input";break;case p.invalid_intersection_types:t="Intersection results could not be merged";break;case p.not_multiple_of:t=`Number must be a multiple of ${a.multipleOf}`;break;case p.not_finite:t="Number must be finite";break;default:t=e.defaultError,C.assertNever(a)}return{message:t}},Bn=Je;function ya(a){Bn=a}function dt(){return Bn}var ct=a=>{let{data:e,path:t,errorMaps:r,issueData:s}=a,o=[...t,...s.path||[]],i={...s,path:o},d="",c=r.filter(u=>!!u).slice().reverse();for(let u of c)d=u(i,{data:e,defaultError:d}).message;return{...s,path:o,message:s.message||d}},va=[];function h(a,e){let t=ct({issueData:e,data:a.data,path:a.path,errorMaps:[a.common.contextualErrorMap,a.schemaErrorMap,dt(),Je].filter(r=>!!r)});a.common.issues.push(t)}var I=class{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,t){let r=[];for(let s of t){if(s.status==="aborted")return v;s.status==="dirty"&&e.dirty(),r.push(s.value)}return{status:e.value,value:r}}static async mergeObjectAsync(e,t){let r=[];for(let s of t)r.push({key:await s.key,value:await s.value});return I.mergeObjectSync(e,r)}static mergeObjectSync(e,t){let r={};for(let s of t){let{key:o,value:i}=s;if(o.status==="aborted"||i.status==="aborted")return v;o.status==="dirty"&&e.dirty(),i.status==="dirty"&&e.dirty(),(typeof i.value<"u"||s.alwaysSet)&&(r[o.value]=i.value)}return{status:e.value,value:r}}},v=Object.freeze({status:"aborted"}),Un=a=>({status:"dirty",value:a}),O=a=>({status:"valid",value:a}),Ut=a=>a.status==="aborted",$t=a=>a.status==="dirty",lt=a=>a.status==="valid",ut=a=>typeof Promise<"u"&&a instanceof Promise,g;(function(a){a.errToObj=e=>typeof e=="string"?{message:e}:e||{},a.toString=e=>typeof e=="string"?e:e?.message})(g||(g={}));var $=class{constructor(e,t,r,s){this._cachedPath=[],this.parent=e,this.data=t,this._path=r,this._key=s}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}},Fn=(a,e)=>{if(lt(e))return{success:!0,data:e.value};if(!a.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;let t=new L(a.common.issues);return this._error=t,this._error}}};function b(a){if(!a)return{};let{errorMap:e,invalid_type_error:t,required_error:r,description:s}=a;if(e&&(t||r))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:s}:{errorMap:(i,d)=>i.code!=="invalid_type"?{message:d.defaultError}:typeof d.data>"u"?{message:r??d.defaultError}:{message:t??d.defaultError},description:s}}var S=class{constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this)}get description(){return this._def.description}_getType(e){return ie(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:ie(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new I,ctx:{common:e.parent.common,data:e.data,parsedType:ie(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){let t=this._parse(e);if(ut(t))throw new Error("Synchronous parse encountered promise.");return t}_parseAsync(e){let t=this._parse(e);return Promise.resolve(t)}parse(e,t){let r=this.safeParse(e,t);if(r.success)return r.data;throw r.error}safeParse(e,t){var r;let s={common:{issues:[],async:(r=t?.async)!==null&&r!==void 0?r:!1,contextualErrorMap:t?.errorMap},path:t?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:ie(e)},o=this._parseSync({data:e,path:s.path,parent:s});return Fn(s,o)}async parseAsync(e,t){let r=await this.safeParseAsync(e,t);if(r.success)return r.data;throw r.error}async safeParseAsync(e,t){let r={common:{issues:[],contextualErrorMap:t?.errorMap,async:!0},path:t?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:ie(e)},s=this._parse({data:e,path:r.path,parent:r}),o=await(ut(s)?s:Promise.resolve(s));return Fn(r,o)}refine(e,t){let r=s=>typeof t=="string"||typeof t>"u"?{message:t}:typeof t=="function"?t(s):t;return this._refinement((s,o)=>{let i=e(s),d=()=>o.addIssue({code:p.custom,...r(s)});return typeof Promise<"u"&&i instanceof Promise?i.then(c=>c?!0:(d(),!1)):i?!0:(d(),!1)})}refinement(e,t){return this._refinement((r,s)=>e(r)?!0:(s.addIssue(typeof t=="function"?t(r,s):t),!1))}_refinement(e){return new q({schema:this,typeName:y.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}optional(){return V.create(this,this._def)}nullable(){return ne.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return j.create(this,this._def)}promise(){return le.create(this,this._def)}or(e){return xe.create([this,e],this._def)}and(e){return Ce.create(this,e,this._def)}transform(e){return new q({...b(this._def),schema:this,typeName:y.ZodEffects,effect:{type:"transform",transform:e}})}default(e){let t=typeof e=="function"?e:()=>e;return new Ie({...b(this._def),innerType:this,defaultValue:t,typeName:y.ZodDefault})}brand(){return new pt({typeName:y.ZodBranded,type:this,...b(this._def)})}catch(e){let t=typeof e=="function"?e:()=>e;return new Ue({...b(this._def),innerType:this,catchValue:t,typeName:y.ZodCatch})}describe(e){let t=this.constructor;return new t({...this._def,description:e})}pipe(e){return Ee.create(this,e)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}},ba=/^c[^\s-]{8,}$/i,Sa=/^[a-z][a-z0-9]*$/,xa=/[0-9A-HJKMNP-TV-Z]{26}/,Ca=/^([a-f0-9]{8}-[a-f0-9]{4}-[1-5][a-f0-9]{3}-[a-f0-9]{4}-[a-f0-9]{12}|00000000-0000-0000-0000-000000000000)$/i,Ta=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\])|(\[IPv6:(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))\])|([A-Za-z0-9]([A-Za-z0-9-]*[A-Za-z0-9])*(\.[A-Za-z]{2,})+))$/,ka=/^(\p{Extended_Pictographic}|\p{Emoji_Component})+$/u,wa=/^(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))$/,_a=/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,Ia=a=>a.precision?a.offset?new RegExp(`^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}\\.\\d{${a.precision}}(([+-]\\d{2}(:?\\d{2})?)|Z)$`):new RegExp(`^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}\\.\\d{${a.precision}}Z$`):a.precision===0?a.offset?new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(([+-]\\d{2}(:?\\d{2})?)|Z)$"):new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}Z$"):a.offset?new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(\\.\\d+)?(([+-]\\d{2}(:?\\d{2})?)|Z)$"):new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(\\.\\d+)?Z$");function Ea(a,e){return!!((e==="v4"||!e)&&wa.test(a)||(e==="v6"||!e)&&_a.test(a))}var A=class extends S{constructor(){super(...arguments),this._regex=(e,t,r)=>this.refinement(s=>e.test(s),{validation:t,code:p.invalid_string,...g.errToObj(r)}),this.nonempty=e=>this.min(1,g.errToObj(e)),this.trim=()=>new A({...this._def,checks:[...this._def.checks,{kind:"trim"}]}),this.toLowerCase=()=>new A({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]}),this.toUpperCase=()=>new A({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==m.string){let o=this._getOrReturnCtx(e);return h(o,{code:p.invalid_type,expected:m.string,received:o.parsedType}),v}let r=new I,s;for(let o of this._def.checks)if(o.kind==="min")e.data.length<o.value&&(s=this._getOrReturnCtx(e,s),h(s,{code:p.too_small,minimum:o.value,type:"string",inclusive:!0,exact:!1,message:o.message}),r.dirty());else if(o.kind==="max")e.data.length>o.value&&(s=this._getOrReturnCtx(e,s),h(s,{code:p.too_big,maximum:o.value,type:"string",inclusive:!0,exact:!1,message:o.message}),r.dirty());else if(o.kind==="length"){let i=e.data.length>o.value,d=e.data.length<o.value;(i||d)&&(s=this._getOrReturnCtx(e,s),i?h(s,{code:p.too_big,maximum:o.value,type:"string",inclusive:!0,exact:!0,message:o.message}):d&&h(s,{code:p.too_small,minimum:o.value,type:"string",inclusive:!0,exact:!0,message:o.message}),r.dirty())}else if(o.kind==="email")Ta.test(e.data)||(s=this._getOrReturnCtx(e,s),h(s,{validation:"email",code:p.invalid_string,message:o.message}),r.dirty());else if(o.kind==="emoji")ka.test(e.data)||(s=this._getOrReturnCtx(e,s),h(s,{validation:"emoji",code:p.invalid_string,message:o.message}),r.dirty());else if(o.kind==="uuid")Ca.test(e.data)||(s=this._getOrReturnCtx(e,s),h(s,{validation:"uuid",code:p.invalid_string,message:o.message}),r.dirty());else if(o.kind==="cuid")ba.test(e.data)||(s=this._getOrReturnCtx(e,s),h(s,{validation:"cuid",code:p.invalid_string,message:o.message}),r.dirty());else if(o.kind==="cuid2")Sa.test(e.data)||(s=this._getOrReturnCtx(e,s),h(s,{validation:"cuid2",code:p.invalid_string,message:o.message}),r.dirty());else if(o.kind==="ulid")xa.test(e.data)||(s=this._getOrReturnCtx(e,s),h(s,{validation:"ulid",code:p.invalid_string,message:o.message}),r.dirty());else if(o.kind==="url")try{new URL(e.data)}catch{s=this._getOrReturnCtx(e,s),h(s,{validation:"url",code:p.invalid_string,message:o.message}),r.dirty()}else o.kind==="regex"?(o.regex.lastIndex=0,o.regex.test(e.data)||(s=this._getOrReturnCtx(e,s),h(s,{validation:"regex",code:p.invalid_string,message:o.message}),r.dirty())):o.kind==="trim"?e.data=e.data.trim():o.kind==="includes"?e.data.includes(o.value,o.position)||(s=this._getOrReturnCtx(e,s),h(s,{code:p.invalid_string,validation:{includes:o.value,position:o.position},message:o.message}),r.dirty()):o.kind==="toLowerCase"?e.data=e.data.toLowerCase():o.kind==="toUpperCase"?e.data=e.data.toUpperCase():o.kind==="startsWith"?e.data.startsWith(o.value)||(s=this._getOrReturnCtx(e,s),h(s,{code:p.invalid_string,validation:{startsWith:o.value},message:o.message}),r.dirty()):o.kind==="endsWith"?e.data.endsWith(o.value)||(s=this._getOrReturnCtx(e,s),h(s,{code:p.invalid_string,validation:{endsWith:o.value},message:o.message}),r.dirty()):o.kind==="datetime"?Ia(o).test(e.data)||(s=this._getOrReturnCtx(e,s),h(s,{code:p.invalid_string,validation:"datetime",message:o.message}),r.dirty()):o.kind==="ip"?Ea(e.data,o.version)||(s=this._getOrReturnCtx(e,s),h(s,{validation:"ip",code:p.invalid_string,message:o.message}),r.dirty()):C.assertNever(o);return{status:r.value,value:e.data}}_addCheck(e){return new A({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...g.errToObj(e)})}url(e){return this._addCheck({kind:"url",...g.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...g.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...g.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...g.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...g.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...g.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...g.errToObj(e)})}datetime(e){var t;return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof e?.precision>"u"?null:e?.precision,offset:(t=e?.offset)!==null&&t!==void 0?t:!1,...g.errToObj(e?.message)})}regex(e,t){return this._addCheck({kind:"regex",regex:e,...g.errToObj(t)})}includes(e,t){return this._addCheck({kind:"includes",value:e,position:t?.position,...g.errToObj(t?.message)})}startsWith(e,t){return this._addCheck({kind:"startsWith",value:e,...g.errToObj(t)})}endsWith(e,t){return this._addCheck({kind:"endsWith",value:e,...g.errToObj(t)})}min(e,t){return this._addCheck({kind:"min",value:e,...g.errToObj(t)})}max(e,t){return this._addCheck({kind:"max",value:e,...g.errToObj(t)})}length(e,t){return this._addCheck({kind:"length",value:e,...g.errToObj(t)})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get minLength(){let e=null;for(let t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(let t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}};A.create=a=>{var e;return new A({checks:[],typeName:y.ZodString,coerce:(e=a?.coerce)!==null&&e!==void 0?e:!1,...b(a)})};function Na(a,e){let t=(a.toString().split(".")[1]||"").length,r=(e.toString().split(".")[1]||"").length,s=t>r?t:r,o=parseInt(a.toFixed(s).replace(".","")),i=parseInt(e.toFixed(s).replace(".",""));return o%i/Math.pow(10,s)}var X=class extends S{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==m.number){let o=this._getOrReturnCtx(e);return h(o,{code:p.invalid_type,expected:m.number,received:o.parsedType}),v}let r,s=new I;for(let o of this._def.checks)o.kind==="int"?C.isInteger(e.data)||(r=this._getOrReturnCtx(e,r),h(r,{code:p.invalid_type,expected:"integer",received:"float",message:o.message}),s.dirty()):o.kind==="min"?(o.inclusive?e.data<o.value:e.data<=o.value)&&(r=this._getOrReturnCtx(e,r),h(r,{code:p.too_small,minimum:o.value,type:"number",inclusive:o.inclusive,exact:!1,message:o.message}),s.dirty()):o.kind==="max"?(o.inclusive?e.data>o.value:e.data>=o.value)&&(r=this._getOrReturnCtx(e,r),h(r,{code:p.too_big,maximum:o.value,type:"number",inclusive:o.inclusive,exact:!1,message:o.message}),s.dirty()):o.kind==="multipleOf"?Na(e.data,o.value)!==0&&(r=this._getOrReturnCtx(e,r),h(r,{code:p.not_multiple_of,multipleOf:o.value,message:o.message}),s.dirty()):o.kind==="finite"?Number.isFinite(e.data)||(r=this._getOrReturnCtx(e,r),h(r,{code:p.not_finite,message:o.message}),s.dirty()):C.assertNever(o);return{status:s.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,g.toString(t))}gt(e,t){return this.setLimit("min",e,!1,g.toString(t))}lte(e,t){return this.setLimit("max",e,!0,g.toString(t))}lt(e,t){return this.setLimit("max",e,!1,g.toString(t))}setLimit(e,t,r,s){return new X({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:r,message:g.toString(s)}]})}_addCheck(e){return new X({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:g.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:g.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:g.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:g.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:g.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:g.toString(t)})}finite(e){return this._addCheck({kind:"finite",message:g.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:g.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:g.toString(e)})}get minValue(){let e=null;for(let t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(let t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&C.isInteger(e.value))}get isFinite(){let e=null,t=null;for(let r of this._def.checks){if(r.kind==="finite"||r.kind==="int"||r.kind==="multipleOf")return!0;r.kind==="min"?(t===null||r.value>t)&&(t=r.value):r.kind==="max"&&(e===null||r.value<e)&&(e=r.value)}return Number.isFinite(t)&&Number.isFinite(e)}};X.create=a=>new X({checks:[],typeName:y.ZodNumber,coerce:a?.coerce||!1,...b(a)});var G=class extends S{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce&&(e.data=BigInt(e.data)),this._getType(e)!==m.bigint){let o=this._getOrReturnCtx(e);return h(o,{code:p.invalid_type,expected:m.bigint,received:o.parsedType}),v}let r,s=new I;for(let o of this._def.checks)o.kind==="min"?(o.inclusive?e.data<o.value:e.data<=o.value)&&(r=this._getOrReturnCtx(e,r),h(r,{code:p.too_small,type:"bigint",minimum:o.value,inclusive:o.inclusive,message:o.message}),s.dirty()):o.kind==="max"?(o.inclusive?e.data>o.value:e.data>=o.value)&&(r=this._getOrReturnCtx(e,r),h(r,{code:p.too_big,type:"bigint",maximum:o.value,inclusive:o.inclusive,message:o.message}),s.dirty()):o.kind==="multipleOf"?e.data%o.value!==BigInt(0)&&(r=this._getOrReturnCtx(e,r),h(r,{code:p.not_multiple_of,multipleOf:o.value,message:o.message}),s.dirty()):C.assertNever(o);return{status:s.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,g.toString(t))}gt(e,t){return this.setLimit("min",e,!1,g.toString(t))}lte(e,t){return this.setLimit("max",e,!0,g.toString(t))}lt(e,t){return this.setLimit("max",e,!1,g.toString(t))}setLimit(e,t,r,s){return new G({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:r,message:g.toString(s)}]})}_addCheck(e){return new G({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:g.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:g.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:g.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:g.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:g.toString(t)})}get minValue(){let e=null;for(let t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(let t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}};G.create=a=>{var e;return new G({checks:[],typeName:y.ZodBigInt,coerce:(e=a?.coerce)!==null&&e!==void 0?e:!1,...b(a)})};var ve=class extends S{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==m.boolean){let r=this._getOrReturnCtx(e);return h(r,{code:p.invalid_type,expected:m.boolean,received:r.parsedType}),v}return O(e.data)}};ve.create=a=>new ve({typeName:y.ZodBoolean,coerce:a?.coerce||!1,...b(a)});var ee=class extends S{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==m.date){let o=this._getOrReturnCtx(e);return h(o,{code:p.invalid_type,expected:m.date,received:o.parsedType}),v}if(isNaN(e.data.getTime())){let o=this._getOrReturnCtx(e);return h(o,{code:p.invalid_date}),v}let r=new I,s;for(let o of this._def.checks)o.kind==="min"?e.data.getTime()<o.value&&(s=this._getOrReturnCtx(e,s),h(s,{code:p.too_small,message:o.message,inclusive:!0,exact:!1,minimum:o.value,type:"date"}),r.dirty()):o.kind==="max"?e.data.getTime()>o.value&&(s=this._getOrReturnCtx(e,s),h(s,{code:p.too_big,message:o.message,inclusive:!0,exact:!1,maximum:o.value,type:"date"}),r.dirty()):C.assertNever(o);return{status:r.value,value:new Date(e.data.getTime())}}_addCheck(e){return new ee({...this._def,checks:[...this._def.checks,e]})}min(e,t){return this._addCheck({kind:"min",value:e.getTime(),message:g.toString(t)})}max(e,t){return this._addCheck({kind:"max",value:e.getTime(),message:g.toString(t)})}get minDate(){let e=null;for(let t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(let t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e!=null?new Date(e):null}};ee.create=a=>new ee({checks:[],coerce:a?.coerce||!1,typeName:y.ZodDate,...b(a)});var qe=class extends S{_parse(e){if(this._getType(e)!==m.symbol){let r=this._getOrReturnCtx(e);return h(r,{code:p.invalid_type,expected:m.symbol,received:r.parsedType}),v}return O(e.data)}};qe.create=a=>new qe({typeName:y.ZodSymbol,...b(a)});var be=class extends S{_parse(e){if(this._getType(e)!==m.undefined){let r=this._getOrReturnCtx(e);return h(r,{code:p.invalid_type,expected:m.undefined,received:r.parsedType}),v}return O(e.data)}};be.create=a=>new be({typeName:y.ZodUndefined,...b(a)});var Se=class extends S{_parse(e){if(this._getType(e)!==m.null){let r=this._getOrReturnCtx(e);return h(r,{code:p.invalid_type,expected:m.null,received:r.parsedType}),v}return O(e.data)}};Se.create=a=>new Se({typeName:y.ZodNull,...b(a)});var ce=class extends S{constructor(){super(...arguments),this._any=!0}_parse(e){return O(e.data)}};ce.create=a=>new ce({typeName:y.ZodAny,...b(a)});var Q=class extends S{constructor(){super(...arguments),this._unknown=!0}_parse(e){return O(e.data)}};Q.create=a=>new Q({typeName:y.ZodUnknown,...b(a)});var Z=class extends S{_parse(e){let t=this._getOrReturnCtx(e);return h(t,{code:p.invalid_type,expected:m.never,received:t.parsedType}),v}};Z.create=a=>new Z({typeName:y.ZodNever,...b(a)});var Fe=class extends S{_parse(e){if(this._getType(e)!==m.undefined){let r=this._getOrReturnCtx(e);return h(r,{code:p.invalid_type,expected:m.void,received:r.parsedType}),v}return O(e.data)}};Fe.create=a=>new Fe({typeName:y.ZodVoid,...b(a)});var j=class extends S{_parse(e){let{ctx:t,status:r}=this._processInputParams(e),s=this._def;if(t.parsedType!==m.array)return h(t,{code:p.invalid_type,expected:m.array,received:t.parsedType}),v;if(s.exactLength!==null){let i=t.data.length>s.exactLength.value,d=t.data.length<s.exactLength.value;(i||d)&&(h(t,{code:i?p.too_big:p.too_small,minimum:d?s.exactLength.value:void 0,maximum:i?s.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:s.exactLength.message}),r.dirty())}if(s.minLength!==null&&t.data.length<s.minLength.value&&(h(t,{code:p.too_small,minimum:s.minLength.value,type:"array",inclusive:!0,exact:!1,message:s.minLength.message}),r.dirty()),s.maxLength!==null&&t.data.length>s.maxLength.value&&(h(t,{code:p.too_big,maximum:s.maxLength.value,type:"array",inclusive:!0,exact:!1,message:s.maxLength.message}),r.dirty()),t.common.async)return Promise.all([...t.data].map((i,d)=>s.type._parseAsync(new $(t,i,t.path,d)))).then(i=>I.mergeArray(r,i));let o=[...t.data].map((i,d)=>s.type._parseSync(new $(t,i,t.path,d)));return I.mergeArray(r,o)}get element(){return this._def.type}min(e,t){return new j({...this._def,minLength:{value:e,message:g.toString(t)}})}max(e,t){return new j({...this._def,maxLength:{value:e,message:g.toString(t)}})}length(e,t){return new j({...this._def,exactLength:{value:e,message:g.toString(t)}})}nonempty(e){return this.min(1,e)}};j.create=(a,e)=>new j({type:a,minLength:null,maxLength:null,exactLength:null,typeName:y.ZodArray,...b(e)});function je(a){if(a instanceof T){let e={};for(let t in a.shape){let r=a.shape[t];e[t]=V.create(je(r))}return new T({...a._def,shape:()=>e})}else return a instanceof j?new j({...a._def,type:je(a.element)}):a instanceof V?V.create(je(a.unwrap())):a instanceof ne?ne.create(je(a.unwrap())):a instanceof W?W.create(a.items.map(e=>je(e))):a}var T=class extends S{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;let e=this._def.shape(),t=C.objectKeys(e);return this._cached={shape:e,keys:t}}_parse(e){if(this._getType(e)!==m.object){let u=this._getOrReturnCtx(e);return h(u,{code:p.invalid_type,expected:m.object,received:u.parsedType}),v}let{status:r,ctx:s}=this._processInputParams(e),{shape:o,keys:i}=this._getCached(),d=[];if(!(this._def.catchall instanceof Z&&this._def.unknownKeys==="strip"))for(let u in s.data)i.includes(u)||d.push(u);let c=[];for(let u of i){let l=o[u],f=s.data[u];c.push({key:{status:"valid",value:u},value:l._parse(new $(s,f,s.path,u)),alwaysSet:u in s.data})}if(this._def.catchall instanceof Z){let u=this._def.unknownKeys;if(u==="passthrough")for(let l of d)c.push({key:{status:"valid",value:l},value:{status:"valid",value:s.data[l]}});else if(u==="strict")d.length>0&&(h(s,{code:p.unrecognized_keys,keys:d}),r.dirty());else if(u!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{let u=this._def.catchall;for(let l of d){let f=s.data[l];c.push({key:{status:"valid",value:l},value:u._parse(new $(s,f,s.path,l)),alwaysSet:l in s.data})}}return s.common.async?Promise.resolve().then(async()=>{let u=[];for(let l of c){let f=await l.key;u.push({key:f,value:await l.value,alwaysSet:l.alwaysSet})}return u}).then(u=>I.mergeObjectSync(r,u)):I.mergeObjectSync(r,c)}get shape(){return this._def.shape()}strict(e){return g.errToObj,new T({...this._def,unknownKeys:"strict",...e!==void 0?{errorMap:(t,r)=>{var s,o,i,d;let c=(i=(o=(s=this._def).errorMap)===null||o===void 0?void 0:o.call(s,t,r).message)!==null&&i!==void 0?i:r.defaultError;return t.code==="unrecognized_keys"?{message:(d=g.errToObj(e).message)!==null&&d!==void 0?d:c}:{message:c}}}:{}})}strip(){return new T({...this._def,unknownKeys:"strip"})}passthrough(){return new T({...this._def,unknownKeys:"passthrough"})}extend(e){return new T({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new T({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:y.ZodObject})}setKey(e,t){return this.augment({[e]:t})}catchall(e){return new T({...this._def,catchall:e})}pick(e){let t={};return C.objectKeys(e).forEach(r=>{e[r]&&this.shape[r]&&(t[r]=this.shape[r])}),new T({...this._def,shape:()=>t})}omit(e){let t={};return C.objectKeys(this.shape).forEach(r=>{e[r]||(t[r]=this.shape[r])}),new T({...this._def,shape:()=>t})}deepPartial(){return je(this)}partial(e){let t={};return C.objectKeys(this.shape).forEach(r=>{let s=this.shape[r];e&&!e[r]?t[r]=s:t[r]=s.optional()}),new T({...this._def,shape:()=>t})}required(e){let t={};return C.objectKeys(this.shape).forEach(r=>{if(e&&!e[r])t[r]=this.shape[r];else{let o=this.shape[r];for(;o instanceof V;)o=o._def.innerType;t[r]=o}}),new T({...this._def,shape:()=>t})}keyof(){return $n(C.objectKeys(this.shape))}};T.create=(a,e)=>new T({shape:()=>a,unknownKeys:"strip",catchall:Z.create(),typeName:y.ZodObject,...b(e)});T.strictCreate=(a,e)=>new T({shape:()=>a,unknownKeys:"strict",catchall:Z.create(),typeName:y.ZodObject,...b(e)});T.lazycreate=(a,e)=>new T({shape:a,unknownKeys:"strip",catchall:Z.create(),typeName:y.ZodObject,...b(e)});var xe=class extends S{_parse(e){let{ctx:t}=this._processInputParams(e),r=this._def.options;function s(o){for(let d of o)if(d.result.status==="valid")return d.result;for(let d of o)if(d.result.status==="dirty")return t.common.issues.push(...d.ctx.common.issues),d.result;let i=o.map(d=>new L(d.ctx.common.issues));return h(t,{code:p.invalid_union,unionErrors:i}),v}if(t.common.async)return Promise.all(r.map(async o=>{let i={...t,common:{...t.common,issues:[]},parent:null};return{result:await o._parseAsync({data:t.data,path:t.path,parent:i}),ctx:i}})).then(s);{let o,i=[];for(let c of r){let u={...t,common:{...t.common,issues:[]},parent:null},l=c._parseSync({data:t.data,path:t.path,parent:u});if(l.status==="valid")return l;l.status==="dirty"&&!o&&(o={result:l,ctx:u}),u.common.issues.length&&i.push(u.common.issues)}if(o)return t.common.issues.push(...o.ctx.common.issues),o.result;let d=i.map(c=>new L(c));return h(t,{code:p.invalid_union,unionErrors:d}),v}}get options(){return this._def.options}};xe.create=(a,e)=>new xe({options:a,typeName:y.ZodUnion,...b(e)});var it=a=>a instanceof ke?it(a.schema):a instanceof q?it(a.innerType()):a instanceof we?[a.value]:a instanceof J?a.options:a instanceof _e?Object.keys(a.enum):a instanceof Ie?it(a._def.innerType):a instanceof be?[void 0]:a instanceof Se?[null]:null,ze=class extends S{_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==m.object)return h(t,{code:p.invalid_type,expected:m.object,received:t.parsedType}),v;let r=this.discriminator,s=t.data[r],o=this.optionsMap.get(s);return o?t.common.async?o._parseAsync({data:t.data,path:t.path,parent:t}):o._parseSync({data:t.data,path:t.path,parent:t}):(h(t,{code:p.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[r]}),v)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,t,r){let s=new Map;for(let o of t){let i=it(o.shape[e]);if(!i)throw new Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(let d of i){if(s.has(d))throw new Error(`Discriminator property ${String(e)} has duplicate value ${String(d)}`);s.set(d,o)}}return new ze({typeName:y.ZodDiscriminatedUnion,discriminator:e,options:t,optionsMap:s,...b(r)})}};function Wt(a,e){let t=ie(a),r=ie(e);if(a===e)return{valid:!0,data:a};if(t===m.object&&r===m.object){let s=C.objectKeys(e),o=C.objectKeys(a).filter(d=>s.indexOf(d)!==-1),i={...a,...e};for(let d of o){let c=Wt(a[d],e[d]);if(!c.valid)return{valid:!1};i[d]=c.data}return{valid:!0,data:i}}else if(t===m.array&&r===m.array){if(a.length!==e.length)return{valid:!1};let s=[];for(let o=0;o<a.length;o++){let i=a[o],d=e[o],c=Wt(i,d);if(!c.valid)return{valid:!1};s.push(c.data)}return{valid:!0,data:s}}else return t===m.date&&r===m.date&&+a==+e?{valid:!0,data:a}:{valid:!1}}var Ce=class extends S{_parse(e){let{status:t,ctx:r}=this._processInputParams(e),s=(o,i)=>{if(Ut(o)||Ut(i))return v;let d=Wt(o.value,i.value);return d.valid?(($t(o)||$t(i))&&t.dirty(),{status:t.value,value:d.data}):(h(r,{code:p.invalid_intersection_types}),v)};return r.common.async?Promise.all([this._def.left._parseAsync({data:r.data,path:r.path,parent:r}),this._def.right._parseAsync({data:r.data,path:r.path,parent:r})]).then(([o,i])=>s(o,i)):s(this._def.left._parseSync({data:r.data,path:r.path,parent:r}),this._def.right._parseSync({data:r.data,path:r.path,parent:r}))}};Ce.create=(a,e,t)=>new Ce({left:a,right:e,typeName:y.ZodIntersection,...b(t)});var W=class extends S{_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==m.array)return h(r,{code:p.invalid_type,expected:m.array,received:r.parsedType}),v;if(r.data.length<this._def.items.length)return h(r,{code:p.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),v;!this._def.rest&&r.data.length>this._def.items.length&&(h(r,{code:p.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),t.dirty());let o=[...r.data].map((i,d)=>{let c=this._def.items[d]||this._def.rest;return c?c._parse(new $(r,i,r.path,d)):null}).filter(i=>!!i);return r.common.async?Promise.all(o).then(i=>I.mergeArray(t,i)):I.mergeArray(t,o)}get items(){return this._def.items}rest(e){return new W({...this._def,rest:e})}};W.create=(a,e)=>{if(!Array.isArray(a))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new W({items:a,typeName:y.ZodTuple,rest:null,...b(e)})};var Te=class extends S{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==m.object)return h(r,{code:p.invalid_type,expected:m.object,received:r.parsedType}),v;let s=[],o=this._def.keyType,i=this._def.valueType;for(let d in r.data)s.push({key:o._parse(new $(r,d,r.path,d)),value:i._parse(new $(r,r.data[d],r.path,d))});return r.common.async?I.mergeObjectAsync(t,s):I.mergeObjectSync(t,s)}get element(){return this._def.valueType}static create(e,t,r){return t instanceof S?new Te({keyType:e,valueType:t,typeName:y.ZodRecord,...b(r)}):new Te({keyType:A.create(),valueType:e,typeName:y.ZodRecord,...b(t)})}},Be=class extends S{_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==m.map)return h(r,{code:p.invalid_type,expected:m.map,received:r.parsedType}),v;let s=this._def.keyType,o=this._def.valueType,i=[...r.data.entries()].map(([d,c],u)=>({key:s._parse(new $(r,d,r.path,[u,"key"])),value:o._parse(new $(r,c,r.path,[u,"value"]))}));if(r.common.async){let d=new Map;return Promise.resolve().then(async()=>{for(let c of i){let u=await c.key,l=await c.value;if(u.status==="aborted"||l.status==="aborted")return v;(u.status==="dirty"||l.status==="dirty")&&t.dirty(),d.set(u.value,l.value)}return{status:t.value,value:d}})}else{let d=new Map;for(let c of i){let u=c.key,l=c.value;if(u.status==="aborted"||l.status==="aborted")return v;(u.status==="dirty"||l.status==="dirty")&&t.dirty(),d.set(u.value,l.value)}return{status:t.value,value:d}}}};Be.create=(a,e,t)=>new Be({valueType:e,keyType:a,typeName:y.ZodMap,...b(t)});var te=class extends S{_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==m.set)return h(r,{code:p.invalid_type,expected:m.set,received:r.parsedType}),v;let s=this._def;s.minSize!==null&&r.data.size<s.minSize.value&&(h(r,{code:p.too_small,minimum:s.minSize.value,type:"set",inclusive:!0,exact:!1,message:s.minSize.message}),t.dirty()),s.maxSize!==null&&r.data.size>s.maxSize.value&&(h(r,{code:p.too_big,maximum:s.maxSize.value,type:"set",inclusive:!0,exact:!1,message:s.maxSize.message}),t.dirty());let o=this._def.valueType;function i(c){let u=new Set;for(let l of c){if(l.status==="aborted")return v;l.status==="dirty"&&t.dirty(),u.add(l.value)}return{status:t.value,value:u}}let d=[...r.data.values()].map((c,u)=>o._parse(new $(r,c,r.path,u)));return r.common.async?Promise.all(d).then(c=>i(c)):i(d)}min(e,t){return new te({...this._def,minSize:{value:e,message:g.toString(t)}})}max(e,t){return new te({...this._def,maxSize:{value:e,message:g.toString(t)}})}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}};te.create=(a,e)=>new te({valueType:a,minSize:null,maxSize:null,typeName:y.ZodSet,...b(e)});var de=class extends S{constructor(){super(...arguments),this.validate=this.implement}_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==m.function)return h(t,{code:p.invalid_type,expected:m.function,received:t.parsedType}),v;function r(d,c){return ct({data:d,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,dt(),Je].filter(u=>!!u),issueData:{code:p.invalid_arguments,argumentsError:c}})}function s(d,c){return ct({data:d,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,dt(),Je].filter(u=>!!u),issueData:{code:p.invalid_return_type,returnTypeError:c}})}let o={errorMap:t.common.contextualErrorMap},i=t.data;return this._def.returns instanceof le?O(async(...d)=>{let c=new L([]),u=await this._def.args.parseAsync(d,o).catch(x=>{throw c.addIssue(r(d,x)),c}),l=await i(...u);return await this._def.returns._def.type.parseAsync(l,o).catch(x=>{throw c.addIssue(s(l,x)),c})}):O((...d)=>{let c=this._def.args.safeParse(d,o);if(!c.success)throw new L([r(d,c.error)]);let u=i(...c.data),l=this._def.returns.safeParse(u,o);if(!l.success)throw new L([s(u,l.error)]);return l.data})}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new de({...this._def,args:W.create(e).rest(Q.create())})}returns(e){return new de({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,t,r){return new de({args:e||W.create([]).rest(Q.create()),returns:t||Q.create(),typeName:y.ZodFunction,...b(r)})}},ke=class extends S{get schema(){return this._def.getter()}_parse(e){let{ctx:t}=this._processInputParams(e);return this._def.getter()._parse({data:t.data,path:t.path,parent:t})}};ke.create=(a,e)=>new ke({getter:a,typeName:y.ZodLazy,...b(e)});var we=class extends S{_parse(e){if(e.data!==this._def.value){let t=this._getOrReturnCtx(e);return h(t,{received:t.data,code:p.invalid_literal,expected:this._def.value}),v}return{status:"valid",value:e.data}}get value(){return this._def.value}};we.create=(a,e)=>new we({value:a,typeName:y.ZodLiteral,...b(e)});function $n(a,e){return new J({values:a,typeName:y.ZodEnum,...b(e)})}var J=class extends S{_parse(e){if(typeof e.data!="string"){let t=this._getOrReturnCtx(e),r=this._def.values;return h(t,{expected:C.joinValues(r),received:t.parsedType,code:p.invalid_type}),v}if(this._def.values.indexOf(e.data)===-1){let t=this._getOrReturnCtx(e),r=this._def.values;return h(t,{received:t.data,code:p.invalid_enum_value,options:r}),v}return O(e.data)}get options(){return this._def.values}get enum(){let e={};for(let t of this._def.values)e[t]=t;return e}get Values(){let e={};for(let t of this._def.values)e[t]=t;return e}get Enum(){let e={};for(let t of this._def.values)e[t]=t;return e}extract(e){return J.create(e)}exclude(e){return J.create(this.options.filter(t=>!e.includes(t)))}};J.create=$n;var _e=class extends S{_parse(e){let t=C.getValidEnumValues(this._def.values),r=this._getOrReturnCtx(e);if(r.parsedType!==m.string&&r.parsedType!==m.number){let s=C.objectValues(t);return h(r,{expected:C.joinValues(s),received:r.parsedType,code:p.invalid_type}),v}if(t.indexOf(e.data)===-1){let s=C.objectValues(t);return h(r,{received:r.data,code:p.invalid_enum_value,options:s}),v}return O(e.data)}get enum(){return this._def.values}};_e.create=(a,e)=>new _e({values:a,typeName:y.ZodNativeEnum,...b(e)});var le=class extends S{unwrap(){return this._def.type}_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==m.promise&&t.common.async===!1)return h(t,{code:p.invalid_type,expected:m.promise,received:t.parsedType}),v;let r=t.parsedType===m.promise?t.data:Promise.resolve(t.data);return O(r.then(s=>this._def.type.parseAsync(s,{path:t.path,errorMap:t.common.contextualErrorMap})))}};le.create=(a,e)=>new le({type:a,typeName:y.ZodPromise,...b(e)});var q=class extends S{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===y.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){let{status:t,ctx:r}=this._processInputParams(e),s=this._def.effect||null;if(s.type==="preprocess"){let i=s.transform(r.data);return r.common.async?Promise.resolve(i).then(d=>this._def.schema._parseAsync({data:d,path:r.path,parent:r})):this._def.schema._parseSync({data:i,path:r.path,parent:r})}let o={addIssue:i=>{h(r,i),i.fatal?t.abort():t.dirty()},get path(){return r.path}};if(o.addIssue=o.addIssue.bind(o),s.type==="refinement"){let i=d=>{let c=s.refinement(d,o);if(r.common.async)return Promise.resolve(c);if(c instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return d};if(r.common.async===!1){let d=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});return d.status==="aborted"?v:(d.status==="dirty"&&t.dirty(),i(d.value),{status:t.value,value:d.value})}else return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(d=>d.status==="aborted"?v:(d.status==="dirty"&&t.dirty(),i(d.value).then(()=>({status:t.value,value:d.value}))))}if(s.type==="transform")if(r.common.async===!1){let i=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});if(!lt(i))return i;let d=s.transform(i.value,o);if(d instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:t.value,value:d}}else return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(i=>lt(i)?Promise.resolve(s.transform(i.value,o)).then(d=>({status:t.value,value:d})):i);C.assertNever(s)}};q.create=(a,e,t)=>new q({schema:a,typeName:y.ZodEffects,effect:e,...b(t)});q.createWithPreprocess=(a,e,t)=>new q({schema:e,effect:{type:"preprocess",transform:a},typeName:y.ZodEffects,...b(t)});var V=class extends S{_parse(e){return this._getType(e)===m.undefined?O(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}};V.create=(a,e)=>new V({innerType:a,typeName:y.ZodOptional,...b(e)});var ne=class extends S{_parse(e){return this._getType(e)===m.null?O(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}};ne.create=(a,e)=>new ne({innerType:a,typeName:y.ZodNullable,...b(e)});var Ie=class extends S{_parse(e){let{ctx:t}=this._processInputParams(e),r=t.data;return t.parsedType===m.undefined&&(r=this._def.defaultValue()),this._def.innerType._parse({data:r,path:t.path,parent:t})}removeDefault(){return this._def.innerType}};Ie.create=(a,e)=>new Ie({innerType:a,typeName:y.ZodDefault,defaultValue:typeof e.default=="function"?e.default:()=>e.default,...b(e)});var Ue=class extends S{_parse(e){let{ctx:t}=this._processInputParams(e),r={...t,common:{...t.common,issues:[]}},s=this._def.innerType._parse({data:r.data,path:r.path,parent:{...r}});return ut(s)?s.then(o=>({status:"valid",value:o.status==="valid"?o.value:this._def.catchValue({get error(){return new L(r.common.issues)},input:r.data})})):{status:"valid",value:s.status==="valid"?s.value:this._def.catchValue({get error(){return new L(r.common.issues)},input:r.data})}}removeCatch(){return this._def.innerType}};Ue.create=(a,e)=>new Ue({innerType:a,typeName:y.ZodCatch,catchValue:typeof e.catch=="function"?e.catch:()=>e.catch,...b(e)});var $e=class extends S{_parse(e){if(this._getType(e)!==m.nan){let r=this._getOrReturnCtx(e);return h(r,{code:p.invalid_type,expected:m.nan,received:r.parsedType}),v}return{status:"valid",value:e.data}}};$e.create=a=>new $e({typeName:y.ZodNaN,...b(a)});var Ra=Symbol("zod_brand"),pt=class extends S{_parse(e){let{ctx:t}=this._processInputParams(e),r=t.data;return this._def.type._parse({data:r,path:t.path,parent:t})}unwrap(){return this._def.type}},Ee=class extends S{_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.common.async)return(async()=>{let o=await this._def.in._parseAsync({data:r.data,path:r.path,parent:r});return o.status==="aborted"?v:o.status==="dirty"?(t.dirty(),Un(o.value)):this._def.out._parseAsync({data:o.value,path:r.path,parent:r})})();{let s=this._def.in._parseSync({data:r.data,path:r.path,parent:r});return s.status==="aborted"?v:s.status==="dirty"?(t.dirty(),{status:"dirty",value:s.value}):this._def.out._parseSync({data:s.value,path:r.path,parent:r})}}static create(e,t){return new Ee({in:e,out:t,typeName:y.ZodPipeline})}},Wn=(a,e={},t)=>a?ce.create().superRefine((r,s)=>{var o,i;if(!a(r)){let d=typeof e=="function"?e(r):typeof e=="string"?{message:e}:e,c=(i=(o=d.fatal)!==null&&o!==void 0?o:t)!==null&&i!==void 0?i:!0,u=typeof d=="string"?{message:d}:d;s.addIssue({code:"custom",...u,fatal:c})}}):ce.create(),Oa={object:T.lazycreate},y;(function(a){a.ZodString="ZodString",a.ZodNumber="ZodNumber",a.ZodNaN="ZodNaN",a.ZodBigInt="ZodBigInt",a.ZodBoolean="ZodBoolean",a.ZodDate="ZodDate",a.ZodSymbol="ZodSymbol",a.ZodUndefined="ZodUndefined",a.ZodNull="ZodNull",a.ZodAny="ZodAny",a.ZodUnknown="ZodUnknown",a.ZodNever="ZodNever",a.ZodVoid="ZodVoid",a.ZodArray="ZodArray",a.ZodObject="ZodObject",a.ZodUnion="ZodUnion",a.ZodDiscriminatedUnion="ZodDiscriminatedUnion",a.ZodIntersection="ZodIntersection",a.ZodTuple="ZodTuple",a.ZodRecord="ZodRecord",a.ZodMap="ZodMap",a.ZodSet="ZodSet",a.ZodFunction="ZodFunction",a.ZodLazy="ZodLazy",a.ZodLiteral="ZodLiteral",a.ZodEnum="ZodEnum",a.ZodEffects="ZodEffects",a.ZodNativeEnum="ZodNativeEnum",a.ZodOptional="ZodOptional",a.ZodNullable="ZodNullable",a.ZodDefault="ZodDefault",a.ZodCatch="ZodCatch",a.ZodPromise="ZodPromise",a.ZodBranded="ZodBranded",a.ZodPipeline="ZodPipeline"})(y||(y={}));var Pa=(a,e={message:`Input not instance of ${a.name}`})=>Wn(t=>t instanceof a,e),Vn=A.create,Zn=X.create,Ma=$e.create,Da=G.create,Hn=ve.create,Aa=ee.create,La=qe.create,ja=be.create,qa=Se.create,Fa=ce.create,za=Q.create,Ba=Z.create,Ua=Fe.create,$a=j.create,Wa=T.create,Va=T.strictCreate,Za=xe.create,Ha=ze.create,Xa=Ce.create,Ga=W.create,Ja=Te.create,Ya=Be.create,Ka=te.create,Qa=de.create,es=ke.create,ts=we.create,ns=J.create,rs=_e.create,as=le.create,zn=q.create,ss=V.create,os=ne.create,is=q.createWithPreprocess,ds=Ee.create,cs=()=>Vn().optional(),ls=()=>Zn().optional(),us=()=>Hn().optional(),ps={string:a=>A.create({...a,coerce:!0}),number:a=>X.create({...a,coerce:!0}),boolean:a=>ve.create({...a,coerce:!0}),bigint:a=>G.create({...a,coerce:!0}),date:a=>ee.create({...a,coerce:!0})},ms=v,n=Object.freeze({__proto__:null,defaultErrorMap:Je,setErrorMap:ya,getErrorMap:dt,makeIssue:ct,EMPTY_PATH:va,addIssueToContext:h,ParseStatus:I,INVALID:v,DIRTY:Un,OK:O,isAborted:Ut,isDirty:$t,isValid:lt,isAsync:ut,get util(){return C},get objectUtil(){return Bt},ZodParsedType:m,getParsedType:ie,ZodType:S,ZodString:A,ZodNumber:X,ZodBigInt:G,ZodBoolean:ve,ZodDate:ee,ZodSymbol:qe,ZodUndefined:be,ZodNull:Se,ZodAny:ce,ZodUnknown:Q,ZodNever:Z,ZodVoid:Fe,ZodArray:j,ZodObject:T,ZodUnion:xe,ZodDiscriminatedUnion:ze,ZodIntersection:Ce,ZodTuple:W,ZodRecord:Te,ZodMap:Be,ZodSet:te,ZodFunction:de,ZodLazy:ke,ZodLiteral:we,ZodEnum:J,ZodNativeEnum:_e,ZodPromise:le,ZodEffects:q,ZodTransformer:q,ZodOptional:V,ZodNullable:ne,ZodDefault:Ie,ZodCatch:Ue,ZodNaN:$e,BRAND:Ra,ZodBranded:pt,ZodPipeline:Ee,custom:Wn,Schema:S,ZodSchema:S,late:Oa,get ZodFirstPartyTypeKind(){return y},coerce:ps,any:Fa,array:$a,bigint:Da,boolean:Hn,date:Aa,discriminatedUnion:Ha,effect:zn,enum:ns,function:Qa,instanceof:Pa,intersection:Xa,lazy:es,literal:ts,map:Ya,nan:Ma,nativeEnum:rs,never:Ba,null:qa,nullable:os,number:Zn,object:Wa,oboolean:us,onumber:ls,optional:ss,ostring:cs,pipeline:ds,preprocess:is,promise:as,record:Ja,set:Ka,strictObject:Va,string:Vn,symbol:La,transformer:zn,tuple:Ga,undefined:ja,union:Za,unknown:za,void:Ua,NEVER:ms,ZodIssueCode:p,quotelessJson:ga,ZodError:L});var Vt=n.object({id:n.number(),name:n.string(),value:n.string()});var Xn=n.object({id:n.number(),name:n.string()});var Gn=n.object({id:n.number(),characterData:n.string()});var Jn=n.object({elementSelector:n.string(),frameId:n.string(),checked:n.boolean()});var Yn=n.object({scrollX:n.number(),scrollY:n.number(),elementSelector:n.string(),frameId:n.string()});var hs=n.object({id:n.number(),parentId:n.number().optional(),nodeType:n.number(),nodeName:n.string(),localName:n.string(),nodeValue:n.string(),attributes:n.record(n.string(),n.string()).optional(),documentURL:n.string().optional(),baseURL:n.string().optional(),publicId:n.string().optional(),systemId:n.string().optional(),internalSubset:n.string().optional(),name:n.string().optional(),value:n.string().optional(),frameId:n.string().optional(),childNodeCount:n.number().optional(),shadowRootType:n.enum(["closed","open","user-agent"]).or(n.string()).optional(),isSVG:n.boolean().optional(),compatibilityMode:n.enum(["QuirksMode","LimitedQuirksMode","NoQuirksMode"]).or(n.string()).optional(),xmlVersion:n.string().optional()}),Ne=hs.extend({children:n.lazy(()=>Ne.array()),contentDocument:n.lazy(()=>Ne.optional()),shadowRoots:n.lazy(()=>Ne.array())});var Kn=n.object({node:Ne});var Zt=n.object({parentId:n.number(),node:Ne,previousId:n.number().optional()});var Qn=n.object({parentId:n.number(),id:n.number()});var mt=n.object({elementSelector:n.string(),checked:n.boolean(),name:n.string().optional(),frameId:n.string()});var ht=n.object({elementSelector:n.string(),frameId:n.string(),values:n.array(n.string())});var er=n.object({styleSheetId:n.string(),frameId:n.string(),styleSheetText:n.string().optional(),sourceURL:n.string().optional(),cdpRetrievalFailed:n.boolean(),ownerNode:n.number().optional(),isConstructed:n.boolean(),isInline:n.boolean(),isMutable:n.boolean()});var tr=n.object({styleSheetId:n.string(),styleSheetText:n.string().optional(),cdpRetrievalFailed:n.boolean()});var nr=n.object({styleSheetId:n.string()});var rr=n.object({elementSelector:n.string(),frameId:n.string(),value:n.string()});var ar=n.object({scrollX:n.number(),scrollY:n.number(),frameId:n.string()});var Xt=z(H()),N=require("perf_hooks"),or=z(Ht());var ue=(0,Xt.default)("cypress:protocol:capture:DOMManager"),P=(0,Xt.default)("cypress-verbose:protocol:capture:DOMManager"),ft=class extends U{constructor(){super(...arguments);this.afterTestReceived=!1;this.waitForAfterTest=async()=>{if(this.afterTestReceived){this.afterTestReceived=!1;return}this.deferredWaitForAfterTest=(0,or.default)(),await this.deferredWaitForAfterTest.promise};this.frameAttached=t=>{P("Page.frameAttached %O",t),this.state.domState.autFrameId&&(this.state.domState.autFrameId===t.parentFrameId||this.state.domState.isTrackedFrame(t.parentFrameId))&&this.state.domState.addTrackedFrame(t.frameId)};this.frameDetached=t=>{P("Page.frameDetached %O",t),this.state.domState.removeTrackedFrame(t.frameId),this.state.domState.autFrameId===t.frameId&&this.state.domState.resetAutState()};this.lifecycleEvent=async t=>{let r=N.performance.now()+N.performance.timeOrigin;if(t.name!=="init"||(P("Page.lifecycleEvent %O",t),this.state.domState.isFrameOutsideContext(t.frameId)))return;let s=await this.cdpClient.send("DOM.getFrameOwner",{frameId:t.frameId}).catch(()=>({backendNodeId:null}));if(!s.backendNodeId)return;let o=s.backendNodeId;P("Page.lifecycleEvent backendNodeId %O",o);let{node:i}=await this.cdpClient.send("DOM.describeNode",{backendNodeId:o,depth:1});P("Page.lifecycleEvent document %O",i),ot(i)&&(this.state.domState.autFrameId=t.frameId,this.state.domState.addTrackedFrame(t.frameId),await this.captureFullSnapshot({timestamp:r,flushImmediately:!1}))};this.captureFullSnapshot=async({timestamp:t,flushImmediately:r})=>{var c,u;this.cdpClient.domIsLoading=!0;let s=await this.cdpClient.send("DOM.getDocument",{depth:-1,pierce:!0});if(this.cdpClient.domIsLoading=!1,!this.state.activeRunnable)return;let o=(c=this.state.activeRunnable)==null?void 0:c.id,i=(u=this.state.activeRunnable)==null?void 0:u.attempt,d=ot(s.root);if(d&&d.contentDocument){this.state.domState.autFrameNodeId=d.nodeId,this.state.domState.trackAndMapNodeAndChildren(d.contentDocument);let l=await ye(this.cdpClient,d.contentDocument);this.insertEvent({eventType:"dom:full-snapshot",eventPayload:{node:l},eventExpectedSchema:Kn,timestamp:t,runnableId:o,attempt:i,flushImmediately:r})}};this.characterDataModified=async t=>{var u,l;let r=N.performance.now()+N.performance.timeOrigin,s=(u=this.state.activeRunnable)==null?void 0:u.id,o=(l=this.state.activeRunnable)==null?void 0:l.attempt,{nodeId:i,characterData:d}=t;ue("DOM.characterDataModified %O",{nodeId:i,characterData:d.length>16?`"${d.substring(0,16)}..."`:`${d}`}),P("Event: %O",t);let c=this.state.domState.getBackendNodeId(t.nodeId);c&&this.state.domState.isBackendNodeIdTracked(c)?this.insertEvent({eventType:"dom:character-data-modified",eventPayload:{id:c,characterData:d},eventExpectedSchema:Gn,timestamp:r,runnableId:s,attempt:o}):P("Node %d is not tracked; skipping db insertion",i)};this.childNodeInserted=async t=>{var d,c,u;let r=N.performance.now()+N.performance.timeOrigin,s=(d=this.state.activeRunnable)==null?void 0:d.id,o=(c=this.state.activeRunnable)==null?void 0:c.attempt;P("DOM.childNodeInserted %O",t);let i=this.state.domState.getBackendNodeId(t.parentNodeId);if(i&&this.state.domState.isBackendNodeIdTracked(i)){ue("DOM.childNodeInserted %O",t);let l=t.node,f=t.node.childNodeCount||0,x=((u=t.node.children)==null?void 0:u.length)||0;this.state.domState.trackAndMapNodeAndChildren(l),ue("DOM.childNodeInserted node %O",l),this.insertEvent({eventType:"dom:node-added",eventPayload:{node:await ye(this.cdpClient,l,i),parentId:i,previousId:this.state.domState.getBackendNodeId(t.previousNodeId)},eventExpectedSchema:Zt,timestamp:r,runnableId:s,attempt:o}),f>0&&x===0&&(ue("Requesting children for node",l.backendNodeId),await this.cdpClient.send("DOM.requestChildNodes",{nodeId:t.node.nodeId,depth:-1,pierce:!0}))}};this.childNodeCountUpdated=async t=>{P("DOM.childNodeCountUpdated %O",t);let r=this.state.domState.getBackendNodeId(t.nodeId);r&&this.state.domState.isBackendNodeIdTracked(r)&&(ue("DOM.childNodeCountUpdated %O",t),await this.cdpClient.send("DOM.requestChildNodes",{nodeId:t.nodeId,depth:-1,pierce:!0}))};this.attributeRemoved=t=>{var u,l;let r=N.performance.now()+N.performance.timeOrigin,s=(u=this.state.activeRunnable)==null?void 0:u.id,o=(l=this.state.activeRunnable)==null?void 0:l.attempt,{nodeId:i,name:d}=t,c=this.state.domState.getBackendNodeId(i);ue("DOM.attributeRemoved %O",{nodeId:i,backendNodeId:c,name:d}),P("Event %O",t),c&&this.state.domState.isBackendNodeIdTracked(c)?this.insertEvent({eventType:"dom:attribute-removed",eventPayload:{id:c,name:d},eventExpectedSchema:Xn,timestamp:r,runnableId:s,attempt:o}):P("Node %d is not tracked; skipping db insertion",i)};this.handleCypressProtocolInfo=({cypressProtocolInfo:t,serverTimestamp:r})=>{let s=JSON.parse(t),o=this.state.currentTimeRangeSyncData;if(this.state.addTimeRangeSyncData({clientSideStartTime:(o==null?void 0:o.clientSideEndTime)||0,clientSideEndTime:s.timestamp,serverSideStartTime:(o==null?void 0:o.serverSideEndTime)||0,serverSideEndTime:r,offset:r-s.timestamp}),this.db.flushPendingTimestampSyncEvents(),s.type==="test:after:run:async"){this.afterTestReceived=!0,this.deferredWaitForAfterTest&&(this.deferredWaitForAfterTest.resolve(),this.deferredWaitForAfterTest=void 0,this.afterTestReceived=!1);return}};this.attributeModified=t=>{var l,f;let r=N.performance.now()+N.performance.timeOrigin;if(t.name==="data-cypress-protocol-info"){this.handleCypressProtocolInfo({cypressProtocolInfo:t.value,serverTimestamp:r});return}if(this.cdpClient.domIsLoading)return;let s=(l=this.state.activeRunnable)==null?void 0:l.id,o=(f=this.state.activeRunnable)==null?void 0:f.attempt,{nodeId:i,name:d,value:c}=t,u=this.state.domState.getBackendNodeId(i);ue("DOM.attributeModified %O",{nodeId:i,backendNodeId:u,name:d}),P("Event: %O",t),u&&this.state.domState.isBackendNodeIdTracked(u)?this.insertEvent({eventType:"dom:attribute-modified",eventPayload:{id:u,name:d,value:c},eventExpectedSchema:Vt,timestamp:r,runnableId:s,attempt:o}):P("Node %d is not tracked; skipping db insertion",i)};this.inlineStyleInvalidated=async t=>{await Promise.all(t.nodeIds.map(async r=>{var o,i;let s=this.state.domState.getBackendNodeId(r);if(s&&this.state.domState.isBackendNodeIdTracked(s)){let{node:d}=await this.cdpClient.send("DOM.describeNode",{backendNodeId:s,depth:1,pierce:!0}),c=d.attributes||[],u=N.performance.now()+N.performance.timeOrigin,l=(o=this.state.activeRunnable)==null?void 0:o.id,f=(i=this.state.activeRunnable)==null?void 0:i.attempt,x;for(let k=0;k<c.length;k+=2)if(c[k]==="style"){x=c[k+1];break}x!==void 0&&this.insertEvent({eventType:"dom:attribute-modified",eventPayload:{id:s,name:"style",value:x},eventExpectedSchema:Vt,timestamp:u,runnableId:l,attempt:f})}}))};this.setChildNodes=async t=>{var d,c;let r=N.performance.now()+N.performance.timeOrigin,s=(d=this.state.activeRunnable)==null?void 0:d.id,o=(c=this.state.activeRunnable)==null?void 0:c.attempt;P("DOM.setChildNodes %O",t);let i=this.state.domState.getBackendNodeId(t.parentId);if(i){let u,l=[];for(let f of t.nodes||[])l.push({eventType:"dom:node-added",eventPayload:{node:await ye(this.cdpClient,f,i),parentId:i,previousId:u},eventExpectedSchema:Zt,timestamp:r,runnableId:s,attempt:o}),u=f.backendNodeId,this.state.domState.trackAndMapNodeAndChildren(f);this.insertEvents(l)}};this.childNodeRemoved=t=>{var c,u;let r=N.performance.now()+N.performance.timeOrigin,s=(c=this.state.activeRunnable)==null?void 0:c.id,o=(u=this.state.activeRunnable)==null?void 0:u.attempt;P("DOM.childNodeRemoved %O",t);let i=this.state.domState.getBackendNodeId(t.nodeId),d=this.state.domState.getBackendNodeId(t.parentNodeId);i&&d&&this.state.domState.isBackendNodeIdTracked(i)&&(ue("DOM.childNodeRemoved %O",t),this.insertEvent({eventType:"dom:node-removed",eventPayload:{id:i,parentId:d},eventExpectedSchema:Qn,timestamp:r,runnableId:s,attempt:o}))};this.executionContextCreated=async t=>{var r,s;console.log("Runtime.executionContextCreated %O",t.context.id),(r=t.context.auxData)!=null&&r.frameId&&((s=this.state.activeRunnable)!=null&&s.id)&&(this.state.domState.addExecutionContext({contextId:t.context.id,frameId:t.context.auxData.frameId}),this.updateExecutionContextWithCurrentMetadata({contextId:t.context.id,frameId:t.context.auxData.frameId}))};this.executionContextDestroyed=t=>{console.log("Runtime.executionContextDestroyed %O",t.executionContextId),this.state.domState.removeExecutionContext(t.executionContextId)};this.updateExecutionContextsWithCurrentMetadata=async()=>{await Promise.all(Array.from(this.state.domState.getExecutionContexts()).map(t=>this.updateExecutionContextWithCurrentMetadata(t)))};this.updateExecutionContextWithCurrentMetadata=async t=>{var r,s;await this.cdpClient.send("Runtime.evaluate",{contextId:t.contextId,expression:`window.__cypressProtocolMetadata = ${JSON.stringify({frameId:t.frameId,runnableId:(r=this.state.activeRunnable)==null?void 0:r.id,attempt:(s=this.state.activeRunnable)==null?void 0:s.attempt})}; null`}).catch(()=>{console.log("failed",t.contextId)})};this.radioInputChanged=({payload:t})=>{let{elementSelector:r,timestamp:s,frameId:o,runnableId:i,attempt:d,checked:c,name:u}=t;this.insertEvent({eventType:"dom:radio-input-changed",eventPayload:{elementSelector:r,frameId:o,checked:c,name:u},eventExpectedSchema:mt,timestamp:s,runnableId:i,attempt:d})};this.checkboxInputChanged=({payload:t})=>{let{elementSelector:r,timestamp:s,frameId:o,runnableId:i,attempt:d,checked:c}=t;this.insertEvent({eventType:"dom:checkbox-input-changed",eventPayload:{elementSelector:r,frameId:o,checked:c},eventExpectedSchema:Jn,timestamp:s,runnableId:i,attempt:d})};this.textInputChanged=({payload:t})=>{let{elementSelector:r,timestamp:s,frameId:o,runnableId:i,attempt:d,value:c}=t;this.insertEvent({eventType:"dom:text-input-changed",eventPayload:{elementSelector:r,frameId:o,value:c},eventExpectedSchema:rr,timestamp:s,runnableId:i,attempt:d})};this.selectInputChanged=({payload:t})=>{let{elementSelector:r,timestamp:s,frameId:o,runnableId:i,attempt:d,values:c}=t;this.insertEvent({eventType:"dom:select-input-changed",eventPayload:{elementSelector:r,frameId:o,values:c},eventExpectedSchema:ht,timestamp:s,runnableId:i,attempt:d})};this.elementScrolled=({payload:t})=>{let c=t,{timestamp:r,frameId:s,runnableId:o,attempt:i}=c,d=Xe(c,["timestamp","frameId","runnableId","attempt"]);this.insertEvent({eventType:"dom:element-scrolled",eventPayload:se(ae({},d),{frameId:s}),eventExpectedSchema:Yn,timestamp:r,runnableId:o,attempt:i})};this.windowScrolled=({payload:t})=>{let c=t,{timestamp:r,runnableId:s,attempt:o,frameId:i}=c,d=Xe(c,["timestamp","runnableId","attempt","frameId"]);this.insertEvent({eventType:"dom:window-scrolled",eventPayload:se(ae({},d),{frameId:i}),eventExpectedSchema:ar,timestamp:r,runnableId:s,attempt:o})}}async startCapturing(){await Promise.all([this.cdpClient.send("Page.enable"),this.cdpClient.send("DOM.enable",{includeWhitespace:"all"})]),await this.cdpClient.send("Runtime.addBinding",{name:"cypressAutProtocolEvent"}),await this.cdpClient.send("Page.addScriptToEvaluateOnNewDocument",{source:`${qn()}`,worldName:"Cypress Protocol"}),await this.cdpClient.send("Page.setLifecycleEventsEnabled",{enabled:!0}),this.cdpClient.on("Page.frameAttached",this.frameAttached),this.cdpClient.on("Page.frameDetached",this.frameDetached),this.cdpClient.on("Page.lifecycleEvent",this.lifecycleEvent),this.cdpClient.on("Runtime.executionContextCreated",this.executionContextCreated),this.cdpClient.on("Runtime.executionContextDestroyed",this.executionContextDestroyed),this.cdpClient.on("DOM.characterDataModified",this.characterDataModified,{skipWhenDOMIsLoading:!0}),this.cdpClient.on("DOM.childNodeInserted",this.childNodeInserted,{skipWhenDOMIsLoading:!0}),this.cdpClient.on("DOM.childNodeCountUpdated",this.childNodeCountUpdated,{skipWhenDOMIsLoading:!0}),this.cdpClient.on("DOM.setChildNodes",this.setChildNodes,{handleWhileDraining:!0}),this.cdpClient.on("DOM.childNodeRemoved",this.childNodeRemoved,{skipWhenDOMIsLoading:!0}),this.cdpClient.on("DOM.attributeRemoved",this.attributeRemoved,{skipWhenDOMIsLoading:!0}),this.cdpClient.on("DOM.inlineStyleInvalidated",this.inlineStyleInvalidated,{skipWhenDOMIsLoading:!0}),this.cdpClient.on("DOM.attributeModified",this.attributeModified),this.autBroker.on("select-input-changed",this.selectInputChanged),this.autBroker.on("radio-input-changed",this.radioInputChanged),this.autBroker.on("checkbox-input-changed",this.checkboxInputChanged),this.autBroker.on("text-input-changed",this.textInputChanged),this.autBroker.on("element-scrolled",this.elementScrolled),this.autBroker.on("window-scrolled",this.windowScrolled)}};var gs=n.object({name:n.string(),type:n.enum(["object","function","undefined","string","number","boolean","symbol","bigint","accessor"]).or(n.string()),value:n.string().optional(),valuePreview:n.lazy(()=>gt).optional(),subtype:n.enum(["array","node","null","regexp","date","map","set","weakmap","weakset","iterator","generator","error","proxy","promise","typedarray","arraybuffer","dataview","webassemblymemory","wasmvalue"]).or(n.string()).optional()}),ys=n.object({type:n.enum(["object","function","undefined","string","number","boolean","symbol","bigint"]).or(n.string()),subtype:n.enum(["array","node","null","regexp","date","map","set","weakmap","weakset","iterator","generator","error","proxy","promise","typedarray","arraybuffer","dataview","webassemblymemory","wasmvalue"]).or(n.string()).optional(),description:n.string().optional(),overflow:n.boolean()}),gt=ys.extend({properties:n.array(gs),entries:n.array(n.object({key:n.lazy(()=>gt).optional(),value:n.lazy(()=>gt)})).optional()}),We=n.object({type:n.enum(["object","function","undefined","string","number","boolean","symbol","bigint","wasm"]).or(n.string()),subtype:n.enum(["array","node","null","regexp","date","map","set","weakmap","weakset","iterator","generator","error","proxy","promise","typedarray","arraybuffer","dataview","webassemblymemory","wasmvalue","i32","i64","f32","f64","v128","externref"]).or(n.string()).optional(),className:n.string().optional(),value:n.any().optional(),unserializableValue:n.string().optional(),description:n.string().optional(),objectId:n.string().optional(),preview:gt.optional(),customPreview:n.object({header:n.string().optional(),bodyGetterId:n.string().optional()}).optional()});var vs=n.object({description:n.string().optional(),callFrames:n.array(n.object({functionName:n.string(),scriptId:n.string(),url:n.string(),lineNumber:n.number(),columnNumber:n.number()})),parentId:n.object({id:n.string(),debuggerId:n.string().optional()}).optional()}),re=vs.extend({parent:n.lazy(()=>re).optional()});var ir=n.object({type:n.enum(["error","log","debug","info","warning","dir","dirxml","table","trace","clear","startGroup","startGroupCollapsed","endGroup","assert","profile","profileEnd","count","timeEnd"]),args:n.array(We),executionContextId:n.number(),timestamp:n.number(),stackTrace:re.optional(),context:n.string().optional()});var dr=n.object({exceptionDetails:n.object({exceptionId:n.number(),text:n.string(),lineNumber:n.number(),columnNumber:n.number(),scriptId:n.string().optional(),url:n.string().optional(),stackTrace:re.optional(),exception:We.optional(),executionContextId:n.number().optional(),exceptionMetaData:n.any().optional()}),timestamp:n.number()});var cr=n.object({entry:n.object({source:n.enum(["xml","javascript","network","storage","appcache","rendering","security","deprecation","worker","violation","intervention","recommendation","other"]).or(n.string()),level:n.enum(["verbose","info","warning","error"]),text:n.string(),category:n.literal("cors").optional(),timestamp:n.number(),url:n.string().optional(),lineNumber:n.number().optional(),stackTrace:re.optional(),networkRequestId:n.string().optional(),workerId:n.string().optional(),args:n.array(We).optional()})});var yt=class extends U{async startCapturing(){this.startCapturingLogEntriesAdded()}startCapturingLogEntriesAdded(){this.cdpClient.on("Log.entryAdded",e=>{this.insertEvent({eventType:"log:added",eventPayload:e,eventExpectedSchema:cr,timestamp:e.entry.timestamp})})}};var vt=class extends U{async startCapturing(){await this.cdpClient.send("Runtime.enable"),this.startCapturingConsoleOutput(),this.startCapturingExceptionsThrown()}startCapturingConsoleOutput(){this.cdpClient.on("Runtime.consoleAPICalled",e=>{this.insertEvent({eventType:"runtime:console-api-called",eventPayload:e,eventExpectedSchema:ir,timestamp:e.timestamp})})}startCapturingExceptionsThrown(){this.cdpClient.on("Runtime.exceptionThrown",e=>{this.insertEvent({eventType:"runtime:exception-thrown",eventPayload:e,eventExpectedSchema:dr,timestamp:e.timestamp})})}};var Oe=require("perf_hooks");var pe=n.object({absoluteFile:n.string().optional(),column:n.number(),displayFile:n.any().optional(),line:n.number(),originalFile:n.string(),relativeFile:n.string().optional()});var bs=n.object({message:n.string(),whitespace:n.string()}),Ss=pe.extend({fileUrl:n.string(),function:n.string(),whitespace:n.string()}),xs=n.union([bs,Ss]),Cs=pe.extend({frame:n.string(),language:n.string().optional().nullable()}),bt=n.object({name:n.string(),message:n.string().optional(),isRecovered:n.boolean().default(!1).optional(),stack:n.string().optional(),parsedStack:n.array(xs).optional(),docsUrl:n.union([n.string(),n.array(n.string())]).optional(),codeFrame:Cs.optional()});var Ts=n.enum(["req modified","req + res modified","res modified"]),ks=n.union([n.literal("---"),n.literal("(canceled)"),n.literal("(aborted)"),n.string()]),lr=n.object({name:n.string(),cardinal:n.number().optional(),ordinal:n.string().optional()}),ur=n.union([n.string(),n.array(n.string()),lr,n.array(lr)]).nullable(),Gt=n.object({id:n.string(),alias:ur.optional(),aliasType:n.enum(["agent","dom","primitive","route","intercept"]).optional(),displayName:n.string().optional(),name:n.string().optional(),message:n.string().optional(),type:n.enum(["parent","child","system"]).optional(),testCurrentRetry:n.number().optional(),state:n.enum(["active","failed","pending","passed","processing","warned"]),referencesAlias:ur.optional(),testId:n.string(),timestamp:n.number(),snapshots:n.array(n.object({name:n.string().optional(),timestamp:n.number(),elToHighlightSelectors:n.array(n.string()).optional()})).optional(),coords:n.object({top:n.number(),left:n.number(),topCenter:n.number(),leftCenter:n.number(),x:n.number(),y:n.number()}).optional(),scrollBy:n.object({x:n.number(),y:n.number()}).optional(),highlightAttr:n.string().optional()}),ws=n.object({message:n.string().optional(),indicator:n.enum(["successful","pending","aborted","bad"]).optional(),interceptions:n.array(n.object({command:n.enum(["intercept","route"]),alias:n.string().optional(),type:n.enum(["function","stub","spy"])})).optional(),status:n.union([Ts,ks]).optional(),wentToOrigin:n.boolean().optional()}),_s=Gt.extend({callCount:n.number(),functionName:n.string(),instrument:n.literal("agent")}),Is=Gt.extend({isStubbed:n.boolean(),method:n.string(),numResponses:n.number(),url:n.string(),instrument:n.literal("route")}),Es=n.object({id:n.string(),isGlobalSession:n.boolean(),status:n.enum(["creating","created","restoring","restored","recreating","recreated","failed"])}),Ns=Gt.extend({err:bt.optional(),event:n.boolean().optional(),numElements:n.number().optional(),number:n.number().optional(),renderProps:ws.optional(),sessionInfo:Es.optional(),timeout:n.number().optional(),visible:n.boolean().optional(),wallClockStartedAt:n.string().optional(),hookId:n.string(),group:n.string().optional(),groupLevel:n.number().optional(),instrument:n.literal("command")}),pr=n.discriminatedUnion("instrument",[Ns,Is,_s]);var mr=n.boolean();var Rs=n.enum(["active","failed","pending","passed","processing","warned"]),Os=n.enum(["before all","before each","after all","after each","test body","studio commands"]),Ps=n.object({hookId:n.string(),hookName:Os,invocationDetails:pe.optional()}),Jt=n.object({id:n.string(),title:n.string().optional(),hooks:n.array(Ps).optional()}),St=Jt.extend({state:Rs.optional(),err:bt.optional(),currentRetry:n.number(),retries:n.number().optional(),final:n.boolean().optional(),invocationDetails:pe.optional()}),Re=St.extend({}),hr=n.object({id:Re.shape.id,state:Re.shape.state,err:Re.shape.err,hookId:n.string().optional(),failedFromHookId:n.string().optional(),currentRetry:Re.shape.currentRetry,retries:Re.shape.retries});var Ms=n.enum(["before each","before all","after all","after each","test body","studio commands"]),Ds=n.union([n.any(),n.undefined()]),As=n.object({hookId:n.string(),hookName:Ms,invocationDetails:pe.optional(),isStudio:n.boolean().optional()}),Ls=Jt.extend({tests:n.array(St)}),fr=Ls.extend({suites:n.lazy(()=>n.array(fr))}),gr=n.object({hooks:n.array(As).optional(),tests:n.array(St).optional(),suites:n.array(fr).optional(),testFilter:Ds.optional(),totalTests:n.number().optional(),totalUnfilteredTests:n.number().optional()});var yr=n.string();var vr=n.object({width:n.number(),height:n.number()});var js=n.enum(["High","Low","Medium"]).or(n.string()),qs=n.enum(["Lax","None","Strict"]).or(n.string()),Fs=n.enum(["NonSecure","Secure","Unset"]).or(n.string()),xt=n.enum(["Local","Private","Public","Unknown"]).or(n.string()),Ct=n.object({domain:n.string(),expires:n.number(),httpOnly:n.boolean(),name:n.string(),partitionKey:n.string().optional(),partitionKeyOpaque:n.boolean().optional(),path:n.string(),priority:js,sameParty:n.boolean(),sameSite:qs.optional(),secure:n.boolean(),session:n.boolean(),size:n.number(),sourceScheme:Fs,sourcePort:n.number(),value:n.string()}),Ve=n.enum(["Document","Stylesheet","Image","Media","Font","Script","TextTrack","XHR","Fetch","Prefetch","EventSource","WebSocket","Manifest","SignedExchange","Ping","CSPViolationReport","Preflight","Other"]).or(n.string());var zs=n.enum(["content-type","coep-frame-resource-needs-coep-header","coop-sandboxed-iframe-cannot-navigate-to-coop-page","corp-not-same-origin","corp-not-same-origin-after-defaulted-to-same-origin-by-coep","corp-not-same-site","csp","inspector","mixed-content","other","origin","subresource-filter"]).or(n.string()),Bs=n.enum(["Aborted","AccessDenied","AddressUnreachable","BlockedByClient","BlockedByResponse","ConnectionClosed","ConnectionReset","ConnectionRefused","ConnectionAborted","ConnectionFailed","Failed","InternetDisconnected","NameNotResolved","TimedOut"]).or(n.string()),Us=n.object({corsError:Bs,failedParameter:n.string()}).optional(),br=n.object({requestId:n.string(),timestamp:n.number(),type:Ve,errorText:n.string(),canceled:n.boolean().optional(),blockedReason:zs.optional(),corsErrorStatus:Us.optional()});var Sr=n.object({encodedDataLength:n.number(),requestId:n.string(),timestamp:n.number(),shouldReportCorbBlocking:n.boolean().optional()});var xr=n.object({requestId:n.string()});var $s=n.enum(["DomainMismatch","NameValuePairExceedsMaxSize","NotOnPath","SamePartyFromCrossPartyContext","SameSiteStrict","SameSiteLax","SameSiteNoneInsecure","SameSiteUnspecifiedTreatedAsLax","SchemefulSameSiteStrict","SchemefulSameSiteLax","SchemefulSameSiteUnspecifiedTreatedAsLax","SecureOnly","ThirdPartyBlockedInFirstPartySet","UnknownError","UserPreferences"]).or(n.string()),Ws=n.enum(["Allow","BlockFromInsecureToMorePrivate","PreflightBlock","PreflightWarn","WarnFromInsecureToMorePrivate"]).or(n.string()),Cr=n.object({associatedCookies:n.array(n.object({blockedReasons:n.array($s),cookie:Ct})),clientSecurityState:n.object({initiatorIsSecureContext:n.boolean(),initiatorIPAddressSpace:xt,privateNetworkRequestPolicy:Ws}).optional(),connectTiming:n.object({requestTime:n.number()}),headers:n.record(n.string(),n.string()),requestId:n.string(),siteHasCookieInOtherPartition:n.boolean().optional()});var Tr=n.object({documentURL:n.string(),frameId:n.string().optional(),initiator:n.object({type:n.string(),stack:re.optional(),url:n.string().optional(),lineNumber:n.number().optional(),columnNumber:n.number().optional(),requestId:n.string().optional()}),loaderId:n.string(),request:n.object({url:n.string(),urlFragment:n.string().optional(),method:n.string(),headers:n.record(n.string(),n.string()),postData:n.string().optional(),hasPostData:n.boolean().optional(),postDataEntries:n.array(n.object({bytes:n.string().optional()})).optional(),mixedContentType:n.string().optional(),initialPriority:n.string(),referrerPolicy:n.string(),isLinkPreload:n.boolean().optional(),trustTokenParams:n.object({operation:n.string(),refreshPolicy:n.string(),issuers:n.array(n.string()).optional()}).optional(),isSameSite:n.boolean().optional()}),requestId:n.string(),timestamp:n.number(),wallTime:n.number().optional(),hasUserGesture:n.boolean().optional(),type:Ve.optional(),redirectHasExtraInfo:n.boolean()});var Vs=n.enum(["InvalidDomain","InvalidPrefix","NameValuePairExceedsMaxSize","OverwriteSecure","SamePartyFromCrossPartyContext","SamePartyConflictsWithOtherAttributes","SameSiteLax","SameSiteNoneInsecure","SameSiteStrict","SameSiteUnspecifiedTreatedAsLax","SchemefulSameSiteStrict","SchemefulSameSiteLax","SchemefulSameSiteUnspecifiedTreatedAsLax","SchemeNotSupported","SecureOnly","SyntaxError","ThirdPartyBlockedInFirstPartySet","UnknownError","UserPreferences"]).or(n.string()),kr=n.object({requestId:n.string(),blockedCookies:n.array(n.object({blockedReasons:n.array(Vs),cookieLine:n.string(),cookie:Ct.optional()})),headers:n.record(n.string(),n.string()),resourceIPAddressSpace:xt,statusCode:n.number(),headersText:n.string().optional(),cookiePartitionKey:n.string().optional(),cookiePartitionKeyOpaque:n.boolean().optional()});var wr=n.object({loaderId:n.string(),requestId:n.string(),response:n.object({url:n.string(),status:n.number(),statusText:n.string(),headers:n.record(n.string(),n.string()),headersText:n.string().optional(),mimeType:n.string().optional(),requestHeaders:n.record(n.string(),n.string()).optional(),requestHeadersText:n.string().optional(),connectionReused:n.boolean(),connectionId:n.number(),remoteIPAddress:n.string().optional(),remotePort:n.number().optional(),fromDiskCache:n.boolean().optional(),fromServiceWorker:n.boolean().optional(),fromPrefetchCache:n.boolean().optional(),encodedDataLength:n.number(),timing:n.object({requestTime:n.number(),proxyStart:n.number(),proxyEnd:n.number(),dnsStart:n.number(),dnsEnd:n.number(),connectStart:n.number(),connectEnd:n.number(),sslStart:n.number(),sslEnd:n.number(),workerStart:n.number(),workerReady:n.number(),workerFetchStart:n.number(),workerRespondWithSettled:n.number(),sendStart:n.number(),sendEnd:n.number(),pushStart:n.number(),pushEnd:n.number(),receiveHeadersEnd:n.number()}).optional(),serviceWorkerResponseSource:n.enum(["cache-storage","http-cache","fallback-code","network"]).or(n.string()).optional(),responseTime:n.number().optional(),cacheStorageCacheName:n.string().optional(),protocol:n.string().optional(),alternateProtocolUsage:n.enum(["alternativeJobWonWithoutRace","alternativeJobWonRace","mainJobWonRace","mappingMissing","broken","dnsAlpnH3JobWonWithoutRace","dnsAlpnH3JobWonRace","unspecifiedReason"]).or(n.string()).optional(),securityState:n.enum(["unknown","neutral","insecure","secure","info","insecure-broken"]).or(n.string()),securityDetails:n.object({protocol:n.string(),keyExchange:n.string(),keyExchangeGroup:n.string().optional(),cipher:n.string(),mac:n.string().optional(),certificateId:n.number(),subjectName:n.string(),sanList:n.array(n.string()),issuer:n.string(),validFrom:n.number(),validTo:n.number(),signedCertificateTimestampList:n.array(n.object({status:n.string(),origin:n.string(),logDescription:n.string(),logId:n.string(),timestamp:n.number(),hashAlgorithm:n.string(),signatureAlgorithm:n.string(),signatureData:n.string()})),certificateTransparencyCompliance:n.enum(["unknown","not-compliant","compliant"]).or(n.string()),serverSignatureAlgorithm:n.number().optional(),encryptedClientHello:n.boolean()}).optional()}),timestamp:n.number(),type:Ve,frameId:n.string().optional(),hasExtraInfo:n.boolean()});var Yt=z(H());var _r=(0,Yt.default)("cypress:protocol:capture:NetworkManager"),me=(0,Yt.default)("cypress-verbose:protocol:capture:NetworkManager"),Zs=1e3,Hs=64*1024,Tt=class extends U{constructor(){super(...arguments);this.bodyHashMap=new Map;this.convertToMs=t=>t*Zs;this.isTrackedFrame=t=>t&&this.state.domState.isTrackedFrame(t);this.requestServedFromCache=t=>{let r=this.state.networkState.getRequest(t.requestId);if(!r){me("Network.requestServedFromCache not added since the request is not being tracked: %O",t);return}r.isCached=!0,this.insertEvent({eventType:"network:request-served-from-cache",eventPayload:t,eventExpectedSchema:xr,timestamp:Oe.performance.now()+Oe.performance.timeOrigin})};this.requestWillBeSent=t=>{if(!this.isTrackedFrame(t.frameId)){me("Network.requestWillBeSent not added since it is not originating from a child frame: %O",t);return}let r=this.convertToMs(t.wallTime);this.insertEvent({eventType:"network:request-will-be-sent",eventPayload:t,eventExpectedSchema:Tr,timestamp:r});let s=this.state.networkState.getRequest(t.requestId);s?s.requestURLs.push(t.request.url):this.state.networkState.addRequest({requestId:t.requestId,requestURLs:[t.request.url],type:t.type,requestWillBeSentTimestamp:t.timestamp,requestWillBeSentWallTime:r})};this.requestWillBeSentExtraInfo=t=>{if(!this.state.networkState.getRequest(t.requestId)){me("Network.requestWillBeSentExtraInfo not added since the request is not being tracked: %O",t);return}this.insertEvent({eventType:"network:request-will-be-sent-extra-info",eventPayload:t,eventExpectedSchema:Cr,timestamp:Oe.performance.now()+Oe.performance.timeOrigin})};this.responseReceived=t=>{if(!this.isTrackedFrame(t.frameId)){me("Network.responseReceived not added since it is not originating from a child frame: %O",t);return}let r=this.state.networkState.getRequest(t.requestId);if(!r){me("Network.responseReceived not added since the request is not being tracked: %O",t);return}let s=this.convertToMs(t.timestamp-r.requestWillBeSentTimestamp);this.insertEvent({eventType:"network:response-received",eventPayload:t,eventExpectedSchema:wr,timestamp:r.requestWillBeSentWallTime+s}),this.state.networkState.addResponse({requestId:t.requestId,mimeType:t.response.mimeType,type:t.type})};this.responseReceivedExtraInfo=t=>{if(!this.state.networkState.getRequest(t.requestId)){me("Network.responseReceived not added since the request is not being tracked: %O",t);return}this.insertEvent({eventType:"network:response-received-extra-info",eventPayload:t,eventExpectedSchema:kr,timestamp:Oe.performance.now()+Oe.performance.timeOrigin})};this.loadingFinished=async t=>{var u,l;let r=this.state.networkState.getRequest(t.requestId),s=this.state.networkState.getResponse(t.requestId);if(!r||!s){me("Network.loadingFinished not added since the request and response are not being tracked: %O",t);return}this.state.networkState.removeRequest(t.requestId),this.state.networkState.removeResponse(t.requestId);let o=this.convertToMs(t.timestamp-r.requestWillBeSentTimestamp);if(this.insertEvent({eventType:"network:loading-finished",eventPayload:t,eventExpectedSchema:Sr,timestamp:r.requestWillBeSentWallTime+o}),_r("Network.loadingFinished %O",{request:r,response:s}),["Script"].includes(s.type))return;let i={requestId:t.requestId,requestURLs:r.requestURLs,type:s.type,mimeType:s.mimeType,requestWillBeSentTimestamp:r.requestWillBeSentTimestamp,loadingFinishedTimestamp:t.timestamp,runnableId:(u=this.state.activeRunnable)==null?void 0:u.id,attempt:(l=this.state.activeRunnable)==null?void 0:l.attempt};if(r.isCached){let f;for(let x of r.requestURLs)if(f=this.bodyHashMap.get(x),f)break;if(f){this.db.addCachedNetworkResponse(se(ae({},i),{bodyHash:f}));return}}let d=await this.cdpClient.send("Network.getResponseBody",{requestId:t.requestId}).catch(()=>{});if(!d)return;let c=this.db.addNetworkResponse(se(ae({},i),{body:d.body,isBase64Encoded:d.base64Encoded}));if(c)for(let f of r.requestURLs)this.bodyHashMap.set(f,c)};this.loadingFailed=t=>{let r=this.state.networkState.getRequest(t.requestId);if(!r){me("Network.loadingFailed not added since the request is not being tracked: %O",t);return}_r("Network.loadingFailed %O",{request:r}),this.state.networkState.removeRequest(t.requestId);let s=this.convertToMs(t.timestamp-r.requestWillBeSentTimestamp);this.insertEvent({eventType:"network:loading-failed",eventPayload:t,eventExpectedSchema:br,timestamp:r.requestWillBeSentWallTime+s})}}resetCacheData(){this.bodyHashMap=new Map}async startCapturing(){await this.cdpClient.send("Network.enable",{maxPostDataSize:Hs}),this.cdpClient.on("Network.requestServedFromCache",this.requestServedFromCache),this.cdpClient.on("Network.requestWillBeSent",this.requestWillBeSent),this.cdpClient.on("Network.requestWillBeSentExtraInfo",this.requestWillBeSentExtraInfo),this.cdpClient.on("Network.responseReceived",this.responseReceived),this.cdpClient.on("Network.responseReceivedExtraInfo",this.responseReceivedExtraInfo),this.cdpClient.on("Network.loadingFinished",this.loadingFinished),this.cdpClient.on("Network.loadingFailed",this.loadingFailed)}};var Qt=z(H()),Ye=require("perf_hooks");var F=(0,Qt.default)("cypress:protocol:capture:CypressEventsManager"),Kt=(0,Qt.default)("cypress-verbose:protocol:capture:CypressEventsManager"),kt=class{constructor(e,t){this.db=e;this.state=t}viewportChanged(e){var r,s,o;let t=vr.safeParse(e.viewport);if(!t.success){F("not adding viewport changed event to database due to failed parsing: %O",t.error);return}F("inserting viewport into database: %O",t.data),(o=this.db)==null||o.addEvent({source:"cypress",type:"viewport:changed",runnableId:(r=this.state.activeRunnable)==null?void 0:r.id,attempt:(s=this.state.activeRunnable)==null?void 0:s.attempt,payload:t.data,timestamp:e.timestamp})}urlChanged(e){var r,s,o;let t=yr.safeParse(e.url);if(!t.success){F("not adding url changed event to database due to failed parsing: %O",t.error);return}F("inserting url into database: %O",t.data),(o=this.db)==null||o.addEvent({source:"cypress",type:"url:changed",runnableId:(r=this.state.activeRunnable)==null?void 0:r.id,attempt:(s=this.state.activeRunnable)==null?void 0:s.attempt,payload:t.data,timestamp:e.timestamp})}pageLoading(e){var r,s,o;let t=mr.safeParse(e.loading);if(!t.success){F("not adding page loading event to database due to failed parsing: %O",t.error);return}F("inserting page loading into database: %O",t.data),(o=this.db)==null||o.addEvent({source:"cypress",type:"page:loading",runnableId:(r=this.state.activeRunnable)==null?void 0:r.id,attempt:(s=this.state.activeRunnable)==null?void 0:s.attempt,payload:t.data,timestamp:e.timestamp})}beforeTest(e,t){var s;let r=Re.safeParse(e);if(!r.success){F("not adding before test lifecycle event to database due to failed parsing: %O",r.error);return}F("before test %s",e.id),Kt("before test details %O",e),(s=this.db)==null||s.addEvent({source:"cypress",type:"test:before:run:async",payload:r.data,runnableId:e.id,attempt:e.currentRetry+1,timestamp:t}),this.state.activeRunnable={id:e.id,attempt:e.currentRetry+1}}afterTest(e){var r;let t=hr.safeParse(e);if(!t.success){F("not adding after test lifecycle event to database due to failed parsing: %O",t.error);return}F("after test %s",t.data.id),Kt("after test details %O",t.data),(r=this.db)==null||r.addEvent({source:"cypress",type:"test:after:run:async",payload:t.data,runnableId:e.id,attempt:e.currentRetry+1,timestamp:Ye.performance.now()+Ye.performance.timeOrigin})}addRunnables(e){var r;let t=gr.safeParse(e);if(!t.success){F("not adding runnables to database due to failed parsing: %O",t.error);return}(r=this.db)==null||r.addEvent({source:"cypress",type:"runnables:ready",payload:t.data,timestamp:Ye.performance.now()+Ye.performance.timeOrigin})}commandLogAdded(e){this.insertCommandLogEvent({log:e,type:"log:added"})}commandLogChanged(e){this.insertCommandLogEvent({log:e,type:"log:changed"})}async insertCommandLogEvent({log:e,type:t}){var s;let r=pr.safeParse(e);if(!r.success){F("not adding command log %s event to database due to failed parsing: %O",t,r.error);return}F("inserting command log into database, id: %s, type: %s",r.data.id,t),Kt("command log details: %O",r.data),(s=this.db)==null||s.addEvent({source:"cypress",type:t,runnableId:r.data.testId,attempt:r.data.testCurrentRetry!=null?r.data.testCurrentRetry+1:void 0,payload:r.data,timestamp:r.data.timestamp})}};var Pr=z(H());var cn=z(H()),Er=require("events");var en=n.object({type:n.literal("text-input-changed"),payload:n.object({elementSelector:n.string(),value:n.string(),timestamp:n.number(),runnableId:n.string(),attempt:n.number(),frameId:n.string()})});var tn=n.object({type:n.literal("element-scrolled"),payload:n.object({timestamp:n.number(),scrollX:n.number(),scrollY:n.number(),elementSelector:n.string(),runnableId:n.string(),attempt:n.number(),frameId:n.string()})});var nn=n.object({type:n.literal("window-scrolled"),payload:n.object({timestamp:n.number(),scrollX:n.number(),scrollY:n.number(),runnableId:n.string(),attempt:n.number(),frameId:n.string()})});var rn=n.object({type:n.literal("select-input-changed"),payload:ht.omit({frameId:!0}).extend({timestamp:n.number(),runnableId:n.string(),attempt:n.number(),frameId:n.string()})});var an=n.object({type:n.literal("radio-input-changed"),payload:mt.omit({frameId:!0}).extend({timestamp:n.number(),runnableId:n.string(),attempt:n.number(),frameId:n.string()})});var sn=n.object({type:n.literal("checkbox-input-changed"),payload:n.object({elementSelector:n.string(),checked:n.boolean(),timestamp:n.number(),runnableId:n.string(),attempt:n.number(),frameId:n.string()})});var on={"radio-input-changed":an,"checkbox-input-changed":sn,"text-input-changed":en,"element-scrolled":tn,"select-input-changed":rn,"window-scrolled":nn},Hc=n.discriminatedUnion("type",[an,sn,en,tn,rn,nn]);var dn=(0,cn.default)("cypress:protocol:capture:AUTEventBroker"),Ir=(0,cn.default)("cypress-verbose:protocol:capture:AUTEventBroker"),wt=class{constructor(e){this.cdpClient=e;this.handleBindingCalled=e=>{dn("Runtime.bindingCalled %O",{name:e.name,executionContextId:e.executionContextId}),Ir("Event: %O",e);let t=JSON.parse(e.payload);if(!on[t.type]){dn("Runtime.bindingCalled: Invalid event type %s",t.type);return}let r=on[t.type].safeParse(t);if(!r.success){dn("Runtime.bindingCalled: (%s) Invalid event payload",t.type),Ir(JSON.stringify(r.error.format(),void 0,2));return}let{type:s,payload:o}=r.data;this.emitter.emit(s,{executionContextId:e.executionContextId,payload:o})};this.emitter=new Er.EventEmitter,this.cdpClient.on("Runtime.bindingCalled",this.handleBindingCalled)}on(e,t){return this.emitter.on(e,t)}};var _t=class{constructor(){this.backendNodeIdsToTrack=new Set;this.frontendNodeIdToBackendNodeId=new Map;this.backendNodeIdToFrontendNodeId=new Map;this.trackedFrames=new Set;this.trackedStyleSheets=new Map;this.executionContexts=new Map;this.pendingAUTEvents=!1}trackAndMapNodeAndChildren(e){Ge(e,t=>{this.backendNodeIdsToTrack.add(t.backendNodeId),this.frontendNodeIdToBackendNodeId.set(t.nodeId,t.backendNodeId),this.backendNodeIdToFrontendNodeId.set(t.backendNodeId,t.nodeId)})}addTrackedFrame(e){this.trackedFrames.add(e)}removeTrackedFrame(e){this.trackedFrames.delete(e)}isTrackedFrame(e){return this.trackedFrames.has(e)}isFrameOutsideContext(e){return this.autFrameId&&this.autFrameId!==e}trackStyleSheet(e,t){this.trackedStyleSheets.set(e,t)}ownerNodeForStyleSheet(e){return this.trackedStyleSheets.get(e)}untrackStyleSheet(e){this.trackedStyleSheets.delete(e)}isStyleSheetTracked(e){return this.trackedStyleSheets.has(e)}addExecutionContext(e){this.executionContexts.set(e.contextId,e)}removeExecutionContext(e){this.executionContexts.delete(e)}getExecutionContexts(){return Array.from(this.executionContexts.values())}isBackendNodeIdTracked(e){return this.backendNodeIdsToTrack.has(e)}getBackendNodeId(e){return this.frontendNodeIdToBackendNodeId.get(e)}getFrontendNodeId(e){return this.backendNodeIdToFrontendNodeId.get(e)}resetAutState(){this.backendNodeIdsToTrack.clear(),this.frontendNodeIdToBackendNodeId.clear(),this.backendNodeIdToFrontendNodeId.clear(),this.autFrameId=void 0,this.autFrameNodeId=void 0}};var It=class{constructor(){this.requestMap=new Map;this.responseMap=new Map}addRequest(e){this.requestMap.set(e.requestId,e)}getRequest(e){return this.requestMap.get(e)}removeRequest(e){this.requestMap.delete(e)}addResponse(e){this.responseMap.set(e.requestId,e)}getResponse(e){return this.responseMap.get(e)}removeResponse(e){this.responseMap.delete(e)}};var Ze=class{constructor(){this.syncTimings=[];this.domState=new _t;this.networkState=new It}get currentTimeRangeSyncData(){return this.syncTimings[this.syncTimings.length-1]}addTimeRangeSyncData(e){this.syncTimings.push(e)}getTimingForTimestamp(e){return this.syncTimings.find(r=>r.serverSideStartTime<=e&&r.serverSideEndTime>=e)}};var Rr=z(Ht()),Or=z(H()),Nr=(0,Or.default)("cypress-verbose:protocol:capture:tracked-cdp"),Et=class{constructor(e){this.cdpClient=e;this.outstandingCallbacks=0;this.isDrainInProgress=!1;this.domIsLoading=!1}removeOutstandingCallback(){this.outstandingCallbacks-=1,this.outstandingCallbacks===0&&this.deferredCallbackDrain&&(this.deferredCallbackDrain.resolve(),this.deferredCallbackDrain=void 0)}on(e,t,r){this.cdpClient.on(e,async s=>{if(r!=null&&r.skipWhenDOMIsLoading&&this.domIsLoading){Nr("skipping event while dom is loading",e);return}if(!(r!=null&&r.handleWhileDraining)&&this.isDrainInProgress){Nr("skipping event while draining",e);return}this.outstandingCallbacks+=1;try{await t(s)}catch(o){throw o}finally{this.removeOutstandingCallback()}})}async send(e,t){return this.cdpClient.send(e,t)}async drainEventCallbacks(){console.log("draining"),this.isDrainInProgress=!0,this.outstandingCallbacks!==0&&(this.deferredCallbackDrain=(0,Rr.default)(),await this.deferredCallbackDrain.promise,console.log("draining done"))}resetDrain(){console.log("resetting drain"),this.isDrainInProgress=!1}};var un=z(H()),Pe=require("perf_hooks");var Nt=(0,un.default)("cypress:protocol:capture:CSSManager"),ln=(0,un.default)("cypress-verbose:protocol:capture:CSSManager"),Rt=class extends U{constructor(){super(...arguments);this.stylesheetAdded=async t=>{var R,w;ln("stylesheet added %O",t);let{header:{frameId:r,sourceURL:s,styleSheetId:o,ownerNode:i,isConstructed:d,isMutable:c,isInline:u}}=t;if(!this.state.domState.isTrackedFrame(r)){Nt("frame outside context; skipping css capture");return}if(i&&!this.state.domState.isBackendNodeIdTracked(i)&&!this.cdpClient.domIsLoading){Nt("CSS owned by untracked node; skipping capture");return}let l=Pe.performance.now()+Pe.performance.timeOrigin,f=(R=this.state.activeRunnable)==null?void 0:R.attempt,x=(w=this.state.activeRunnable)==null?void 0:w.id,k,M=!1;if(c)try{k=await this.cdpClient.send("CSS.getStyleSheetText",{styleSheetId:o})}catch(Y){M=!0,ln("Error retrieving css text from cdp: %O",Y)}this.state.domState.trackStyleSheet(o,i),this.insertEvent({eventType:"dom:style-sheet-added",eventPayload:{frameId:r,styleSheetId:o,styleSheetText:(k==null?void 0:k.text)||"",cdpRetrievalFailed:M,sourceURL:s,ownerNode:i,isConstructed:d,isInline:u,isMutable:c},eventExpectedSchema:er,timestamp:l,runnableId:x,attempt:f})};this.styleSheetChanged=async({styleSheetId:t})=>{var u,l;if(!this.state.domState.isStyleSheetTracked(t)){Nt("Stylesheet changed but not tracked, not capturing");return}let r=this.state.domState.ownerNodeForStyleSheet(t),s=Pe.performance.now()+Pe.performance.timeOrigin,o=(u=this.state.activeRunnable)==null?void 0:u.attempt,i=(l=this.state.activeRunnable)==null?void 0:l.id,d,c=!1;try{let f=r?this.state.domState.getFrontendNodeId(r):void 0;f?await this.cdpClient.send("CSS.getMatchedStylesForNode",{nodeId:f}):this.state.domState.autFrameNodeId&&await this.cdpClient.send("CSS.getMatchedStylesForNode",{nodeId:this.state.domState.autFrameNodeId}),d=await this.cdpClient.send("CSS.getStyleSheetText",{styleSheetId:t})}catch(f){c=!0,ln("Error retrieving css text from cdp: %O",f)}this.insertEvent({eventType:"dom:style-sheet-changed",eventPayload:{styleSheetId:t,styleSheetText:(d==null?void 0:d.text)||"",cdpRetrievalFailed:c},eventExpectedSchema:tr,timestamp:s,runnableId:i,attempt:o})};this.styleSheetRemoved=async({styleSheetId:t})=>{var i,d;if(!this.state.domState.isStyleSheetTracked(t)){Nt("Stylesheet changed but not tracked, not capturing");return}let r=Pe.performance.now()+Pe.performance.timeOrigin,s=(i=this.state.activeRunnable)==null?void 0:i.attempt,o=(d=this.state.activeRunnable)==null?void 0:d.id;this.state.domState.untrackStyleSheet(t),this.insertEvent({eventType:"dom:style-sheet-removed",eventPayload:{styleSheetId:t},eventExpectedSchema:nr,timestamp:r,runnableId:o,attempt:s})}}async startCapturing(){await this.cdpClient.send("CSS.enable"),this.cdpClient.on("CSS.styleSheetAdded",this.stylesheetAdded),this.cdpClient.on("CSS.styleSheetChanged",this.styleSheetChanged),this.cdpClient.on("CSS.styleSheetRemoved",this.styleSheetRemoved)}};var pn=(0,Pr.default)("cypress:protocol:capture"),Ot=class{constructor(){this.state=new Ze}beforeSpec(e){pn("initializing new spec"),this.state=new Ze,this.db=new Le({db:e,state:this.state}),this.cypressEventsManager=new kt(this.db,this.state)}async connectToBrowser(e){if(pn("connecting to browser for new spec"),this.cdpClient=new Et(e),!this.db)throw new Error("Database not initialized. beforeSpec() must be called first");this.autBroker=new wt(this.cdpClient),this.cdpLogManager=new yt(this.cdpClient,this.db,this.state,this.autBroker),this.runtimeManager=new vt(this.cdpClient,this.db,this.state,this.autBroker),this.cssManager=new Rt(this.cdpClient,this.db,this.state,this.autBroker),this.domManager=new ft(this.cdpClient,this.db,this.state,this.autBroker),this.networkManager=new Tt(this.cdpClient,this.db,this.state,this.autBroker),await Promise.all([this.cdpLogManager.startCapturing(),this.domManager.startCapturing(),this.runtimeManager.startCapturing(),this.cssManager.startCapturing()]),await this.networkManager.startCapturing()}addRunnables(e){var t;(t=this.cypressEventsManager)==null||t.addRunnables(e)}commandLogAdded(e){var t;(t=this.cypressEventsManager)==null||t.commandLogAdded(e)}commandLogChanged(e){var t;(t=this.cypressEventsManager)==null||t.commandLogChanged(e)}async beforeTest(e){var r,s,o,i;let t=mn.performance.now()+mn.performance.timeOrigin;(r=this.cdpClient)==null||r.resetDrain(),(s=this.cypressEventsManager)==null||s.beforeTest(e,t),await Promise.all([(o=this.domManager)==null?void 0:o.updateExecutionContextsWithCurrentMetadata(),(i=this.domManager)==null?void 0:i.captureFullSnapshot({timestamp:t,flushImmediately:!0})])}async afterTest(e){var t,r,s,o,i;(t=this.cdpClient)!=null&&t.isDrainInProgress||(console.log("waiting in after test"),(r=this.cypressEventsManager)==null||r.afterTest(e),await((s=this.domManager)==null?void 0:s.waitForAfterTest()),await((o=this.cdpClient)==null?void 0:o.drainEventCallbacks()),(i=this.db)==null||i.flushPendingTimestampSyncEvents(),console.log("after test"))}viewportChanged(e){var t;(t=this.cypressEventsManager)==null||t.viewportChanged(e)}urlChanged(e){var t;(t=this.cypressEventsManager)==null||t.urlChanged(e)}pageLoading(e){var t;(t=this.cypressEventsManager)==null||t.pageLoading(e)}resetTest(e){var t;(t=this.db)==null||t.resetTest(e),this.state=new Ze}afterSpec(){return pn("after spec"),new Promise((e,t)=>{setTimeout(()=>{var r,s;try{(r=this.db)==null||r.close(),(s=this.networkManager)==null||s.resetCacheData(),this.state.activeRunnable=void 0,e()}catch(o){t(o)}},10)})}};Ot.SCHEMA_VERSION=Le.SCHEMA_VERSION;0&&(module.exports={AppCaptureProtocol});
