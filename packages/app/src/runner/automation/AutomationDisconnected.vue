<template>
  <AutInfo>
    <Alert
      :title="t('runner.automation.disconnected.title')"
      status="warning"
      :icon="IconStatusErroredOutline"
      :dismissible="false"
      class="w-full max-w-[600px]"
    >
      <div class="flex flex-col gap-[16px]">
        <p>
          {{ t('runner.automation.disconnected.description') }}
        </p>
        <Button
          size="32"
          @click="relaunch"
        >
          <IconActionRefresh
            stroke-color="white"
            class="mr-[8px]"
          />
          {{ t('runner.automation.disconnected.reload') }}
        </Button>
        <ExternalLink
          class="mt-[16px] text-indigo-500"
          href="https://on.cypress.io/launching-browsers"
        >
          <IconObjectBook
            stroke-color="indigo-500"
            fill-color="indigo-100"
            class="ml-[8px] -top-[2px] relative inline-block"
          />
          {{ t('runner.automation.shared.link') }}
        </ExternalLink>
      </div>
    </Alert>
  </AutInfo>
</template>

<script setup lang="ts">
import Button from '@cypress-design/vue-button'
import { IconActionRefresh, IconObjectBook, IconStatusErroredOutline } from '@cypress-design/vue-icon'
import AutInfo from './AutInfo.vue'
import ExternalLink from '@cy/gql-components/ExternalLink.vue'
import { gql } from '@urql/core'
import { useMutation } from '@urql/vue'
import { AutomationDisconnected_RelaunchBrowserDocument } from '../../generated/graphql'
import { useI18n } from '@cy/i18n'
import Alert from '@cy/components/Alert.vue'

const { t } = useI18n()

gql`
mutation AutomationDisconnected_RelaunchBrowser {
  launchOpenProject {
    id
  }
}
`

const gqlRelaunch = useMutation(AutomationDisconnected_RelaunchBrowserDocument)

const relaunch = () => gqlRelaunch.executeMutation({})

</script>
